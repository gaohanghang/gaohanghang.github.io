<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="ä¸ªäººå…¬ä¼—å·ã€Šéª‡å®¢ä¸ç”»å®¶ã€‹" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> é«˜è¡Œè¡Œçš„ä¸ªäººåšå®¢</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">é«˜è¡Œè¡Œçš„ä¸ªäººåšå®¢</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['é¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€', 'ç§‘æŠ€éœ€è¦äººæ–‡çš„æµ‡çŒ', 'æƒ³è¦çš„éƒ½æ‹¥æœ‰ï¼Œå¾—ä¸åˆ°çš„éƒ½é‡Šæ€€'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  <ul class="ads">
    
        <li>
            <a target="_blank" rel="noopener" href="https://curl.qcloud.com/kvO7hb43">
                <img src="https://pic.imgdb.cn/item/62174b452ab3f51d912a5ccc.jpg" width="300" alt="äº‘æœåŠ¡å™¨é™æ—¶ç§’æ€">
            </a>
        </li>
    
        <li>
            <a target="_blank" rel="noopener" href="https://www.vultr.com/?ref=8630075">
                <img src="https://pic.imgdb.cn/item/62174b452ab3f51d912a5cd7.png" width="300" alt="vulträ¼˜æƒ vps">
            </a>
        </li>
    
</ul>
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-æ…•è¯¾ç½‘-ThreadLocal-æ•™å­¦è§†é¢‘å­¦ä¹ ç¬”è®°"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/01/%E6%85%95%E8%AF%BE%E7%BD%91-ThreadLocal-%E6%95%99%E5%AD%A6%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
    >æ…•è¯¾ç½‘ ThreadLocal æ•™å­¦è§†é¢‘å­¦ä¹ ç¬”è®°</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/02/01/%E6%85%95%E8%AF%BE%E7%BD%91-ThreadLocal-%E6%95%99%E5%AD%A6%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-01-31T16:33:30.000Z" itemprop="datePublished">2020-02-01</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>è¯¾ç¨‹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.imooc.com/learn/1217">https://www.imooc.com/learn/1217</a></p>
<p>ä½œè€…ï¼š<a target="_blank" rel="noopener" href="https://www.imooc.com/u/6703917/courses?sort=publish">æ±‚è€ä»™å¥¶æˆ‘ä¸åˆ° P10</a>ï¼ˆè¿™æ˜µç§° ğŸ¤”ï¼Œæˆ‘å¥¶ä¸€å£ï¼Œä½ åˆ°ä¸äº† P10 ğŸ¶ï¼‰</p>
<p>ä½œè€…ç®€ä»‹ï¼šæˆ‘æ˜¯ä¸€åæœ‰ 10 å¹´ç»éªŒçš„äº’è”ç½‘è€å…µï¼Œåˆ›è¿‡ä¸šã€ä¹Ÿæ›¾ä»»æ•°å®¶å¤§å‹äº’è”ç½‘å…¬å¸æ¶æ„å¸ˆã€å›¢é˜Ÿ Leaderï¼Œ30 å²ï¼ˆ2018ï¼‰ä»»èŒé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶ï¼ˆP8ï¼‰ã€‚æ›¾è´Ÿè´£æ¶æ„ PHP é«˜è´Ÿè½½ã€å‰ç«¯ï¼ˆReact&#x2F;RNï¼‰æ–¹å‘ã€Java é¢†åŸŸåŒ–ä¸­é—´ä»¶æ–¹å‘ã€å¤§æ•°æ®(BI å’Œæ•°æ®å¯è§†åŒ–)ç­‰å¤šæ–¹å‘ä¸šç•ŒçŸ¥åé¡¹ç›®ã€‚å¤§å­¦åˆ·å®Œç®—æ³•å¯¼è®ºï¼Œå‚åŠ è¿‡ ACM å’Œå›½é™…æœºå™¨äººç«èµ›ï¼Œå¤šå¹´åœ¨é¡¹ç›®ä¸­å®è·µæŠ€æœ¯é©±åŠ¨ã€å‰ç«¯åç«¯é¢†åŸŸåŒ–ã€æ•°æ®å¯è§†åŒ–ï¼Œå¤šä¸ªé¢†åŸŸå®æˆ˜ç»éªŒä¸°å¯Œã€‚</p>
<p>ä»£ç åœ°å€ï¼ˆè·Ÿç€è¯¾ç¨‹æ‰‹æ•²çš„ï¼‰ï¼š<a target="_blank" rel="noopener" href="https://github.com/gaohanghang/spring-threadlocal-demo">https://github.com/gaohanghang/spring-threadlocal-demo</a></p>
</blockquote>
<blockquote>
<p>ç®€ä»‹ï¼šå¤šçº¿ç¨‹å¢åŠ äº†æˆ‘ä»¬çš„ä¸ç¡®å®šæ€§ï¼Œç ´åäº†å¯é¢„æµ‹æ€§â€”â€”å½“ç„¶ï¼Œè¿™å¯¹äºã€è‰ºé«˜äººèƒ†å¤§ã€‘çš„æœªæ¥çš„ä½ ï¼Œéƒ½æ˜¯å°äº‹ï¼Œå› ä¸ºä½ ä¼šä¸æ–­è¿›æ­¥æˆé•¿ï¼Œåªè¦ä½ æŠŠæ¡å¥½ç°åœ¨çš„å…‰é˜´ã€‚ç§‘å­¦çš„ç¾ï¼Œåœ¨äºå®ƒçš„æ¨¡å‹å¯ä»¥ä¸æ–­çš„è¿­ä»£å’Œè¿›æ­¥ï¼ŒJava æ˜¯ä¸€ç§ç®€åŒ–å’Œè¿›æ­¥ï¼ŒThreadLocal ä¹Ÿä¸€ç§ç®€åŒ–å’Œè¿›æ­¥ï¼Œå¦‚åŒ Java ç»™ç¼–ç¨‹å¸¦æ¥äº†å¾ˆå¤šå®‰å…¨æ„Ÿï¼Œè€Œ ThreadLocal ç»™å¤šçº¿ç¨‹æ—¶ä»£å¸¦äº†æ›´å¤šçš„å®‰å…¨æ„Ÿï¼ˆå¯é¢„æµ‹æ€§ã€ç¡®å®šæ€§ï¼Œä¸€è‡´æ€§â€¦â€¦ï¼‰ã€‚è¯¾ç¨‹æ˜¯ä¸€ç§çˆ¬å¡è®­ç»ƒï¼Œéš¾åº¦ä¼šä¸€ç›´ä¸Šå»ç›´åˆ°ä½ å®Œå…¨ç†è§£ï¼Œå¯ä»¥è‡ªå·±åŠ¨æ‰‹å®ç°ã€‚</p>
</blockquote>
<h2 id="ç¬¬-1-ç« -çºµè§‚è¯¾ç¨‹çº²è¦"><a href="#ç¬¬-1-ç« -çºµè§‚è¯¾ç¨‹çº²è¦" class="headerlink" title="ç¬¬ 1 ç«  çºµè§‚è¯¾ç¨‹çº²è¦"></a>ç¬¬ 1 ç«  çºµè§‚è¯¾ç¨‹çº²è¦</h2><blockquote>
<p>äº†è§£ä¸€è‡´æ€§ç­‰åŸºç¡€æ¦‚å¿µï¼Œè§£å†³ä¸€è‡´æ€§çš„åŸºæœ¬æ–¹æ³•ï¼ŒæŠŠ ThreadLocal æ”¾åˆ°ä¸€ä¸ªå®è§‚èƒŒæ™¯å»æ€è€ƒã€‚</p>
</blockquote>
<h3 id="1-1-è®ºç¨‹åºçš„å®‰å…¨æ„Ÿ-09-09"><a href="#1-1-è®ºç¨‹åºçš„å®‰å…¨æ„Ÿ-09-09" class="headerlink" title="1-1 è®ºç¨‹åºçš„å®‰å…¨æ„Ÿ (09:09)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21049">1-1 è®ºç¨‹åºçš„å®‰å…¨æ„Ÿ (09:09)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580489265125-61162927-4d88-40e2-9df2-8ff7170ee2d9.png"></p>
<p>æ”¹å˜æ€ç»´æ–¹å¼</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580275962784-b45e6758-929b-4781-ae93-fa62fcc2bdc0.png#align=left&display=inline&height=627&name=image.png&originHeight=1254&originWidth=2232&size=271910&status=done&style=none&width=1116"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580275979974-aeb59c89-4af7-49f3-bec0-339fa7357845.png#align=left&display=inline&height=627&name=image.png&originHeight=1254&originWidth=2236&size=417984&status=done&style=none&width=1118"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580276010435-18c12c8d-09cc-4fe8-9432-d04f0bd0aa4f.png#align=left&display=inline&height=626&name=image.png&originHeight=1252&originWidth=2234&size=356979&status=done&style=none&width=1117"></p>
<p>Single Source Of Truth: å•ä¸€æ•°æ®æº</p>
<p>ä¸æ–­çš„è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580276117575-bf72a3c3-3b3c-4531-881f-2f21d8fed80a.png#align=left&display=inline&height=617&name=image.png&originHeight=1234&originWidth=2224&size=447585&status=done&style=none&width=1112"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580276289023-4bda0d52-a530-4848-9161-5a66fd9c11e0.png#align=left&display=inline&height=621&name=image.png&originHeight=1242&originWidth=2224&size=446544&status=done&style=none&width=1112"></p>
<h3 id="1-2-è¯¾ç¨‹ä»‹ç»-07-12"><a href="#1-2-è¯¾ç¨‹ä»‹ç»-07-12" class="headerlink" title="1-2 è¯¾ç¨‹ä»‹ç» (07:12)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21050">1-2 è¯¾ç¨‹ä»‹ç» (07:12)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580278369748-7882e0d6-eca7-4558-8d6c-93bb7cc2aad0.png#align=left&display=inline&height=692&name=image.png&originHeight=1384&originWidth=2496&size=185733&status=done&style=none&width=1248"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580276550045-7d46ea6d-c7f4-4916-aa1e-1e073c03fab7.png#align=left&display=inline&height=622&name=image.png&originHeight=1244&originWidth=2232&size=881348&status=done&style=none&width=1116"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580276609094-0e526664-816d-4383-83e8-366a06ed5f5e.png#align=left&display=inline&height=623&name=image.png&originHeight=1246&originWidth=2214&size=402740&status=done&style=none&width=1107"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580276710900-a1ba2337-c082-4fd1-9a34-fe6d6fe7c98e.png#align=left&display=inline&height=622&name=image.png&originHeight=1244&originWidth=2216&size=432044&status=done&style=none&width=1108"></p>
<h2 id="ç¬¬-2-ç« -æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿä½•æ—¶ç”¨ï¼Ÿå¦‚ä½•ä¸å‡ºé—®é¢˜ï¼Ÿ"><a href="#ç¬¬-2-ç« -æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿä½•æ—¶ç”¨ï¼Ÿå¦‚ä½•ä¸å‡ºé—®é¢˜ï¼Ÿ" class="headerlink" title="ç¬¬ 2 ç«  æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿä½•æ—¶ç”¨ï¼Ÿå¦‚ä½•ä¸å‡ºé—®é¢˜ï¼Ÿ"></a>ç¬¬ 2 ç«  æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿä½•æ—¶ç”¨ï¼Ÿå¦‚ä½•ä¸å‡ºé—®é¢˜ï¼Ÿ</h2><blockquote>
<p>æ‰‹æŠŠæ‰‹å¸¦ç€ Codingï¼Œè§£å†³åŸºæœ¬æ¦‚å¿µã€API ä»¥åŠè®² 4 ä¸ªå…³é”®åº”ç”¨åœºæ™¯ã€‚ä»¥åŠå·¥ä½œä¸­å¹¶å‘åœºæ™¯ï¼Œå¦‚ä½•ä¸å‡ºé—®é¢˜ã€‚</p>
</blockquote>
<h3 id="2-1-ThreadLocal-æ˜¯ä»€ä¹ˆ-07-41"><a href="#2-1-ThreadLocal-æ˜¯ä»€ä¹ˆ-07-41" class="headerlink" title="2-1 ThreadLocal æ˜¯ä»€ä¹ˆ (07:41)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21051">2-1 ThreadLocal æ˜¯ä»€ä¹ˆ (07:41)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580288706984-af27ec24-eb3c-4f42-bfa4-fa13c6a6ec0f.png#align=left&display=inline&height=627&name=image.png&originHeight=1254&originWidth=2232&size=427456&status=done&style=none&width=1116"><br>ä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªçº¿ç¨‹</p>
<p>å®šä¹‰ï¼šæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ï¼›ä¸€ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œåˆ†åˆ«æœ‰ç‹¬ç«‹çš„å€¼ï¼ˆå‰¯æœ¬ï¼‰</p>
<p>ç‰¹ç‚¹ï¼šç®€å•ï¼ˆå¼€ç®±å³ç”¨ï¼‰ã€å¿«é€Ÿï¼ˆæ— é¢å¤–å¼€é”€ï¼‰ã€å®‰å…¨ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</p>
<p>åœºæ™¯ï¼šå¤šçº¿ç¨‹åœºæ™¯ï¼ˆèµ„æºæŒæœ‰ã€çº¿ç¨‹ä¸€è‡´æ€§ã€å¹¶å‘è®¡ç®—ã€çº¿ç¨‹å®‰å…¨ç­‰åœºæ™¯ï¼‰</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580288806795-24533713-bf54-4292-a3c5-c5d2c49a67ed.png#align=left&display=inline&height=619&name=image.png&originHeight=1238&originWidth=2216&size=255050&status=done&style=none&width=1108"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580288867098-1fb65509-be85-4b50-b451-9bb9d346b2bc.png#align=left&display=inline&height=619&name=image.png&originHeight=1238&originWidth=2126&size=458725&status=done&style=none&width=1063"></p>
<p>è¿›ç¨‹ -&gt; çº¿ç¨‹è¡¨ -&gt; çº¿ç¨‹å±€éƒ¨å˜é‡</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580288980102-967ec446-b7d3-4666-b9d1-9649fa9fd0bb.png#align=left&display=inline&height=622&name=image.png&originHeight=1244&originWidth=2130&size=345881&status=done&style=none&width=1065"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580289036685-f40570c6-4594-4704-84a2-efd8dbff201e.png#align=left&display=inline&height=613&name=image.png&originHeight=1226&originWidth=2144&size=317384&status=done&style=none&width=1072"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580289099956-50937959-c293-4e59-835b-8a7724123a23.png#align=left&display=inline&height=616&name=image.png&originHeight=1232&originWidth=2212&size=189130&status=done&style=none&width=1106"></p>
<h3 id="2-2-ThreadLocal-åŸºæœ¬-API-07-52"><a href="#2-2-ThreadLocal-åŸºæœ¬-API-07-52" class="headerlink" title="2-2 ThreadLocal åŸºæœ¬ API (07:52)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21052">2-2 ThreadLocal åŸºæœ¬ API (07:52)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580289189869-ccc0bd89-aca7-4327-8445-f87599491497.png#align=left&display=inline&height=623&name=image.png&originHeight=1246&originWidth=2218&size=241348&status=done&style=none&width=1109"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Basic</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ThreadLocal&lt;T&gt;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; x = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Long&gt;()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Long <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Initial Value run..&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Thread.currentThread().getId();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(x.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">        x.set(<span class="number">107L</span>);</span><br><span class="line">        <span class="comment">// ç§»é™¤å½“å‰çº¿ç¨‹ä¸Šçš„ThreadLocalçš„å€¼</span></span><br><span class="line">        x.remove();</span><br><span class="line">         <span class="comment">/*</span></span><br><span class="line"><span class="comment">            getæ“ä½œä¼šå»¶è¿ŸåŠ è½½ï¼Œå¦‚æœä¸get,ä¸ä¼šè§¦å‘initialValue</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(x.get());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-ThreadLocal-çš„-4-ç§æ ¸å¿ƒåœºæ™¯-07-51"><a href="#2-3-ThreadLocal-çš„-4-ç§æ ¸å¿ƒåœºæ™¯-07-51" class="headerlink" title="2-3 ThreadLocal çš„ 4 ç§æ ¸å¿ƒåœºæ™¯ (07:51)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21053">2-3 ThreadLocal çš„ 4 ç§æ ¸å¿ƒåœºæ™¯ (07:51)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580290263718-4fb89baa-ad2f-429b-b9ac-eb94b60c9dc6.png#align=left&display=inline&height=627&name=image.png&originHeight=1254&originWidth=2224&size=501168&status=done&style=none&width=1112"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580290374565-e131ace0-780a-4e21-bd55-6fd1b8904103.png#align=left&display=inline&height=622&name=image.png&originHeight=1244&originWidth=2204&size=639857&status=done&style=none&width=1102"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580290441950-be7e1bdc-0dbc-4526-bd3f-3237912c493c.png#align=left&display=inline&height=622&name=image.png&originHeight=1244&originWidth=2206&size=727609&status=done&style=none&width=1103"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580290496982-ed04a47b-83d7-46a6-9929-50178a711b18.png#align=left&display=inline&height=619&name=image.png&originHeight=1238&originWidth=2220&size=819485&status=done&style=none&width=1110"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580290545374-3416923f-85e1-4714-8548-44c517809032.png#align=left&display=inline&height=615&name=image.png&originHeight=1230&originWidth=2202&size=502164&status=done&style=none&width=1101"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580290576400-243357b0-d684-4a52-8b14-c2e419a2678e.png#align=left&display=inline&height=618&name=image.png&originHeight=1236&originWidth=2202&size=197988&status=done&style=none&width=1101"><br>æ€»ç»“ï¼š</p>
<ul>
<li>æŒæœ‰èµ„æºâ€”â€”æŒæœ‰çº¿ç¨‹èµ„æºä¾›çº¿ç¨‹çš„å„ä¸ªéƒ¨åˆ†ä½¿ç”¨ï¼Œå…¨å±€è·å–ï¼Œå‡å°‘<strong>ç¼–ç¨‹éš¾åº¦</strong></li>
<li>çº¿ç¨‹ä¸€è‡´â€”â€”å¸®åŠ©éœ€è¦ä¿æŒçº¿ç¨‹ä¸€è‡´çš„èµ„æºï¼ˆå¦‚æ•°æ®åº“äº‹åŠ¡ï¼‰ç»´æŠ¤ä¸€è‡´æ€§ï¼Œé™ä½<strong>ç¼–ç¨‹éš¾åº¦</strong></li>
<li>çº¿ç¨‹å®‰å…¨â€”â€”å¸®åŠ©åªè€ƒè™‘äº†å•çº¿ç¨‹çš„ç¨‹åºåº“ï¼Œæ— ç¼å‘å¤šçº¿ç¨‹åœºæ™¯è¿ç§»</li>
<li>åˆ†å¸ƒå¼è®¡ç®—â€”â€”å¸®åŠ©åˆ†å¸ƒå¼è®¡ç®—åœºæ™¯çš„å„ä¸ªçº¿ç¨‹ç´¯è®¡å±€éƒ¨è®¡ç®—ç»“æœã€‚</li>
</ul>
<h3 id="2-4-Thread-Local-å¹¶å‘åœºæ™¯åˆ†æ-01-16-50"><a href="#2-4-Thread-Local-å¹¶å‘åœºæ™¯åˆ†æ-01-16-50" class="headerlink" title="2-4 Thread Local å¹¶å‘åœºæ™¯åˆ†æ 01 (16:50)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21062">2-4 Thread Local å¹¶å‘åœºæ™¯åˆ†æ 01 (16:50)</a></h3><blockquote>
<p>ä»£ç åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/gaohanghang/spring-threadlocal-demo">https://github.com/gaohanghang/spring-threadlocal-demo</a></p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580291505762-1356c133-268b-4682-810e-d08be5e7e06e.png#align=left&display=inline&height=612&name=image.png&originHeight=1224&originWidth=2220&size=337821&status=done&style=none&width=1110"></p>
<p>MAC ç³»ç»Ÿä¸Šå®‰è£… Apache ab æµ‹è¯•å·¥å…·æ•™ç¨‹åœ°å€: <a target="_blank" rel="noopener" href="https://www.cnblogs.com/cjsblog/p/10506647.html">https://www.cnblogs.com/cjsblog/p/10506647.html</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install apr</span><br><span class="line">brew install pcre</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/stat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">stat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        c++;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ab -n 10000 -c 1 localhost:8080/add</span><br><span class="line"></span><br><span class="line">curl localhost:8080/stat</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580314416673-2323b785-9537-45de-a473-44f1ac2f5092.png#align=left&display=inline&height=574&name=image.png&originHeight=1148&originWidth=2042&size=587690&status=done&style=none&width=1021"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580314502980-1a7d6b25-0e9c-402f-8b12-8816f9ec6167.png#align=left&display=inline&height=565&name=image.png&originHeight=1130&originWidth=2034&size=504701&status=done&style=none&width=1017"></p>
<p><strong>ä½¿ç”¨ Synchronized</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">void</span>  <span class="title function_">__add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        c++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/stat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">stat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//Thread.sleep(100);</span></span><br><span class="line">        <span class="comment">//c++;</span></span><br><span class="line">        __add();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨synchronizeåæµ‹è¯•</span><br><span class="line"></span><br><span class="line">ab -n <span class="number">100</span> -c <span class="number">100</span> localhost:<span class="number">8080</span>/add</span><br><span class="line"></span><br><span class="line">curl localhost:<span class="number">8080</span>/stat</span><br></pre></td></tr></table></figure>

<p><strong>ä½¿ç”¨ ThreadLocal</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> ThreadLocal&lt;Integer&gt; c = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Integer <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">__add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        c.set(c.get() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/stat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">stat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> c.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        __add();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ThreadLocal</span><br><span class="line"></span><br><span class="line">ab -n 10000 -c 100 localhost:8080/add</span><br><span class="line"></span><br><span class="line">curl localhost:8080/stat</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580315440114-b0080698-a2fd-4443-8558-2487fb855568.png#align=left&display=inline&height=569&name=image.png&originHeight=1138&originWidth=2032&size=281450&status=done&style=none&width=1016"></p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>åŸºäºçº¿ç¨‹æ± æ¨¡å‹ synchronizeï¼ˆæ’é˜Ÿæ“ä½œå¾ˆ<strong>å±é™©</strong>ï¼‰</li>
<li>ç”¨ ThreadLocal æ”¶é›†æ•°æ®å¾ˆå¿«ä¸”å®‰å…¨</li>
<li>æ€è€ƒï¼šå¦‚ä½•åœ¨å¤šä¸ª ThreadLocal ä¸­æ”¶é›†æ•°æ®ï¼Ÿ</li>
</ul>
<h3 id="2-5-ThreadLocal-åœºæ™¯åˆ†æâ€”â€”å‡å°‘åŒæ­¥-10-10"><a href="#2-5-ThreadLocal-åœºæ™¯åˆ†æâ€”â€”å‡å°‘åŒæ­¥-10-10" class="headerlink" title="2-5 ThreadLocal åœºæ™¯åˆ†æâ€”â€”å‡å°‘åŒæ­¥ (10:10)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21054">2-5 ThreadLocal åœºæ™¯åˆ†æâ€”â€”å‡å°‘åŒæ­¥ (10:10)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580316239145-3cf3dcf9-ffc9-4593-85a4-7bf84d7cce54.png#align=left&display=inline&height=572&name=image.png&originHeight=1144&originWidth=2044&size=397731&status=done&style=none&width=1022"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StartController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> HashSet&lt;Val&lt;Integer&gt;&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">addSet</span><span class="params">(Val&lt;Integer&gt; v)</span> &#123;</span><br><span class="line">        set.add(v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> ThreadLocal&lt;Val&lt;Integer&gt;&gt; c = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Val&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Val&lt;Integer&gt; <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            Val&lt;Integer&gt; v = <span class="keyword">new</span> <span class="title class_">Val</span>&lt;&gt;();</span><br><span class="line">            v.set(<span class="number">0</span>);</span><br><span class="line">            addSet(v);</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">__add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        Val&lt;Integer&gt; v = c.get();</span><br><span class="line">        v.set(v.get() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/stat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">stat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> set.stream().map(x -&gt; x.get()).reduce((a,x) -&gt; a+x).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        __add();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ThreadLocal</span><br><span class="line"></span><br><span class="line">ab -n 10000 -c 100 localhost:8080/add</span><br><span class="line"></span><br><span class="line">ab -n 10000 -c 200 localhost:8080/add</span><br><span class="line"></span><br><span class="line">curl localhost:8080/stat</span><br></pre></td></tr></table></figure>

<h4 id="é—®é¢˜ï¼šset-add-v-ä¸ºä»€ä¹ˆä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#é—®é¢˜ï¼šset-add-v-ä¸ºä»€ä¹ˆä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="é—®é¢˜ï¼šset.add(v); ä¸ºä»€ä¹ˆä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>é—®é¢˜ï¼šset.add(v); ä¸ºä»€ä¹ˆä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</h4><p>set æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œæ˜¯ä¸ªä¸´ç•ŒåŒº</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580319954534-1c4b8181-7003-4f21-ab7e-22d9148c42c4.png#align=left&display=inline&height=561&name=image.png&originHeight=1122&originWidth=2038&size=217511&status=done&style=none&width=1019"></p>
<h2 id="ç¬¬-3-ç« -ã€æå®¢è§†è§’ã€‘å¤§ç¥ä»¬æ€ä¹ˆç”¨-ThreadLocal-çš„"><a href="#ç¬¬-3-ç« -ã€æå®¢è§†è§’ã€‘å¤§ç¥ä»¬æ€ä¹ˆç”¨-ThreadLocal-çš„" class="headerlink" title="ç¬¬ 3 ç«  ã€æå®¢è§†è§’ã€‘å¤§ç¥ä»¬æ€ä¹ˆç”¨ ThreadLocal çš„"></a>ç¬¬ 3 ç«  ã€æå®¢è§†è§’ã€‘å¤§ç¥ä»¬æ€ä¹ˆç”¨ ThreadLocal çš„</h2><blockquote>
<p>æŒ‘é€‰äº† 3 ä¸ª Java é¢†åŸŸå½±å“æ·±è¿œçš„åº”ç”¨ï¼ŒSpring&#x2F;Mybatis&#x2F;Quartz ä¸­ä½¿ç”¨åˆ° ThreadLocal çš„æºç ï¼Œç†è§£å¤§ç¥ä»¬åœ¨æ€è€ƒä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆä¼šç”¨åˆ° ThreadLocalã€‚</p>
</blockquote>
<h3 id="3-1-æºç åˆ†æ-1-Quartz-SimpleSemaphore-06-42"><a href="#3-1-æºç åˆ†æ-1-Quartz-SimpleSemaphore-06-42" class="headerlink" title=" 3-1 æºç åˆ†æ 1-Quartz SimpleSemaphore (06:42)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21055"> 3-1 æºç åˆ†æ 1-Quartz SimpleSemaphore (06:42)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580320024738-8c1014f4-f24a-4274-b43a-74f006e47871.png#align=left&display=inline&height=572&name=image.png&originHeight=1144&originWidth=2048&size=464595&status=done&style=none&width=1024"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580480597184-8bb00b4d-e4f0-4796-8661-c7776d4f4f69.png#align=left&display=inline&height=570&name=image.png&originHeight=1140&originWidth=2050&size=268257&status=done&style=none&width=1025"></p>
<h3 id="3-2-æºç åˆ†æ-2-Mybatis-æ¡†æ¶ä¿æŒè¿æ¥æ± çº¿ç¨‹ä¸€è‡´-04-46"><a href="#3-2-æºç åˆ†æ-2-Mybatis-æ¡†æ¶ä¿æŒè¿æ¥æ± çº¿ç¨‹ä¸€è‡´-04-46" class="headerlink" title=" 3-2 æºç åˆ†æ 2 Mybatis æ¡†æ¶ä¿æŒè¿æ¥æ± çº¿ç¨‹ä¸€è‡´ (04:46)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21056"> 3-2 æºç åˆ†æ 2 Mybatis æ¡†æ¶ä¿æŒè¿æ¥æ± çº¿ç¨‹ä¸€è‡´ (04:46)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580480656665-5c6b3bd2-7bbf-4f2f-9d79-1ebe7c9ddc5d.png#align=left&display=inline&height=569&name=image.png&originHeight=1138&originWidth=2046&size=238863&status=done&style=none&width=1023"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580480753798-b8dec9f9-38ac-47ee-918c-a8ff7a616f15.png#align=left&display=inline&height=562&name=image.png&originHeight=1124&originWidth=2014&size=592110&status=done&style=none&width=1007"></p>
<p>Aï¼ˆAtomic)ï¼‰åŸå­æ€§ï¼Œæ“ä½œä¸å¯åˆ†å‰²ã€‚<br>Cï¼ˆConsistencyï¼‰ä¸€è‡´æ€§ï¼Œä»»ä½•æ—¶åˆ»æ•°æ®éƒ½èƒ½ä¿æŒä¸€è‡´ã€‚<br>Iï¼ˆIsolationï¼‰éš”ç¦»æ€§ï¼Œå¤šäº‹åŠ¡å¹¶å‘æ‰§è¡Œçš„æ—¶åºä¸å½±å“ç»“æœã€‚<br>Dï¼ˆDurabilityï¼‰æŒä¹…æ€§ï¼Œå¯¹æ•°æ®ç»“æ„çš„å­˜å‚¨æ˜¯æ°¸ä¹…çš„ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580480809105-a612ddc6-692b-404d-9b57-7f06932b6714.png#align=left&display=inline&height=576&name=image.png&originHeight=1152&originWidth=2052&size=587009&status=done&style=none&width=1026"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580480908510-db46cae0-7703-4ed9-a8f6-73bcc643f3f1.png#align=left&display=inline&height=561&name=image.png&originHeight=1122&originWidth=2038&size=339832&status=done&style=none&width=1019"></p>
<h3 id="3-3-æºç åˆ†æ-03-Spring-æ¡†æ¶å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒ-04-03"><a href="#3-3-æºç åˆ†æ-03-Spring-æ¡†æ¶å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒ-04-03" class="headerlink" title=" 3-3 æºç åˆ†æ 03 Spring æ¡†æ¶å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒ (04:03)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21057"> 3-3 æºç åˆ†æ 03 Spring æ¡†æ¶å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒ (04:03)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580480937973-1f716eb7-0cac-4e20-9859-84a14022418a.png#align=left&display=inline&height=576&name=image.png&originHeight=1152&originWidth=2060&size=309429&status=done&style=none&width=1030"></p>
<p>Aï¼ˆAtomic)ï¼‰åŸå­æ€§ï¼Œæ“ä½œä¸å¯åˆ†å‰²ã€‚<br>Cï¼ˆConsistencyï¼‰ä¸€è‡´æ€§ï¼Œä»»ä½•æ—¶åˆ»æ•°æ®éƒ½èƒ½ä¿æŒä¸€è‡´ã€‚<br>Iï¼ˆIsolationï¼‰éš”ç¦»æ€§ï¼Œå¤šäº‹åŠ¡å¹¶å‘æ‰§è¡Œçš„æ—¶åºä¸å½±å“ç»“æœã€‚<br>Dï¼ˆDurabilityï¼‰æŒä¹…æ€§ï¼Œå¯¹æ•°æ®ç»“æ„çš„å­˜å‚¨æ˜¯æ°¸ä¹…çš„ã€‚</p>
<p>Aï¼šè¦ä¹ˆå‘ç”Ÿï¼Œè¦ä¹ˆä¸å‘ç”Ÿ<br>Cï¼šè¦åšå¯¹ï¼Œåšé”™äº†ä¸ç®—<br>Iï¼šåŒæ—¶å‘ç”Ÿä¸¤ä¸ªäº‹åŠ¡ï¼Œä¸¤ä¸ªäº‹åŠ¡çš„ç»“æœèƒ½å¤Ÿå åŠ çš„ä¸€è‡´ï¼ŒåŒæ—¶æ‰£æ¬¾<br>Dï¼šæ•°æ®è¦è¢«æŒä¹…åŒ–ä¸‹æ¥</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580480961117-7fc34b99-03cc-415d-9e70-bbcfae2fa3ba.png#align=left&display=inline&height=571&name=image.png&originHeight=1142&originWidth=2028&size=625709&status=done&style=none&width=1014"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580481510627-18f0f872-f9ac-47e1-8ea3-b741be7cb046.png#align=left&display=inline&height=570&name=image.png&originHeight=1140&originWidth=2052&size=762508&status=done&style=none&width=1026"></p>
<p>context ç¯å¢ƒ</p>
<h2 id="ç¬¬-4-ç« -ã€è®¾è®¡è€…è§†è§’ã€‘æºç çº§å®ç°-amp-æºç åˆ†æ"><a href="#ç¬¬-4-ç« -ã€è®¾è®¡è€…è§†è§’ã€‘æºç çº§å®ç°-amp-æºç åˆ†æ" class="headerlink" title="ç¬¬ 4 ç«  ã€è®¾è®¡è€…è§†è§’ã€‘æºç çº§å®ç°&amp;æºç åˆ†æ"></a>ç¬¬ 4 ç«  ã€è®¾è®¡è€…è§†è§’ã€‘æºç çº§å®ç°&amp;æºç åˆ†æ</h2><h3 id="4-1-å®ç°è‡ªå·±çš„-ThreadLocal-12-16"><a href="#4-1-å®ç°è‡ªå·±çš„-ThreadLocal-12-16" class="headerlink" title="4-1 å®ç°è‡ªå·±çš„ ThreadLocal (12:16)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21058">4-1 å®ç°è‡ªå·±çš„ ThreadLocal (12:16)</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…±äº«ç©ºé—´</span></span><br><span class="line">    <span class="keyword">static</span> HashMap&lt;Thread, HashMap&lt;MyThreadLocal&lt;?&gt;, Object&gt;&gt; threadLocalMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰çº¿ç¨‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">static</span> HashMap&lt;MyThreadLocal&lt;?&gt;, Object&gt; getMap() &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­threadLocalMapæ˜¯å¦åŒ…å«å½“å‰çº¿ç¨‹ï¼Œä¸åŒ…å«å°±putè¿›å»</span></span><br><span class="line">        <span class="keyword">if</span> (!threadLocalMap.containsKey(thread)) &#123;</span><br><span class="line">            threadLocalMap.put(thread, <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;MyThreadLocal&lt;?&gt;,Object&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰threadçš„map</span></span><br><span class="line">        <span class="keyword">return</span> threadLocalMap.get(thread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> T <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        HashMap&lt;MyThreadLocal&lt;?&gt;, Object&gt; map = getMap();</span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(<span class="built_in">this</span>)) &#123;</span><br><span class="line">            map.put(<span class="built_in">this</span>, initialValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) map.get(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T v)</span> &#123;</span><br><span class="line">        HashMap&lt;MyThreadLocal&lt;?&gt;, Object&gt; map = getMap();</span><br><span class="line">        map.put(<span class="built_in">this</span>, v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> MyThreadLocal&lt;Long&gt; v = <span class="keyword">new</span> <span class="title class_">MyThreadLocal</span>&lt;Long&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Long <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Thread.currentThread().getId();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                System.out.println(v.get());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580483675589-0a208adc-46ae-4fff-9ebd-fc64c02dc357.png#align=left&display=inline&height=568&name=image.png&originHeight=1136&originWidth=2038&size=229596&status=done&style=none&width=1019"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580483873261-c5a9c11e-4bce-4036-ba6b-83c1be8d2354.png#align=left&display=inline&height=562&name=image.png&originHeight=1124&originWidth=2010&size=720211&status=done&style=none&width=1005"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThreadLocal</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">atomic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå¢</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">threadLocalHash</span> <span class="operator">=</span> atomic.addAndGet(<span class="number">0x61c88647</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…±äº«ç©ºé—´</span></span><br><span class="line">    <span class="keyword">static</span> HashMap&lt;Thread, HashMap&lt;Integer, Object&gt;&gt; threadLocalMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å½“å‰çº¿ç¨‹çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">static</span> HashMap&lt;Integer, Object&gt; <span class="title function_">getMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        <span class="comment">// åˆ¤æ–­threadLocalMapæ˜¯å¦åŒ…å«å½“å‰çº¿ç¨‹ï¼Œä¸åŒ…å«å°±putè¿›å»</span></span><br><span class="line">        <span class="keyword">if</span> (!threadLocalMap.containsKey(thread)) &#123;</span><br><span class="line">            threadLocalMap.put(thread, <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer,Object&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰threadçš„map</span></span><br><span class="line">        <span class="keyword">return</span> threadLocalMap.get(thread);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> T <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        HashMap&lt;Integer, Object&gt; map = getMap();</span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(<span class="built_in">this</span>.threadLocalHash)) &#123;</span><br><span class="line">            map.put(<span class="built_in">this</span>.threadLocalHash, initialValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) map.get(<span class="built_in">this</span>.threadLocalHash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T v)</span> &#123;</span><br><span class="line">        HashMap&lt;Integer, Object&gt; map = getMap();</span><br><span class="line">        map.put(<span class="built_in">this</span>.threadLocalHash, v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484136537-c1e80f1c-939c-46af-822b-125c74f57e87.png#align=left&display=inline&height=562&name=image.png&originHeight=1124&originWidth=2030&size=169190&status=done&style=none&width=1015"></p>
<h3 id="4-2-é€‰å­¦-HashTable-03-56"><a href="#4-2-é€‰å­¦-HashTable-03-56" class="headerlink" title="4-2 é€‰å­¦ HashTable (03:56)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21059">4-2 é€‰å­¦ HashTable (03:56)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484171303-3d7e5aad-5624-4c77-a432-d53884ae6737.png#align=left&display=inline&height=565&name=image.png&originHeight=1130&originWidth=2052&size=232707&status=done&style=none&width=1026"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484200988-5e508785-cccc-487a-ad6d-698632751a1d.png#align=left&display=inline&height=566&name=image.png&originHeight=1132&originWidth=2048&size=239436&status=done&style=none&width=1024"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484218568-c47dc413-cbe5-43e2-a3f6-dfd9eec12227.png#align=left&display=inline&height=569&name=image.png&originHeight=1138&originWidth=2036&size=291317&status=done&style=none&width=1018"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484285123-0481a94d-58fb-49a9-a2c4-5b8335bed850.png#align=left&display=inline&height=563&name=image.png&originHeight=1126&originWidth=2032&size=446459&status=done&style=none&width=1016"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484301949-0ed0c2c5-a3ee-401a-8542-732db42768d4.png#align=left&display=inline&height=569&name=image.png&originHeight=1138&originWidth=2030&size=459263&status=done&style=none&width=1015"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484324800-3a373548-7256-4ca1-97fa-46820e84226e.png#align=left&display=inline&height=566&name=image.png&originHeight=1132&originWidth=2018&size=591886&status=done&style=none&width=1009"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484354861-5a2a1f16-43f7-4717-8bec-d27620b84862.png#align=left&display=inline&height=563&name=image.png&originHeight=1126&originWidth=2028&size=292298&status=done&style=none&width=1014"></p>
<h3 id="4-3-ThreadLocal-æºç åˆ†æ-13-40"><a href="#4-3-ThreadLocal-æºç åˆ†æ-13-40" class="headerlink" title="4-3 ThreadLocal æºç åˆ†æ (13:40)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21060">4-3 ThreadLocal æºç åˆ†æ (13:40)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484527702-28ef0410-e0a0-46f5-adc2-5a90bfd24970.png#align=left&display=inline&height=557&name=image.png&originHeight=1114&originWidth=2020&size=107860&status=done&style=none&width=1010"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484551012-d5ea7531-350f-417c-891c-6c4ba5263ce1.png#align=left&display=inline&height=573&name=image.png&originHeight=1146&originWidth=2046&size=213460&status=done&style=none&width=1023"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580484900463-724b011e-2896-4b41-9e64-d08e64cc3d2c.png#align=left&display=inline&height=573&name=image.png&originHeight=1146&originWidth=2014&size=240650&status=done&style=none&width=1007"></p>
<h2 id="ç¬¬-5-ç« -å…¨è¯¾æ€»ç»“"><a href="#ç¬¬-5-ç« -å…¨è¯¾æ€»ç»“" class="headerlink" title="ç¬¬ 5 ç«  å…¨è¯¾æ€»ç»“"></a>ç¬¬ 5 ç«  å…¨è¯¾æ€»ç»“</h2><blockquote>
<p>ThreadLocal åªæ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®ç»“æ„ï¼Œå´å¼•å‡ºäº†è¿™ä¹ˆå¤šé—®é¢˜ï¼Œå¯è§çœŸç†å¸¸å¸¸éšè—åœ¨å®¹æ˜“å¿½è§†å¾®å°çš„åœ°æ–¹ï¼Œä¼˜ç§€çš„ç¨‹åºå‘˜ä¸ä»…ä»…è¦å¤§å±€è§‚å¼ºï¼Œè¿˜æ›´åŠ éœ€è¦ç£¨ç ºç»†èŠ‚â€”â€”å’Œè€å¸ˆä¸€èµ·æ€è€ƒæœªæ¥åº”è¯¥æ€æ ·å­¦ä¹ ï¼Ÿ</p>
</blockquote>
<h3 id="5-1-æ€»ç»“-04-19"><a href="#5-1-æ€»ç»“-04-19" class="headerlink" title="5-1 æ€»ç»“ (04:19)"></a><a target="_blank" rel="noopener" href="https://www.imooc.com/video/21061">5-1 æ€»ç»“ (04:19)</a></h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580485337565-f31c40ff-b84a-4f33-8ff8-b628202e48cb.png#align=left&display=inline&height=567&name=image.png&originHeight=1134&originWidth=2026&size=420477&status=done&style=none&width=1013"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580485355830-3090a27d-a641-4676-8fad-220822d83e49.png#align=left&display=inline&height=576&name=image.png&originHeight=1152&originWidth=2040&size=413193&status=done&style=none&width=1020"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580485395229-eb215f77-bc45-478d-899f-3460dad5e68f.png#align=left&display=inline&height=568&name=image.png&originHeight=1136&originWidth=2048&size=312242&status=done&style=none&width=1024"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1580485432351-6d32dcca-bba4-4724-9ef2-c128268f4c86.png#align=left&display=inline&height=566&name=image.png&originHeight=1132&originWidth=2054&size=241653&status=done&style=none&width=1027"></p>
<h4 id="ä¸€äº›å»ºè®®"><a href="#ä¸€äº›å»ºè®®" class="headerlink" title="ä¸€äº›å»ºè®®"></a>ä¸€äº›å»ºè®®</h4><ul>
<li>æ— è®ºå°†æ¥åˆ°ä»€ä¹ˆæ ·çš„é«˜åº¦ï¼Œæ°¸è¿œè®¤ä¸ºè‡ªå·±æ˜¯ä¸ªèœé¸¡ï¼šæ€»æœ‰æ¯”æˆ‘ä»¬å‰å®³çš„å¤§ç‰›ï¼Œæ°¸è¿œéƒ½å»å­¦ä¹ </li>
<li>ä¿æŒå…´è¶£ï¼Œä½“ä¼šä¹è¶£ï¼šæŠ•å…¥åœ¨å·¥ä½œä¸Šçš„æ—¶é—´æ˜¯å¾ˆå¤šçš„ï¼Œåœ¨å·¥ä½œä¸Šä¸€å®šè¦ä¿æŒå…´è¶£</li>
<li>æŠ€æœ¯åˆ›é€ æ˜¯æœ‰ä»·å€¼çš„ï¼ˆåˆ‡è®°ï¼‰ï¼šè‡ªå·±å°è¯•å»åˆ›é€ ï¼Œå°è¯•å­¦æ–°ä¸œè¥¿å»ç”¨</li>
</ul>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><blockquote>
<p>é¦–å…ˆæ„Ÿè°¢å¤§ä½¬çš„è¯¾ç¨‹åˆ†äº«ï¼Œé€šè¿‡è¯¾ç¨‹å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿</p>
<p>å¦å¤–æ˜¯æˆ‘æœ‰ä¸ªå…¬ä¼—å·ï¼Œå«ã€Šéª‡å®¢ä¸ç”»å®¶ã€‹ï¼Œæ¬¢è¿å¤§å®¶æ¥å…³æ³¨ ğŸ˜†</p>
<p>éª‡å®¢ä¸ç”»å®¶ï¼Œåç§°æ¥è‡ªä¹¦ç±ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹ï¼Œç”»å®¶å­¦ä¹ ç»˜ç”»çš„æ–¹æ³•æ˜¯åŠ¨æ‰‹å»ç”»ï¼Œéª‡å®¢å­¦ä¹ ç¼–ç¨‹çš„æ–¹æ³•ä¹Ÿæ˜¯åŠ¨æ‰‹å»å®è·µ</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2019/png/576791/1577433516700-202fdc3d-5019-4324-ae77-b7be287cc9a7.png#align=left&display=inline&height=500&name=image.png&originHeight=500&originWidth=900&size=177089&status=done&style=none&width=900"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">åŸåˆ›</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-å¦‚ä½•ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1-100ï¼Ÿ"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/19/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B01-100%EF%BC%9F/"
    >å¦‚ä½•ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°1--100ï¼Ÿ</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/19/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B01-100%EF%BC%9F/" class="article-date">
  <time datetime="2020-01-18T16:09:31.000Z" itemprop="datePublished">2020-01-19</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/Java_stud/article/details/82347135">https://blog.csdn.net/Java_stud/article/details/82347135</a></p>
<p>ä½œè€…ï¼š<a target="_blank" rel="noopener" href="https://me.csdn.net/Java_stud">å››ä¸¤æ•°å­—å…ˆç”Ÿ</a></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/gaohanghang/images/master/img/20200120200518.png"></p>
<p>wait()ï¼šä»¤å½“å‰çº¿ç¨‹æ”¾å¼ƒ CPU çš„èµ„æºï¼Œä½¿åˆ«çš„çº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«çš„èµ„æºï¼Œè€Œå½“å‰çš„çº¿ç¨‹æ’é˜Ÿç­‰å¾…å†æ¬¡å¯¹èµ„æºçš„è®¿é—®</p>
<p>notify()ï¼šå”¤é†’æ­£åœ¨æ’é˜Ÿçš„ç­‰å¾…çš„åŒæ­¥èµ„æºçš„çº¿ç¨‹ï¼Œ</p>
<p>notifyAll()ï¼šå”¤é†’æ­£åœ¨æ’é˜Ÿç­‰å¾…çš„æ‰€æœ‰çš„çº¿ç¨‹</p>
<p>åœ¨ java.lang.Objectï¼š</p>
<p>ç”¨è¿™ä¸‰ä¸ªæ–¹æ³•çš„æ³¨æ„ç‚¹ï¼š  åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥ä»£ç å—é‡Œ</p>
<p>ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹æ‰“å°1â€”-100.çº¿ç¨‹1å’Œçº¿ç¨‹2äº¤æ›¿æ‰“å°</p>
<p>åˆ†æï¼š </p>
<ol>
<li>æˆ‘å…ˆä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹æ‰“å°1â€”100ï¼Œï¼ˆå…ˆä¸ç”¨äº¤æ›¿æ‰“å°ï¼‰</li>
<li>ç„¶ååœ¨ä½¿ç”¨ä¸Šé¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œåœ¨ä»£ç é‡Œæ·»åŠ </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrintNum</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="comment">//å”¤é†’wait()çš„ä¸€ä¸ªæˆ–è€…æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">                notify();</span><br><span class="line">                <span class="keyword">if</span> (num &lt;= <span class="number">100</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + num);</span><br><span class="line">                    num++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PrintNum</span> <span class="variable">printNum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintNum</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(printNum);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(printNum);</span><br><span class="line"></span><br><span class="line">        t1.setName(<span class="string">&quot;ç”²&quot;</span>);</span><br><span class="line">        t2.setName(<span class="string">&quot;ä¹™&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>è¿è¡Œæ•ˆæœï¼š</strong></p>
<p><img src="https://raw.githubusercontent.com/gaohanghang/images/master/img/20200120200159.png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">å¤šçº¿ç¨‹</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-ç”¨å¥½Javaä¸­çš„æšä¸¾ï¼ŒçœŸçš„æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/18/%E7%94%A8%E5%A5%BDJava%E4%B8%AD%E7%9A%84%E6%9E%9A%E4%B8%BE%EF%BC%8C%E7%9C%9F%E7%9A%84%E6%B2%A1%E6%9C%89%E9%82%A3%E4%B9%88%E7%AE%80%E5%8D%95%EF%BC%81/"
    >ç”¨å¥½Javaä¸­çš„æšä¸¾ï¼ŒçœŸçš„æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/18/%E7%94%A8%E5%A5%BDJava%E4%B8%AD%E7%9A%84%E6%9E%9A%E4%B8%BE%EF%BC%8C%E7%9C%9F%E7%9A%84%E6%B2%A1%E6%9C%89%E9%82%A3%E4%B9%88%E7%AE%80%E5%8D%95%EF%BC%81/" class="article-date">
  <time datetime="2020-01-17T17:35:31.000Z" itemprop="datePublished">2020-01-18</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>æœ€è¿‘é‡çœ‹ Java æšä¸¾ï¼Œçœ‹åˆ°è¿™ç¯‡è§‰å¾—è¿˜ä¸é”™çš„æ–‡ç« ï¼Œäºæ˜¯ç®€å•ç¿»è¯‘å’Œå®Œå–„äº†ä¸€äº›å†…å®¹ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›ä½ ä»¬ä¹Ÿèƒ½æœ‰æ‰€æ”¶è·ã€‚å¦å¤–ï¼Œä¸è¦å¿˜äº†æ–‡æœ«è¿˜æœ‰è¡¥å……å“¦ï¼</p>
<p>ps: è¿™é‡Œå‘ä¸€ç¯‡æšä¸¾çš„æ–‡ç« ï¼Œä¹Ÿæ˜¯å› ä¸ºåé¢è¦å‘ä¸€ç¯‡éå¸¸å®ç”¨çš„å…³äº SpringBoot å…¨å±€å¼‚å¸¸å¤„ç†çš„æ¯”è¾ƒå¥½çš„å®è·µé‡Œé¢å°±ç”¨åˆ°äº†æšä¸¾ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ç”± JavaGuide ç¿»è¯‘ï¼Œ</p>
<p>å…¬ä¼—å·: JavaGuide,åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.baeldung.com/a-guide-to-java-enums">https://www.baeldung.com/a-guide-to-java-enums</a> ã€‚</p>
<p>è½¬è½½è¯·æ³¨æ˜ä¸Šé¢è¿™æ®µæ–‡å­—ã€‚</p>
</blockquote>
<h2 id="1-æ¦‚è§ˆ"><a href="#1-æ¦‚è§ˆ" class="headerlink" title="1.æ¦‚è§ˆ"></a><strong>1.æ¦‚è§ˆ</strong></h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»€ä¹ˆæ˜¯ Java æšä¸¾ï¼Œå®ƒä»¬è§£å†³äº†å“ªäº›é—®é¢˜ä»¥åŠå¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨  Java æšä¸¾å®ç°ä¸€äº›è®¾è®¡æ¨¡å¼ã€‚</p>
<p>enumå…³é”®å­—åœ¨ java5 ä¸­å¼•å…¥ï¼Œè¡¨ç¤ºä¸€ç§ç‰¹æ®Šç±»å‹çš„ç±»ï¼Œå…¶æ€»æ˜¯ç»§æ‰¿java.lang.Enumç±»ï¼Œæ›´å¤šå†…å®¹å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹å…¶å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>æšä¸¾åœ¨å¾ˆå¤šæ—¶å€™ä¼šå’Œå¸¸é‡æ‹¿æ¥å¯¹æ¯”ï¼Œå¯èƒ½å› ä¸ºæœ¬èº«æˆ‘ä»¬å¤§é‡å®é™…ä½¿ç”¨æšä¸¾çš„åœ°æ–¹å°±æ˜¯ä¸ºäº†æ›¿ä»£å¸¸é‡ã€‚é‚£ä¹ˆè¿™ç§æ–¹å¼ç”±ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ</p>
<p><strong>ä»¥è¿™ç§æ–¹å¼å®šä¹‰çš„å¸¸é‡ä½¿ä»£ç æ›´å…·å¯è¯»æ€§ï¼Œå…è®¸è¿›è¡Œç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œé¢„å…ˆè®°å½•å¯æ¥å—å€¼çš„åˆ—è¡¨ï¼Œå¹¶é¿å…ç”±äºä¼ å…¥æ— æ•ˆå€¼è€Œå¼•èµ·çš„æ„å¤–è¡Œä¸ºã€‚</strong></p>
<p>ä¸‹é¢ç¤ºä¾‹å®šä¹‰ä¸€ä¸ªç®€å•çš„æšä¸¾ç±»å‹ pizza è®¢å•çš„çŠ¶æ€ï¼Œå…±æœ‰ä¸‰ç§ ORDERED, READY, DELIVEREDçŠ¶æ€:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> shuang.kou.enumdemo.enumtest;</span><br><span class="line"></span><br><span class="line">publicenum PizzaStatus &#123;</span><br><span class="line">    ORDERED,</span><br><span class="line">    READY,</span><br><span class="line">    DELIVERED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä»£ç é¿å…äº†å®šä¹‰å¸¸é‡ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰å’Œ pizza è®¢å•çš„çŠ¶æ€çš„å¸¸é‡éƒ½ç»Ÿä¸€æ”¾åˆ°äº†ä¸€ä¸ªæšä¸¾ç±»å‹é‡Œé¢ã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(PizzaStatus.ORDERED.name());//ORDERED</span><br><span class="line">System.out.println(PizzaStatus.ORDERED);//ORDERED</span><br><span class="line">System.out.println(PizzaStatus.ORDERED.name().getClass());//class java.lang.String</span><br><span class="line">System.out.println(PizzaStatus.ORDERED.getClass());//class shuang.kou.enumdemo.enumtest.PizzaStatus</span><br></pre></td></tr></table></figure>

<h2 id="2-è‡ªå®šä¹‰æšä¸¾æ–¹æ³•"><a href="#2-è‡ªå®šä¹‰æšä¸¾æ–¹æ³•" class="headerlink" title="2.è‡ªå®šä¹‰æšä¸¾æ–¹æ³•"></a><strong>2.è‡ªå®šä¹‰æšä¸¾æ–¹æ³•</strong></h2><p>ç°åœ¨æˆ‘ä»¬å¯¹æšä¸¾æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œè®©æˆ‘ä»¬é€šè¿‡åœ¨æšä¸¾ä¸Šå®šä¹‰ä¸€äº›é¢å¤–çš„APIæ–¹æ³•ï¼Œå°†ä¸Šä¸€ä¸ªç¤ºä¾‹æå‡åˆ°ä¸€ä¸ªæ–°çš„æ°´å¹³ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">publicclass Pizza &#123;</span><br><span class="line">    <span class="keyword">private</span> PizzaStatus status;</span><br><span class="line">    publicenum PizzaStatus &#123;</span><br><span class="line">        ORDERED,</span><br><span class="line">        READY,</span><br><span class="line">        DELIVERED;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isDeliverable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (getStatus() == PizzaStatus.READY) &#123;</span><br><span class="line">            returntrue;</span><br><span class="line">        &#125;</span><br><span class="line">        returnfalse;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// Methods that set and get the status variable.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-ä½¿ç”¨-x3D-x3D-æ¯”è¾ƒæšä¸¾ç±»å‹"><a href="#3-ä½¿ç”¨-x3D-x3D-æ¯”è¾ƒæšä¸¾ç±»å‹" class="headerlink" title="3.ä½¿ç”¨ &#x3D;&#x3D; æ¯”è¾ƒæšä¸¾ç±»å‹"></a><strong>3.ä½¿ç”¨ &#x3D;&#x3D; æ¯”è¾ƒæšä¸¾ç±»å‹</strong></h2><p>ç”±äºæšä¸¾ç±»å‹ç¡®ä¿JVMä¸­ä»…å­˜åœ¨ä¸€ä¸ªå¸¸é‡å®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨â€œ &#x3D;&#x3D;â€è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå˜é‡ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼›æ­¤å¤–ï¼Œâ€œ &#x3D;&#x3D;â€è¿ç®—ç¬¦å¯æä¾›ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„å®‰å…¨æ€§ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸‹ä»£ç æ®µä¸­çš„è¿è¡Œæ—¶å®‰å…¨æ€§ï¼Œå…¶ä¸­â€œ &#x3D;&#x3D;â€è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒçŠ¶æ€ï¼Œå¹¶ä¸”å¦‚æœä¸¤ä¸ªå€¼å‡ä¸ºnull éƒ½ä¸ä¼šå¼•å‘ NullPointerExceptionã€‚ç›¸åï¼Œå¦‚æœä½¿ç”¨equalsæ–¹æ³•ï¼Œå°†æŠ›å‡º NullPointerExceptionï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(testPz.getStatus().equals(Pizza.PizzaStatus.DELIVERED));</span><br><span class="line">if(testPz.getStatus() == Pizza.PizzaStatus.DELIVERED);</span><br></pre></td></tr></table></figure>

<p>å¯¹äºç¼–è¯‘æ—¶å®‰å…¨æ€§ï¼Œæˆ‘ä»¬çœ‹å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œä¸¤ä¸ªä¸åŒæšä¸¾ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œä½¿ç”¨equalæ–¹æ³•æ¯”è¾ƒç»“æœç¡®å®šä¸ºtrueï¼Œå› ä¸ºgetStatusæ–¹æ³•çš„æšä¸¾å€¼ä¸å¦ä¸€ä¸ªç±»å‹æšä¸¾å€¼ä¸€è‡´ï¼Œä½†é€»è¾‘ä¸Šåº”è¯¥ä¸ºfalseã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨&#x3D;&#x3D;æ“ä½œç¬¦é¿å…ã€‚å› ä¸ºç¼–è¯‘å™¨ä¼šè¡¨ç¤ºç±»å‹ä¸å…¼å®¹é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if(testPz.getStatus().equals(TestColor.GREEN));</span><br><span class="line">if(testPz.getStatus() == TestColor.GREEN);</span><br></pre></td></tr></table></figure>

<h2 id="4-åœ¨-switch-è¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹"><a href="#4-åœ¨-switch-è¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹" class="headerlink" title="4.åœ¨ switch è¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹"></a><strong>4.åœ¨ switch è¯­å¥ä¸­ä½¿ç”¨æšä¸¾ç±»å‹</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public int getDeliveryTimeInDays() &#123;</span><br><span class="line">    switch (status) &#123;</span><br><span class="line">        case ORDERED: return5;</span><br><span class="line">        case READY: return2;</span><br><span class="line">        case DELIVERED: return0;</span><br><span class="line">    &#125;</span><br><span class="line">    return0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-æšä¸¾ç±»å‹çš„å±æ€§-æ–¹æ³•å’Œæ„é€ å‡½æ•°"><a href="#5-æšä¸¾ç±»å‹çš„å±æ€§-æ–¹æ³•å’Œæ„é€ å‡½æ•°" class="headerlink" title="5.æšä¸¾ç±»å‹çš„å±æ€§,æ–¹æ³•å’Œæ„é€ å‡½æ•°"></a><strong>5.æšä¸¾ç±»å‹çš„å±æ€§,æ–¹æ³•å’Œæ„é€ å‡½æ•°</strong></h2><blockquote>
<p>â€œ</p>
<p>æ–‡æœ«æœ‰æˆ‘(JavaGuide)çš„è¡¥å……ã€‚</p>
<p>â€</p>
</blockquote>
<p>ä½ å¯ä»¥é€šè¿‡åœ¨æšä¸¾ç±»å‹ä¸­å®šä¹‰å±æ€§,æ–¹æ³•å’Œæ„é€ å‡½æ•°è®©å®ƒå˜å¾—æ›´åŠ å¼ºå¤§ã€‚</p>
<p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ‰©å±•ä¸Šé¢çš„ç¤ºä¾‹ï¼Œå®ç°ä»æ¯”è¨çš„ä¸€ä¸ªé˜¶æ®µåˆ°å¦ä¸€ä¸ªé˜¶æ®µçš„è¿‡æ¸¡ï¼Œå¹¶äº†è§£å¦‚ä½•æ‘†è„±ä¹‹å‰ä½¿ç”¨çš„ifè¯­å¥å’Œswitchè¯­å¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">publicclass Pizza &#123;</span><br><span class="line"> </span><br><span class="line">    private PizzaStatus status;</span><br><span class="line">    publicenum PizzaStatus &#123;</span><br><span class="line">        ORDERED (5)&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean isOrdered() &#123;</span><br><span class="line">                returntrue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        READY (2)&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean isReady() &#123;</span><br><span class="line">                returntrue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        DELIVERED (0)&#123;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean isDelivered() &#123;</span><br><span class="line">                returntrue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"> </span><br><span class="line">        privateint timeToDelivery;</span><br><span class="line"> </span><br><span class="line">        public boolean isOrdered() &#123;returnfalse;&#125;</span><br><span class="line"> </span><br><span class="line">        public boolean isReady() &#123;returnfalse;&#125;</span><br><span class="line"> </span><br><span class="line">        public boolean isDelivered()&#123;returnfalse;&#125;</span><br><span class="line"> </span><br><span class="line">        public int getTimeToDelivery() &#123;</span><br><span class="line">            return timeToDelivery;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        PizzaStatus (int timeToDelivery) &#123;</span><br><span class="line">            this.timeToDelivery = timeToDelivery;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public boolean isDeliverable() &#123;</span><br><span class="line">        returnthis.status.isReady();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void printTimeToDeliver() &#123;</span><br><span class="line">        System.out.println(&quot;Time to delivery is &quot; +</span><br><span class="line">          this.getStatus().getTimeToDelivery());</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    // Methods that set and get the status variable.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢è¿™æ®µä»£ç å±•ç¤ºå®ƒæ˜¯å¦‚ä½• work çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void givenPizaOrder_whenReady_thenDeliverable() &#123;</span><br><span class="line">    Pizza testPz = new Pizza();</span><br><span class="line">    testPz.setStatus(Pizza.PizzaStatus.READY);</span><br><span class="line">    assertTrue(testPz.isDeliverable());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-EnumSet-and-EnumMap"><a href="#6-EnumSet-and-EnumMap" class="headerlink" title="6.EnumSet and EnumMap"></a><strong>6.EnumSet and EnumMap</strong></h2><h3 id="6-1-EnumSet"><a href="#6-1-EnumSet" class="headerlink" title="6.1. EnumSet"></a>6.1. EnumSet</h3><p><code>EnumSet</code> æ˜¯ä¸€ç§ä¸“é—¨ä¸ºæšä¸¾ç±»å‹æ‰€è®¾è®¡çš„ <code>Set</code> ç±»å‹ã€‚</p>
<p>ä¸<code>HashSet</code>ç›¸æ¯”ï¼Œç”±äºä½¿ç”¨äº†å†…éƒ¨ä½å‘é‡è¡¨ç¤ºï¼Œå› æ­¤å®ƒæ˜¯ç‰¹å®š <code>Enum</code> å¸¸é‡é›†çš„éå¸¸æœ‰æ•ˆä¸”ç´§å‡‘çš„è¡¨ç¤ºå½¢å¼ã€‚</p>
<p>å®ƒæä¾›äº†ç±»å‹å®‰å…¨çš„æ›¿ä»£æ–¹æ³•ï¼Œä»¥æ›¿ä»£ä¼ ç»Ÿçš„åŸºäºintçš„â€œä½æ ‡å¿—â€ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™æ›´æ˜“è¯»å’Œæ˜“äºç»´æŠ¤çš„ç®€æ´ä»£ç ã€‚</p>
<p><code>EnumSet</code> æ˜¯æŠ½è±¡ç±»ï¼Œå…¶æœ‰ä¸¤ä¸ªå®ç°ï¼š<code>RegularEnumSet</code> ã€<code>JumboEnumSet</code>ï¼Œé€‰æ‹©å“ªä¸€ä¸ªå–å†³äºå®ä¾‹åŒ–æ—¶æšä¸¾ä¸­å¸¸é‡çš„æ•°é‡ã€‚</p>
<p>åœ¨å¾ˆå¤šåœºæ™¯ä¸­çš„æšä¸¾å¸¸é‡é›†åˆæ“ä½œï¼ˆå¦‚ï¼šå–å­é›†ã€å¢åŠ ã€åˆ é™¤ã€<code>containsAll</code>å’Œ<code>removeAll</code>æ‰¹æ“ä½œï¼‰ä½¿ç”¨<code>EnumSet</code>éå¸¸åˆé€‚ï¼›å¦‚æœéœ€è¦è¿­ä»£æ‰€æœ‰å¯èƒ½çš„å¸¸é‡åˆ™ä½¿ç”¨<code>Enum.values()</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">publicclass Pizza &#123;</span><br><span class="line"> </span><br><span class="line">    privatestatic EnumSet&lt;PizzaStatus&gt; undeliveredPizzaStatuses =</span><br><span class="line">      EnumSet.of(PizzaStatus.ORDERED, PizzaStatus.READY);</span><br><span class="line"> </span><br><span class="line">    private PizzaStatus status;</span><br><span class="line"> </span><br><span class="line">    publicenum PizzaStatus &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public boolean isDeliverable() &#123;</span><br><span class="line">        returnthis.status.isReady();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void printTimeToDeliver() &#123;</span><br><span class="line">        System.out.println(&quot;Time to delivery is &quot; +</span><br><span class="line">          this.getStatus().getTimeToDelivery() + &quot; days&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public static List&lt;Pizza&gt; getAllUndeliveredPizzas(List&lt;Pizza&gt; input) &#123;</span><br><span class="line">        return input.stream().filter(</span><br><span class="line">          (s) -&gt; undeliveredPizzaStatuses.contains(s.getStatus()))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void deliver() &#123;</span><br><span class="line">        if (isDeliverable()) &#123;</span><br><span class="line">            PizzaDeliverySystemConfiguration.getInstance().getDeliveryStrategy()</span><br><span class="line">              .deliver(this);</span><br><span class="line">            this.setStatus(PizzaStatus.DELIVERED);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    // Methods that set and get the status variable.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„æµ‹è¯•æ¼”ç¤ºäº†å±•ç¤ºäº† <code>EnumSet</code> åœ¨æŸäº›åœºæ™¯ä¸‹çš„å¼ºå¤§åŠŸèƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void givenPizaOrders_whenRetrievingUnDeliveredPzs_thenCorrectlyRetrieved() &#123;</span><br><span class="line">    List&lt;Pizza&gt; pzList = new ArrayList&lt;&gt;();</span><br><span class="line">    Pizza pz1 = new Pizza();</span><br><span class="line">    pz1.setStatus(Pizza.PizzaStatus.DELIVERED);</span><br><span class="line"> </span><br><span class="line">    Pizza pz2 = new Pizza();</span><br><span class="line">    pz2.setStatus(Pizza.PizzaStatus.ORDERED);</span><br><span class="line"> </span><br><span class="line">    Pizza pz3 = new Pizza();</span><br><span class="line">    pz3.setStatus(Pizza.PizzaStatus.ORDERED);</span><br><span class="line"> </span><br><span class="line">    Pizza pz4 = new Pizza();</span><br><span class="line">    pz4.setStatus(Pizza.PizzaStatus.READY);</span><br><span class="line"> </span><br><span class="line">    pzList.add(pz1);</span><br><span class="line">    pzList.add(pz2);</span><br><span class="line">    pzList.add(pz3);</span><br><span class="line">    pzList.add(pz4);</span><br><span class="line"> </span><br><span class="line">    List&lt;Pizza&gt; undeliveredPzs = Pizza.getAllUndeliveredPizzas(pzList);</span><br><span class="line">    assertTrue(undeliveredPzs.size() == 3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-EnumMap"><a href="#6-2-EnumMap" class="headerlink" title="6.2. EnumMap"></a>6.2. EnumMap</h3><p><code>EnumMap</code>æ˜¯ä¸€ä¸ªä¸“é—¨åŒ–çš„æ˜ å°„å®ç°ï¼Œç”¨äºå°†æšä¸¾å¸¸é‡ç”¨ä½œé”®ã€‚ä¸å¯¹åº”çš„ <code>HashMap</code> ç›¸æ¯”ï¼Œå®ƒæ˜¯ä¸€ä¸ªé«˜æ•ˆç´§å‡‘çš„å®ç°ï¼Œå¹¶ä¸”åœ¨å†…éƒ¨è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°ç»„:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EnumMap&lt;Pizza.PizzaStatus, Pizza&gt; map;</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€ä¸ªçœŸå®çš„ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨å®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">publicstatic EnumMap&lt;PizzaStatus, List&lt;Pizza&gt;&gt;</span><br><span class="line">  groupPizzaByStatus(List&lt;Pizza&gt; pizzaList) &#123;</span><br><span class="line">    EnumMap&lt;PizzaStatus, List&lt;Pizza&gt;&gt; pzByStatus =</span><br><span class="line">      new EnumMap&lt;PizzaStatus, List&lt;Pizza&gt;&gt;(PizzaStatus.class);</span><br><span class="line">     </span><br><span class="line">    for (Pizza pz : pizzaList) &#123;</span><br><span class="line">        PizzaStatus status = pz.getStatus();</span><br><span class="line">        if (pzByStatus.containsKey(status)) &#123;</span><br><span class="line">            pzByStatus.get(status).add(pz);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            List&lt;Pizza&gt; newPzList = new ArrayList&lt;Pizza&gt;();</span><br><span class="line">            newPzList.add(pz);</span><br><span class="line">            pzByStatus.put(status, newPzList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return pzByStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„æµ‹è¯•æ¼”ç¤ºäº†å±•ç¤ºäº† <code>EnumMap</code> åœ¨æŸäº›åœºæ™¯ä¸‹çš„å¼ºå¤§åŠŸèƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void givenPizaOrders_whenGroupByStatusCalled_thenCorrectlyGrouped() &#123;</span><br><span class="line">    List&lt;Pizza&gt; pzList = new ArrayList&lt;&gt;();</span><br><span class="line">    Pizza pz1 = new Pizza();</span><br><span class="line">    pz1.setStatus(Pizza.PizzaStatus.DELIVERED);</span><br><span class="line"> </span><br><span class="line">    Pizza pz2 = new Pizza();</span><br><span class="line">    pz2.setStatus(Pizza.PizzaStatus.ORDERED);</span><br><span class="line"> </span><br><span class="line">    Pizza pz3 = new Pizza();</span><br><span class="line">    pz3.setStatus(Pizza.PizzaStatus.ORDERED);</span><br><span class="line"> </span><br><span class="line">    Pizza pz4 = new Pizza();</span><br><span class="line">    pz4.setStatus(Pizza.PizzaStatus.READY);</span><br><span class="line"> </span><br><span class="line">    pzList.add(pz1);</span><br><span class="line">    pzList.add(pz2);</span><br><span class="line">    pzList.add(pz3);</span><br><span class="line">    pzList.add(pz4);</span><br><span class="line"> </span><br><span class="line">    EnumMap&lt;Pizza.PizzaStatus,List&lt;Pizza&gt;&gt; map = Pizza.groupPizzaByStatus(pzList);</span><br><span class="line">    assertTrue(map.get(Pizza.PizzaStatus.DELIVERED).size() == 1);</span><br><span class="line">    assertTrue(map.get(Pizza.PizzaStatus.ORDERED).size() == 2);</span><br><span class="line">    assertTrue(map.get(Pizza.PizzaStatus.READY).size() == 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-é€šè¿‡æšä¸¾å®ç°ä¸€äº›è®¾è®¡æ¨¡å¼"><a href="#7-é€šè¿‡æšä¸¾å®ç°ä¸€äº›è®¾è®¡æ¨¡å¼" class="headerlink" title="7. é€šè¿‡æšä¸¾å®ç°ä¸€äº›è®¾è®¡æ¨¡å¼"></a><strong>7. é€šè¿‡æšä¸¾å®ç°ä¸€äº›è®¾è®¡æ¨¡å¼</strong></h2><h3 id="7-1-å•ä¾‹æ¨¡å¼"><a href="#7-1-å•ä¾‹æ¨¡å¼" class="headerlink" title="7.1 å•ä¾‹æ¨¡å¼"></a>7.1 å•ä¾‹æ¨¡å¼</h3><p>é€šå¸¸ï¼Œä½¿ç”¨ç±»å®ç° Singleton æ¨¡å¼å¹¶éæ˜“äº‹ï¼Œæšä¸¾æä¾›äº†ä¸€ç§å®ç°å•ä¾‹çš„ç®€ä¾¿æ–¹æ³•ã€‚</p>
<p>ã€ŠEffective Java ã€‹å’Œã€ŠJavaä¸æ¨¡å¼ã€‹éƒ½éå¸¸æ¨èè¿™ç§æ–¹å¼ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æ–¹å¼å®ç°æšä¸¾å¯ä»¥æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p>
<p>ã€ŠEffective Javaã€‹</p>
<blockquote>
<p>â€œ</p>
<p>è¿™ç§æ–¹æ³•åœ¨åŠŸèƒ½ä¸Šä¸å…¬æœ‰åŸŸæ–¹æ³•ç›¸è¿‘ï¼Œä½†æ˜¯å®ƒæ›´åŠ ç®€æ´ï¼Œæ— å¿æä¾›äº†åºåˆ—åŒ–æœºåˆ¶ï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ï¼Œå³ä½¿æ˜¯åœ¨é¢å¯¹å¤æ‚åºåˆ—åŒ–æˆ–è€…åå°„æ”»å‡»çš„æ—¶å€™ã€‚è™½ç„¶è¿™ç§æ–¹æ³•è¿˜æ²¡æœ‰å¹¿æ³›é‡‡ç”¨ï¼Œä½†æ˜¯å•å…ƒç´ çš„æšä¸¾ç±»å‹å·²ç»æˆä¸ºå®ç° Singletonçš„æœ€ä½³æ–¹æ³•ã€‚â€”-ã€ŠEffective Java ä¸­æ–‡ç‰ˆ ç¬¬äºŒç‰ˆã€‹</p>
<p>â€</p>
</blockquote>
<p>ã€ŠJavaä¸æ¨¡å¼ã€‹</p>
<blockquote>
<p>â€œ</p>
<p>ã€ŠJavaä¸æ¨¡å¼ã€‹ä¸­ï¼Œä½œè€…è¿™æ ·å†™é“ï¼Œä½¿ç”¨æšä¸¾æ¥å®ç°å•å®ä¾‹æ§åˆ¶ä¼šæ›´åŠ ç®€æ´ï¼Œè€Œä¸”æ— å¿åœ°æä¾›äº†åºåˆ—åŒ–æœºåˆ¶ï¼Œå¹¶ç”±JVMä»æ ¹æœ¬ä¸Šæä¾›ä¿éšœï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ï¼Œæ˜¯æ›´ç®€æ´ã€é«˜æ•ˆã€å®‰å…¨çš„å®ç°å•ä¾‹çš„æ–¹å¼ã€‚</p>
<p>â€</p>
</blockquote>
<p>ä¸‹é¢çš„ä»£ç æ®µæ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">publicenum PizzaDeliverySystemConfiguration &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    PizzaDeliverySystemConfiguration() &#123;</span><br><span class="line">        // Initialization configuration which involves</span><br><span class="line">        // overriding defaults like delivery strategy</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private PizzaDeliveryStrategy deliveryStrategy = PizzaDeliveryStrategy.NORMAL;</span><br><span class="line"> </span><br><span class="line">    public static PizzaDeliverySystemConfiguration getInstance() &#123;</span><br><span class="line">        return INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public PizzaDeliveryStrategy getDeliveryStrategy() &#123;</span><br><span class="line">        return deliveryStrategy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PizzaDeliveryStrategy deliveryStrategy = PizzaDeliverySystemConfiguration.getInstance().getDeliveryStrategy();</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ <code>PizzaDeliverySystemConfiguration.getInstance()</code> è·å–çš„å°±æ˜¯å•ä¾‹çš„ <code>PizzaDeliverySystemConfiguration</code></p>
<h3 id="7-2-ç­–ç•¥æ¨¡å¼"><a href="#7-2-ç­–ç•¥æ¨¡å¼" class="headerlink" title="7.2 ç­–ç•¥æ¨¡å¼"></a>7.2 ç­–ç•¥æ¨¡å¼</h3><p>é€šå¸¸ï¼Œç­–ç•¥æ¨¡å¼ç”±ä¸åŒç±»å®ç°åŒä¸€ä¸ªæ¥å£æ¥å®ç°çš„ã€‚</p>
<p>è¿™ä¹Ÿå°±æ„å‘³ç€æ·»åŠ æ–°ç­–ç•¥æ„å‘³ç€æ·»åŠ æ–°çš„å®ç°ç±»ã€‚ä½¿ç”¨æšä¸¾ï¼Œå¯ä»¥è½»æ¾å®Œæˆæ­¤ä»»åŠ¡ï¼Œæ·»åŠ æ–°çš„å®ç°æ„å‘³ç€åªå®šä¹‰å…·æœ‰æŸä¸ªå®ç°çš„å¦ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç æ®µæ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨æšä¸¾å®ç°ç­–ç•¥æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">publicenum PizzaDeliveryStrategy &#123;</span><br><span class="line">    EXPRESS &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void deliver(Pizza pz) &#123;</span><br><span class="line">            System.out.println(&quot;Pizza will be delivered in express mode&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    NORMAL &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void deliver(Pizza pz) &#123;</span><br><span class="line">            System.out.println(&quot;Pizza will be delivered in normal mode&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    public abstract void deliver(Pizza pz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»™ <code>Pizza</code>å¢åŠ ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void deliver() &#123;</span><br><span class="line">    if (isDeliverable()) &#123;</span><br><span class="line">        PizzaDeliverySystemConfiguration.getInstance().getDeliveryStrategy()</span><br><span class="line">          .deliver(this);</span><br><span class="line">        this.setStatus(PizzaStatus.DELIVERED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿè¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void givenPizaOrder_whenDelivered_thenPizzaGetsDeliveredAndStatusChanges() &#123;</span><br><span class="line">    Pizza pz = new Pizza();</span><br><span class="line">    pz.setStatus(Pizza.PizzaStatus.READY);</span><br><span class="line">    pz.deliver();</span><br><span class="line">    assertTrue(pz.getStatus() == Pizza.PizzaStatus.DELIVERED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-Java-8-ä¸æšä¸¾"><a href="#8-Java-8-ä¸æšä¸¾" class="headerlink" title="8. Java 8 ä¸æšä¸¾"></a><strong>8. Java 8 ä¸æšä¸¾</strong></h2><p>Pizza ç±»å¯ä»¥ç”¨Java 8é‡å†™ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ–¹æ³• lambda å’ŒStream APIå¦‚ä½•ä½¿ <code>getAllUndeliveredPizzasï¼ˆï¼‰</code>å’Œ<code>groupPizzaByStatusï¼ˆï¼‰</code>æ–¹æ³•å˜å¾—å¦‚æ­¤ç®€æ´ï¼š</p>
<p><code>getAllUndeliveredPizzasï¼ˆï¼‰</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Pizza&gt; <span class="title function_">getAllUndeliveredPizzas</span><span class="params">(List&lt;Pizza&gt; input)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> input.stream().filter(</span><br><span class="line">      (s) -&gt; !deliveredPizzaStatuses.contains(s.getStatus()))</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>groupPizzaByStatusï¼ˆï¼‰</code> :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">publicstatic EnumMap&lt;PizzaStatus, List&lt;Pizza&gt;&gt;</span><br><span class="line">  <span class="title function_">groupPizzaByStatus</span><span class="params">(List&lt;Pizza&gt; pzList)</span> &#123;</span><br><span class="line">    EnumMap&lt;PizzaStatus, List&lt;Pizza&gt;&gt; map = pzList.stream().collect(</span><br><span class="line">      Collectors.groupingBy(Pizza::getStatus,</span><br><span class="line">      () -&gt; <span class="keyword">new</span> <span class="title class_">EnumMap</span>&lt;&gt;(PizzaStatus.class), Collectors.toList()));</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-Enum-ç±»å‹çš„-JSON-è¡¨ç°å½¢å¼"><a href="#9-Enum-ç±»å‹çš„-JSON-è¡¨ç°å½¢å¼" class="headerlink" title="9. Enum ç±»å‹çš„ JSON è¡¨ç°å½¢å¼"></a><strong>9. Enum ç±»å‹çš„ JSON è¡¨ç°å½¢å¼</strong></h2><p>ä½¿ç”¨Jacksonåº“ï¼Œå¯ä»¥å°†æšä¸¾ç±»å‹çš„JSONè¡¨ç¤ºä¸ºPOJOã€‚ä¸‹é¢çš„ä»£ç æ®µæ˜¾ç¤ºäº†å¯ä»¥ç”¨äºåŒä¸€ç›®çš„çš„Jacksonæ‰¹æ³¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(shape = JsonFormat.Shape.OBJECT)</span></span><br><span class="line">publicenum PizzaStatus &#123;</span><br><span class="line">    ORDERED (<span class="number">5</span>)&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isOrdered</span><span class="params">()</span> &#123;</span><br><span class="line">            returntrue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    READY (<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isReady</span><span class="params">()</span> &#123;</span><br><span class="line">            returntrue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    DELIVERED (<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isDelivered</span><span class="params">()</span> &#123;</span><br><span class="line">            returntrue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    privateint timeToDelivery;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isOrdered</span><span class="params">()</span> &#123;<span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isReady</span><span class="params">()</span> &#123;<span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isDelivered</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@JsonProperty(&quot;timeToDelivery&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTimeToDelivery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> timeToDelivery;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">PizzaStatus</span> <span class="params">(<span class="type">int</span> timeToDelivery)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.timeToDelivery = timeToDelivery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼ä½¿ç”¨ <code>Pizza</code> å’Œ <code>PizzaStatus</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pizza pz = new Pizza();</span><br><span class="line">pz.setStatus(Pizza.PizzaStatus.READY);</span><br><span class="line">System.out.println(Pizza.getJsonString(pz));</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆ Pizza çŠ¶æ€ä»¥ä»¥ä¸‹JSONå±•ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;status&quot; : &#123;</span><br><span class="line">    &quot;timeToDelivery&quot; : 2,</span><br><span class="line">    &quot;ready&quot; : true,</span><br><span class="line">    &quot;ordered&quot; : false,</span><br><span class="line">    &quot;delivered&quot; : false</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;deliverable&quot; : true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰å…³æšä¸¾ç±»å‹çš„JSONåºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ï¼‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Jackson-å°†æšä¸¾åºåˆ—åŒ–ä¸ºJSONå¯¹è±¡ã€‚</p>
<h2 id="10-æ€»ç»“"><a href="#10-æ€»ç»“" class="headerlink" title="10.æ€»ç»“"></a><strong>10.æ€»ç»“</strong></h2><p>æœ¬æ–‡æˆ‘ä»¬è®¨è®ºäº†Javaæšä¸¾ç±»å‹ï¼Œä»åŸºç¡€çŸ¥è¯†åˆ°é«˜çº§åº”ç”¨ä»¥åŠå®é™…åº”ç”¨åœºæ™¯ï¼Œè®©æˆ‘ä»¬æ„Ÿå—åˆ°æšä¸¾çš„å¼ºå¤§åŠŸèƒ½ã€‚</p>
<h2 id="11-è¡¥å……"><a href="#11-è¡¥å……" class="headerlink" title="11. è¡¥å……"></a><strong>11. è¡¥å……</strong></h2><p>æˆ‘ä»¬åœ¨ä¸Šé¢è®²åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æšä¸¾ç±»å‹ä¸­å®šä¹‰å±æ€§,æ–¹æ³•å’Œæ„é€ å‡½æ•°è®©å®ƒå˜å¾—æ›´åŠ å¼ºå¤§ã€‚</p>
<p>ä¸‹é¢æˆ‘é€šè¿‡ä¸€ä¸ªå®é™…çš„ä¾‹å­å±•ç¤ºä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨çŸ­ä¿¡éªŒè¯ç çš„æ—¶å€™å¯èƒ½æœ‰å‡ ç§ä¸åŒçš„ç”¨é€”ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢è¿™æ ·å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">publicenum PinType &#123;</span><br><span class="line"></span><br><span class="line">    REGISTER(100000, &quot;æ³¨å†Œä½¿ç”¨&quot;),</span><br><span class="line">    FORGET_PASSWORD(100001, &quot;å¿˜è®°å¯†ç ä½¿ç”¨&quot;),</span><br><span class="line">    UPDATE_PHONE_NUMBER(100002, &quot;æ›´æ–°æ‰‹æœºå·ç ä½¿ç”¨&quot;);</span><br><span class="line"></span><br><span class="line">    privatefinalint code;</span><br><span class="line">    privatefinal String message;</span><br><span class="line"></span><br><span class="line">    PinType(int code, String message) &#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">        this.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMessage() &#123;</span><br><span class="line">        return message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return&quot;PinType&#123;&quot; +</span><br><span class="line">                &quot;code=&quot; + code +</span><br><span class="line">                &quot;, message=&#x27;&quot; + message + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(PinType.FORGET_PASSWORD.getCode());</span><br><span class="line">System.out.println(PinType.FORGET_PASSWORD.getMessage());</span><br><span class="line">System.out.println(PinType.FORGET_PASSWORD.toString());</span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">100001</span><br><span class="line">å¿˜è®°å¯†ç ä½¿ç”¨</span><br><span class="line">PinType&#123;code=100001, message=&#x27;å¿˜è®°å¯†ç ä½¿ç”¨&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„è¯ï¼Œåœ¨å®é™…ä½¿ç”¨èµ·æ¥å°±ä¼šéå¸¸çµæ´»æ–¹ä¾¿ï¼</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Rediså’Œmysqlæ•°æ®æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´çš„ï¼Ÿ"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/13/Redis%E5%92%8Cmysql%E6%95%B0%E6%8D%AE%E6%80%8E%E4%B9%88%E4%BF%9D%E6%8C%81%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E7%9A%84%EF%BC%9F/"
    >Rediså’Œmysqlæ•°æ®æ€ä¹ˆä¿æŒæ•°æ®ä¸€è‡´çš„ï¼Ÿ</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/13/Redis%E5%92%8Cmysql%E6%95%B0%E6%8D%AE%E6%80%8E%E4%B9%88%E4%BF%9D%E6%8C%81%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E7%9A%84%EF%BC%9F/" class="article-date">
  <time datetime="2020-01-13T11:03:21.000Z" itemprop="datePublished">2020-01-13</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="éœ€æ±‚èµ·å› "><a href="#éœ€æ±‚èµ·å› " class="headerlink" title="éœ€æ±‚èµ·å› "></a>éœ€æ±‚èµ·å› </h2><p>åœ¨é«˜å¹¶å‘çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ•°æ®åº“å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯ç”¨æˆ·å¹¶å‘è®¿é—®æœ€è–„å¼±çš„ç¯èŠ‚ã€‚æ‰€ä»¥ï¼Œå°±éœ€è¦ä½¿ç”¨redisåšä¸€ä¸ªç¼“å†²æ“ä½œï¼Œè®©è¯·æ±‚å…ˆè®¿é—®åˆ°redisï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—®MySQLç­‰æ•°æ®åº“ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gav5412bb9j30m00bmt9d.jpg"></p>
<p>è¿™ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œä¸»è¦æ˜¯è§£å†³è¯»æ•°æ®ä»Redisç¼“å­˜ï¼Œä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§ä¸‹å›¾çš„æµç¨‹æ¥è¿›è¡Œä¸šåŠ¡æ“ä½œã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gav549rgb6j30is0ge0th.jpg"></p>
<p>è¯»å–ç¼“å­˜æ­¥éª¤ä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦æ¶‰åŠåˆ°æ•°æ®æ›´æ–°ï¼šæ•°æ®åº“å’Œç¼“å­˜æ›´æ–°ï¼Œå°±å®¹æ˜“å‡ºç°<strong>ç¼“å­˜(Redis)å’Œæ•°æ®åº“ï¼ˆMySQLï¼‰é—´çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong>ã€‚</p>
<p>ä¸ç®¡æ˜¯å…ˆå†™MySQLæ•°æ®åº“ï¼Œå†åˆ é™¤Redisç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>1.å¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</p>
<p>2.å¦‚æœå…ˆå†™äº†åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜å‰ï¼Œå†™åº“çš„çº¿ç¨‹å®•æœºäº†ï¼Œæ²¡æœ‰åˆ é™¤æ‰ç¼“å­˜ï¼Œåˆ™ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚</p>
<p>å› ä¸ºå†™å’Œè¯»æ˜¯å¹¶å‘çš„ï¼Œæ²¡æ³•ä¿è¯é¡ºåº,å°±ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p>å¦‚æ¥è§£å†³ï¼Ÿè¿™é‡Œç»™å‡ºä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå…ˆæ˜“åéš¾ï¼Œç»“åˆä¸šåŠ¡å’ŒæŠ€æœ¯ä»£ä»·é€‰æ‹©ä½¿ç”¨ã€‚</p>
<h2 id="ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"><a href="#ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ"></a>ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šé‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥"><a href="#1-ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šé‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥" class="headerlink" title="1.ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šé‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥"></a>1.ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šé‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥</h3><p>åœ¨å†™åº“å‰åéƒ½è¿›è¡Œredis.del(key)æ“ä½œï¼Œå¹¶ä¸”è®¾å®šåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚</p>
<p>ä¼ªä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">( String key, Object data )</span></span><br><span class="line">&#123;</span><br><span class="line">	redis.delKey( key );</span><br><span class="line">	db.updateData( data );</span><br><span class="line">	Thread.sleep( <span class="number">500</span> );</span><br><span class="line">	redis.delKey( key );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.å…·ä½“çš„æ­¥éª¤å°±æ˜¯ï¼š</strong></p>
<ol>
<li><p>å…ˆåˆ é™¤ç¼“å­˜</p>
</li>
<li><p>å†å†™æ•°æ®åº“</p>
</li>
<li><p>ä¼‘çœ 500æ¯«ç§’</p>
</li>
<li><p>å†æ¬¡åˆ é™¤ç¼“å­˜</p>
</li>
</ol>
<p><strong>é‚£ä¹ˆï¼Œè¿™ä¸ª500æ¯«ç§’æ€ä¹ˆç¡®å®šçš„ï¼Œå…·ä½“è¯¥ä¼‘çœ å¤šä¹…å‘¢ï¼Ÿ</strong></p>
<p>éœ€è¦è¯„ä¼°è‡ªå·±çš„é¡¹ç›®çš„è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶ã€‚è¿™ä¹ˆåšçš„ç›®çš„ï¼Œå°±æ˜¯ç¡®ä¿è¯»è¯·æ±‚ç»“æŸï¼Œå†™è¯·æ±‚å¯ä»¥åˆ é™¤è¯»è¯·æ±‚é€ æˆçš„ç¼“å­˜è„æ•°æ®ã€‚</p>
<p>å½“ç„¶è¿™ç§ç­–ç•¥è¿˜è¦è€ƒè™‘rediså’Œæ•°æ®åº“ä¸»ä»åŒæ­¥çš„è€—æ—¶ã€‚æœ€åçš„çš„å†™æ•°æ®çš„ä¼‘çœ æ—¶é—´ï¼šåˆ™åœ¨è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶åŸºç¡€ä¸Šï¼ŒåŠ å‡ ç™¾mså³å¯ã€‚æ¯”å¦‚ï¼šä¼‘çœ 1ç§’ã€‚</p>
<p><strong>3.è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´</strong></p>
<p>ä»ç†è®ºä¸Šæ¥è¯´ï¼Œç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€æœ‰çš„å†™æ“ä½œä»¥æ•°æ®åº“ä¸ºå‡†ï¼Œåªè¦åˆ°è¾¾ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œåˆ™åé¢çš„è¯»è¯·æ±‚è‡ªç„¶ä¼šä»æ•°æ®åº“ä¸­è¯»å–æ–°å€¼ç„¶åå›å¡«ç¼“å­˜ã€‚</p>
<p><strong>4.è¯¥æ–¹æ¡ˆçš„å¼Šç«¯</strong></p>
<p>ç»“åˆåŒåˆ ç­–ç•¥+ç¼“å­˜è¶…æ—¶è®¾ç½®ï¼Œè¿™æ ·æœ€å·®çš„æƒ…å†µå°±æ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ•°æ®å­˜åœ¨ä¸ä¸€è‡´ï¼Œè€Œä¸”åˆå¢åŠ äº†å†™è¯·æ±‚çš„è€—æ—¶ã€‚</p>
<h3 id="2ã€ç¬¬äºŒç§æ–¹æ¡ˆï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶"><a href="#2ã€ç¬¬äºŒç§æ–¹æ¡ˆï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" class="headerlink" title="2ã€ç¬¬äºŒç§æ–¹æ¡ˆï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)"></a><strong>2ã€ç¬¬äºŒç§æ–¹æ¡ˆï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)</strong></h3><p><strong>1.æŠ€æœ¯æ•´ä½“æ€è·¯ï¼š</strong></p>
<p>MySQL binlogå¢é‡è®¢é˜…æ¶ˆè´¹+æ¶ˆæ¯é˜Ÿåˆ—+å¢é‡æ•°æ®æ›´æ–°åˆ°redis</p>
<ul>
<li><strong>è¯»Redis</strong>ï¼šçƒ­æ•°æ®åŸºæœ¬éƒ½åœ¨Redis</li>
<li><strong>å†™MySQL</strong>:å¢åˆ æ”¹éƒ½æ˜¯æ“ä½œMySQL</li>
<li><strong>æ›´æ–°Redisæ•°æ®</strong>ï¼šMySQçš„æ•°æ®æ“ä½œbinlogï¼Œæ¥æ›´æ–°åˆ°Redis</li>
</ul>
<p><strong>2.Redisæ›´æ–°</strong></p>
<p><strong>(1ï¼‰æ•°æ®æ“ä½œä¸»è¦åˆ†ä¸ºä¸¤å¤§å—ï¼š</strong></p>
<ul>
<li>ä¸€ä¸ªæ˜¯å…¨é‡(å°†å…¨éƒ¨æ•°æ®ä¸€æ¬¡å†™å…¥åˆ°redis)</li>
<li>ä¸€ä¸ªæ˜¯å¢é‡ï¼ˆå®æ—¶æ›´æ–°ï¼‰</li>
</ul>
<p>è¿™é‡Œè¯´çš„æ˜¯å¢é‡,æŒ‡çš„æ˜¯mysqlçš„updateã€insertã€delateå˜æ›´æ•°æ®ã€‚</p>
<p><strong>(2ï¼‰è¯»å–binlogååˆ†æ ï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—,æ¨é€æ›´æ–°å„å°çš„redisç¼“å­˜æ•°æ®ã€‚</strong></p>
<p>è¿™æ ·ä¸€æ—¦MySQLä¸­äº§ç”Ÿäº†æ–°çš„å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œå°±å¯ä»¥æŠŠbinlogç›¸å…³çš„æ¶ˆæ¯æ¨é€è‡³Redisï¼ŒRediså†æ ¹æ®binlogä¸­çš„è®°å½•ï¼Œå¯¹Redisè¿›è¡Œæ›´æ–°ã€‚</p>
<p>å…¶å®è¿™ç§æœºåˆ¶ï¼Œå¾ˆç±»ä¼¼MySQLçš„ä¸»ä»å¤‡ä»½æœºåˆ¶ï¼Œå› ä¸ºMySQLçš„ä¸»å¤‡ä¹Ÿæ˜¯é€šè¿‡binlogæ¥å®ç°çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ç»“åˆä½¿ç”¨canal(é˜¿é‡Œçš„ä¸€æ¬¾å¼€æºæ¡†æ¶)ï¼Œé€šè¿‡è¯¥æ¡†æ¶å¯ä»¥å¯¹MySQLçš„binlogè¿›è¡Œè®¢é˜…ï¼Œè€Œcanalæ­£æ˜¯æ¨¡ä»¿äº†mysqlçš„slaveæ•°æ®åº“çš„å¤‡ä»½è¯·æ±‚ï¼Œä½¿å¾—Redisçš„æ•°æ®æ›´æ–°è¾¾åˆ°äº†ç›¸åŒçš„æ•ˆæœã€‚</p>
<p>å½“ç„¶ï¼Œè¿™é‡Œçš„æ¶ˆæ¯æ¨é€å·¥å…·ä½ ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ«çš„ç¬¬ä¸‰æ–¹ï¼škafkaã€rabbitMQç­‰æ¥å®ç°æ¨é€æ›´æ–°Redis!</p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>åç»­ä¼šæŒç»­æ›´æ–°Redisä¸“é¢˜çŸ¥è¯†ï¼Œå†™çš„ä¸å¥½çš„åœ°æ–¹ä¹Ÿå¸Œæœ›å¤§ç‰›èƒ½æŒ‡ç‚¹ä¸€ä¸‹ï¼Œå¤§å®¶è§‰å¾—ä¸é”™å¯ä»¥<strong>ç‚¹ä¸ªèµåœ¨å…³æ³¨ä¸‹ï¼Œä»¥åè¿˜ä¼šåˆ†äº«æ›´å¤šæ–‡ç« ï¼</strong></p>
<p>ä½œè€…ï¼šè‹¥å°å¯’é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/5c96fb795188252d5f0fdff2%E6%9D%A5%E6%BA%90%EF%BC%9A%E6%8E%98%E9%87%91%E8%91%97%E4%BD%9C%E6%9D%83%E5%BD%92%E4%BD%9C%E8%80%85%E6%89%80%E6%9C%89%E3%80%82%E5%95%86%E4%B8%9A%E8%BD%AC%E8%BD%BD%E8%AF%B7%E8%81%94%E7%B3%BB%E4%BD%9C%E8%80%85%E8%8E%B7%E5%BE%97%E6%8E%88%E6%9D%83%EF%BC%8C%E9%9D%9E%E5%95%86%E4%B8%9A%E8%BD%AC%E8%BD%BD%E8%AF%B7%E6%B3%A8%E6%98%8E%E5%87%BA%E5%A4%84%E3%80%82">https://juejin.im/post/5c96fb795188252d5f0fdff2æ¥æºï¼šæ˜é‡‘è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Arrays-sort-vs-Arrays-parallelSort"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/12/Arrays-sort-vs-Arrays-parallelSort/"
    >è¯‘|Arrays.sort VS Arrays.parallelSort</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/12/Arrays-sort-vs-Arrays-parallelSort/" class="article-date">
  <time datetime="2020-01-12T12:38:23.000Z" itemprop="datePublished">2020-01-12</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>è‹±æ–‡åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.baeldung.com/java-arrays-sort-vs-parallelsort" title="Arrays.sort vs Arrays.parallelSort">Arrays.sort vs Arrays.parallelSort</a></p>
<p>ä½œè€…ï¼š<a target="_blank" rel="noopener" href="https://www.baeldung.com/author/baeldung/" title="baeldung">baeldung</a></p>
<p>ç¿»è¯‘ï¼šé«˜è¡Œè¡Œ</p>
<p>å°ç»“ï¼š</p>
<p>å½“æˆ‘ä»¬è¦æ’åºçš„æ•°æ®é›†å¾ˆå¤§æ—¶ï¼ŒparallelSort() å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œåœ¨æ•°ç»„è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½ä½¿ç”¨ sort()ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½</p>
</blockquote>
<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>æˆ‘ä»¬éƒ½ä½¿ç”¨è¿‡ Arrays.sort() å¯¹å¯¹è±¡æˆ–åŸå§‹æ•°æ®ç±»å‹æ•°ç»„ï¼ˆ<code>byte</code>ï¼Œ<code>short</code>ï¼Œ<code>int</code>ï¼Œ<code>long</code>ï¼Œ<code>char</code>ï¼Œ<code>float</code>ï¼Œ<code>double</code>å’Œ<code>boolean</code>ï¼‰è¿›è¡Œæ’åºã€‚åœ¨ JDK 8 ä¸­ï¼Œåˆ›é€ è€…å¢å¼ºäº† API ä»¥æä¾›ä¸€ç§æ–°æ–¹æ³•ï¼š_Arrays.parallelSort()_ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ sort() å’Œ parallelSort() æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚</p>
<h2 id="2-Arrays-sort"><a href="#2-Arrays-sort" class="headerlink" title="2. Arrays.sort()"></a>2. Arrays.sort()</h2><p>Arrays.sort() æ–¹æ³•å¯¹å¯¹è±¡æˆ–åŸå§‹æ•°æ®ç±»å‹çš„æ•°ç»„è¿›è¡Œæ’åºã€‚<strong>æ­¤æ–¹æ³•ä¸­ä½¿ç”¨çš„æ’åºç®—æ³•æ˜¯ Dual-Pivot <a target="_blank" rel="noopener" href="https://www.baeldung.com/algorithm-quicksort" title="Quicksort">Quicksort</a>ã€‚</strong> æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯å¿«é€Ÿæ’åºç®—æ³•çš„è‡ªå®šä¹‰å®ç°ï¼Œä»¥å®ç°æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p><strong>æ­¤æ–¹æ³•æ˜¯å•çº¿ç¨‹çš„</strong> ï¼Œæœ‰ä¸¤ç§å˜ä½“ï¼š</p>
<ul>
<li>_sort(array)_â€“å°†æ•´ä¸ªæ•°ç»„æŒ‰å‡åºæ’åº</li>
<li>_sort(array, fromIndex, toIndex)_â€“ä»…å°†ä» fromIndex åˆ° toIndex çš„å…ƒç´ æ’åº</li>
</ul>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸¤ç§å˜ä½“çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">givenArrayOfIntegers_whenUsingArraysSortMethod_thenSortFullArrayInAscendingOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] array = &#123; <span class="number">10</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">int</span>[] expected = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span> &#125;;</span><br><span class="line"> </span><br><span class="line">    Arrays.sort(array);</span><br><span class="line"> </span><br><span class="line">    assertArrayEquals(expected, array);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">givenArrayOfIntegers_whenUsingArraysSortMethodWithRange_thenSortRangeOfArrayInAscendingOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] array = &#123; <span class="number">10</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">int</span>[] expected = &#123; <span class="number">10</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">5</span> &#125;;</span><br><span class="line"> </span><br><span class="line">    Arrays.sort(array, <span class="number">2</span>, <span class="number">8</span>);</span><br><span class="line"> </span><br><span class="line">    assertArrayEquals(expected, array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹è¿™ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ä¼˜ç‚¹</th>
<th align="left">ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å¿«é€Ÿå¤„ç†è¾ƒå°çš„æ•°æ®é›†</td>
<td align="left">å¤§å‹æ•°æ®é›†çš„æ€§èƒ½ä¸‹é™</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">æ²¡æœ‰åˆ©ç”¨ç³»ç»Ÿçš„å¤šä¸ªæ ¸å¿ƒ</td>
</tr>
</tbody></table>
<h2 id="3-Arrays-parallelSort"><a href="#3-Arrays-parallelSort" class="headerlink" title="3. Arrays.parallelSort()"></a>3. Arrays.parallelSort()</h2><p>æ­¤æ–¹æ³•å¯¹å¯¹è±¡æˆ–åŸå§‹æ•°æ®ç±»å‹çš„æ•°ç»„è¿›è¡Œæ’åºã€‚ä¸ sort() ç±»ä¼¼ï¼Œå®ƒä¹Ÿæœ‰ä¸¤ä¸ªå˜ä½“æ¥å¯¹å®Œæ•´æ•°ç»„å’Œéƒ¨åˆ†æ•°ç»„è¿›è¡Œæ’åºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">givenArrayOfIntegers_whenUsingArraysParallelSortMethod_thenSortFullArrayInAscendingOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] array = &#123; <span class="number">10</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">int</span>[] expected = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span> &#125;;</span><br><span class="line"> </span><br><span class="line">    Arrays.parallelSort(array);</span><br><span class="line"> </span><br><span class="line">    assertArrayEquals(expected, array);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">givenArrayOfIntegers_whenUsingArraysParallelSortMethodWithRange_thenSortRangeOfArrayInAscendingOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] array = &#123; <span class="number">10</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="type">int</span>[] expected = &#123; <span class="number">10</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">5</span> &#125;;</span><br><span class="line"> </span><br><span class="line">    Arrays.parallelSort(array, <span class="number">2</span>, <span class="number">8</span>);</span><br><span class="line"> </span><br><span class="line">    assertArrayEquals(expected, array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>parallelSort() åœ¨åŠŸèƒ½ä¸Šæœ‰æ‰€ä¸åŒã€‚ä¸ sort() ä½¿ç”¨å•ä¸ªçº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œé¡ºåºæ’åºä¸åŒï¼Œ<strong>å®ƒä½¿ç”¨å¹¶è¡Œæ’åº-åˆå¹¶æ’åºç®—æ³•</strong>ã€‚å®ƒå°†æ•°ç»„åˆ†æˆå­æ•°ç»„ï¼Œè¿™äº›å­æ•°ç»„æœ¬èº«å…ˆè¿›è¡Œæ’åºç„¶ååˆå¹¶ã€‚</p>
<p><strong>ä¸ºäº†æ‰§è¡Œå¹¶è¡Œä»»åŠ¡ï¼Œå®ƒä½¿ç”¨ ForkJoin æ± ã€‚</strong></p>
<p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œåªæœ‰åœ¨æ»¡è¶³æŸäº›æ¡ä»¶æ—¶ï¼Œå®ƒæ‰ä¼šä½¿ç”¨å¹¶è¡Œæ€§ã€‚å¦‚æœæ•°ç»„å¤§å°å°äºæˆ–ç­‰äº 8192ï¼Œæˆ–è€…å¤„ç†å™¨åªæœ‰ä¸€ä¸ªæ ¸å¿ƒï¼Œåˆ™å®ƒå°†ä½¿ç”¨é¡ºåºçš„ Dual-Pivot Quicksort ç®—æ³•ã€‚å¦åˆ™ï¼Œå®ƒä½¿ç”¨å¹¶è¡Œæ’åºã€‚</p>
<p>è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä½¿ç”¨å®ƒçš„ä¼˜ç¼ºç‚¹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ä¼˜ç‚¹</th>
<th align="left">ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä¸ºå¤§å‹æ•°æ®é›†æä¾›æ›´å¥½çš„æ€§èƒ½</td>
<td align="left">å¯¹äºå¤§å°è¾ƒå°çš„æ•°ç»„ï¼Œå¤„ç†é€Ÿåº¦è¾ƒæ…¢</td>
</tr>
<tr>
<td align="left">åˆ©ç”¨ç³»ç»Ÿçš„å¤šä¸ªæ ¸å¿ƒ</td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="4-æ¯”è¾ƒ"><a href="#4-æ¯”è¾ƒ" class="headerlink" title="4.æ¯”è¾ƒ"></a>4.æ¯”è¾ƒ</h2><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åœ¨ä¸åŒå¤§å°çš„æ•°æ®é›†ä¸Šä¸¤ç§æ–¹æ³•æ€æ ·æ‰§è¡Œã€‚ä»¥ä¸‹æ•°å­—æ˜¯ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.baeldung.com/java-microbenchmark-harness" title="JMHåŸºå‡†æµ‹è¯•">JMH åŸºå‡†æµ‹è¯•</a>å¾—å‡ºçš„ã€‚æµ‹è¯•ç¯å¢ƒä½¿ç”¨ AMD A10 PRO 2.1Ghz å››æ ¸å¤„ç†å™¨å’Œ JDK 1.8.0_221ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ•°ç»„å¤§å°</th>
<th align="left"><em>Arrays.sort()</em></th>
<th align="left"><em>Arrays.parallelSort()</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left">1000</td>
<td align="left">o.048</td>
<td align="left">0.054</td>
</tr>
<tr>
<td align="left">10000</td>
<td align="left">0.847</td>
<td align="left">0.425</td>
</tr>
<tr>
<td align="left">100000</td>
<td align="left">7.570</td>
<td align="left">4.395</td>
</tr>
<tr>
<td align="left">1000000</td>
<td align="left">65.301</td>
<td align="left">37.998</td>
</tr>
</tbody></table>
<h2 id="5-ç»“è®º"><a href="#5-ç»“è®º" class="headerlink" title="5.ç»“è®º"></a>5.ç»“è®º</h2><p>åœ¨è¿™ç¯‡çŸ­ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† sort() å’Œ parallelSort() çš„ä¸åŒä¹‹å¤„ã€‚</p>
<p>æ ¹æ®æ€§èƒ½ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå½“æˆ‘ä»¬è¦æ’åºçš„æ•°æ®é›†å¾ˆå¤§æ—¶ï¼ŒparallelSort() å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œåœ¨æ•°ç»„è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½ä½¿ç”¨ sort()ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p>ä¸å¾€å¸¸ä¸€æ ·ï¼Œå®Œæ•´çš„æºä»£ç å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/eugenp/tutorials/tree/master/core-java-modules/core-java-arrays-2" title="GitHub">GitHub</a> æ‰¾åˆ°ã€‚</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-SynchronizedåŒæ­¥é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•æ€»ç»“"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/10/Synchronized%E5%90%8C%E6%AD%A5%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%92%8C%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/"
    >è½¬|SynchronizedåŒæ­¥é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•æ€»ç»“</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/10/Synchronized%E5%90%8C%E6%AD%A5%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%92%8C%E9%9D%9E%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/" class="article-date">
  <time datetime="2020-01-09T17:29:46.000Z" itemprop="datePublished">2020-01-10</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><img src="https://raw.githubusercontent.com/gaohanghang/images/master/img/20200111223325.png" alt="Photo by SnapwireSnaps"></p>
<blockquote>
<p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/u010842515/article/details/65443084">https://blog.csdn.net/u010842515/article/details/65443084</a></p>
<p>ä½œè€…ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/u010842515">ç¼–ç¨‹åˆä¸</a></p>
</blockquote>
<h2 id="1-Synchronizedä¿®é¥°éé™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œå¯¹è±¡é”â€ã€‚"><a href="#1-Synchronizedä¿®é¥°éé™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œå¯¹è±¡é”â€ã€‚" class="headerlink" title="1. Synchronizedä¿®é¥°éé™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œå¯¹è±¡é”â€ã€‚"></a>1. Synchronizedä¿®é¥°éé™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œå¯¹è±¡é”â€ã€‚</h2><p>Javaä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ï¼Œå¹¶ä¸”æ˜¯å”¯ä¸€çš„ã€‚å‡è®¾åˆ†é…çš„ä¸€ä¸ªå¯¹è±¡ç©ºé—´ï¼Œé‡Œé¢æœ‰å¤šä¸ªæ–¹æ³•ï¼Œç›¸å½“äºç©ºé—´é‡Œé¢æœ‰å¤šä¸ªå°æˆ¿é—´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ‰€æœ‰çš„å°æˆ¿é—´éƒ½åŠ é”ï¼Œå› ä¸ºè¿™ä¸ªå¯¹è±¡åªæœ‰ä¸€æŠŠé’¥åŒ™ï¼Œå› æ­¤åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªäººæ‰“å¼€ä¸€ä¸ªå°æˆ¿é—´ï¼Œç„¶åç”¨å®Œäº†è¿˜å›å»ï¼Œå†ç”±JVM å»åˆ†é…ä¸‹ä¸€ä¸ªè·å¾—é’¥åŒ™çš„äººã€‚</p>
<h3 id="æƒ…å†µ1ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è®¿é—®è¯¥å¯¹è±¡çš„ä¸¤ä¸ªåŒæ­¥æ–¹æ³•"><a href="#æƒ…å†µ1ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è®¿é—®è¯¥å¯¹è±¡çš„ä¸¤ä¸ªåŒæ­¥æ–¹æ³•" class="headerlink" title="æƒ…å†µ1ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è®¿é—®è¯¥å¯¹è±¡çš„ä¸¤ä¸ªåŒæ­¥æ–¹æ³•"></a>æƒ…å†µ1ï¼šåŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è®¿é—®è¯¥å¯¹è±¡çš„ä¸¤ä¸ªåŒæ­¥æ–¹æ³•</h3><p><strong>ç»“æœ</strong>ï¼šä¼šäº§ç”Ÿäº’æ–¥ã€‚</p>
<p><strong>è§£é‡Š</strong>ï¼šå› ä¸ºé”é’ˆå¯¹çš„æ˜¯å¯¹è±¡ï¼Œå½“å¯¹è±¡è°ƒç”¨ä¸€ä¸ªsynchronizedæ–¹æ³•æ—¶ï¼Œå…¶ä»–åŒæ­¥æ–¹æ³•éœ€è¦ç­‰å¾…å…¶æ‰§è¡Œç»“æŸå¹¶é‡Šæ”¾é”åæ‰èƒ½æ‰§è¡Œã€‚</p>
<h3 id="æƒ…å†µ2ï¼šä¸åŒå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨åŒä¸€ä¸ªåŒæ­¥æ–¹æ³•"><a href="#æƒ…å†µ2ï¼šä¸åŒå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨åŒä¸€ä¸ªåŒæ­¥æ–¹æ³•" class="headerlink" title="æƒ…å†µ2ï¼šä¸åŒå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨åŒä¸€ä¸ªåŒæ­¥æ–¹æ³•"></a>æƒ…å†µ2ï¼šä¸åŒå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨åŒä¸€ä¸ªåŒæ­¥æ–¹æ³•</h3><p>ç»“æœï¼šä¸ä¼šäº§ç”Ÿäº’æ–¥ã€‚</p>
<p>è§£é‡Šï¼šå› ä¸ºæ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œé”é’ˆå¯¹çš„æ˜¯å¯¹è±¡ï¼Œå¹¶ä¸æ˜¯æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä¸ä¼šäº’æ–¥ã€‚å½¢è±¡çš„æ¥è¯´å°±æ˜¯å› ä¸ºæˆ‘ä»¬æ¯ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™éƒ½æ˜¯new ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ä¸¤ä¸ªç©ºé—´ï¼Œä¸¤æŠŠé’¥åŒ™ï¼Œ</p>
<h2 id="2-Synchronizedä¿®é¥°é™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è¯¥ç±»å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œç±»é”â€ã€‚"><a href="#2-Synchronizedä¿®é¥°é™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è¯¥ç±»å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œç±»é”â€ã€‚" class="headerlink" title="2. Synchronizedä¿®é¥°é™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è¯¥ç±»å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œç±»é”â€ã€‚"></a>2. Synchronizedä¿®é¥°é™æ€æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å¯¹è¯¥ç±»å¯¹è±¡åŠ é”ï¼Œä¿—ç§°â€œç±»é”â€ã€‚</h2><h3 id="æƒ…å†µ1ï¼šç”¨ç±»ç›´æ¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„åŒæ­¥æ–¹æ³•"><a href="#æƒ…å†µ1ï¼šç”¨ç±»ç›´æ¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„åŒæ­¥æ–¹æ³•" class="headerlink" title="æƒ…å†µ1ï¼šç”¨ç±»ç›´æ¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„åŒæ­¥æ–¹æ³•"></a>æƒ…å†µ1ï¼šç”¨ç±»ç›´æ¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„åŒæ­¥æ–¹æ³•</h3><p><strong>ç»“æœ</strong>ï¼šä¼šäº§ç”Ÿäº’æ–¥ã€‚</p>
<p><strong>è§£é‡Š</strong>ï¼šå› ä¸ºå¯¹é™æ€å¯¹è±¡åŠ é”å®é™…ä¸Šå¯¹ç±»ï¼ˆ.classï¼‰åŠ é”ï¼Œç±»å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œå¯ä»¥ç†è§£ä¸ºä»»ä½•æ—¶å€™éƒ½åªæœ‰ä¸€ä¸ªç©ºé—´ï¼Œé‡Œé¢æœ‰Nä¸ªæˆ¿é—´ï¼Œä¸€æŠŠé”ï¼Œå› æ­¤æˆ¿é—´ï¼ˆåŒæ­¥æ–¹æ³•ï¼‰ä¹‹é—´ä¸€å®šæ˜¯äº’æ–¥çš„ã€‚</p>
<p>æ³¨ï¼šä¸Šè¿°æƒ…å†µå’Œç”¨å•ä¾‹æ¨¡å¼å£°æ˜ä¸€ä¸ªå¯¹è±¡æ¥è°ƒç”¨éé™æ€æ–¹æ³•çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºæ°¸è¿œå°±åªæœ‰è¿™ä¸€ä¸ªå¯¹è±¡ã€‚æ‰€ä»¥è®¿é—®åŒæ­¥æ–¹æ³•ä¹‹é—´ä¸€å®šæ˜¯äº’æ–¥çš„ã€‚</p>
<h3 id="æƒ…å†µ2ï¼šç”¨ä¸€ä¸ªç±»çš„é™æ€å¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨é™æ€æ–¹æ³•æˆ–éé™æ€æ–¹æ³•"><a href="#æƒ…å†µ2ï¼šç”¨ä¸€ä¸ªç±»çš„é™æ€å¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨é™æ€æ–¹æ³•æˆ–éé™æ€æ–¹æ³•" class="headerlink" title="æƒ…å†µ2ï¼šç”¨ä¸€ä¸ªç±»çš„é™æ€å¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨é™æ€æ–¹æ³•æˆ–éé™æ€æ–¹æ³•"></a>æƒ…å†µ2ï¼šç”¨ä¸€ä¸ªç±»çš„é™æ€å¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨é™æ€æ–¹æ³•æˆ–éé™æ€æ–¹æ³•</h3><p>ç»“æœï¼šä¼šäº§ç”Ÿäº’æ–¥ã€‚</p>
<p>è§£é‡Šï¼šå› ä¸ºæ˜¯ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ï¼ŒåŒä¸Šã€‚</p>
<h3 id="æƒ…å†µ3ï¼šä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è°ƒç”¨ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•å’Œä¸€ä¸ªéé™æ€åŒæ­¥æ–¹æ³•"><a href="#æƒ…å†µ3ï¼šä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è°ƒç”¨ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•å’Œä¸€ä¸ªéé™æ€åŒæ­¥æ–¹æ³•" class="headerlink" title="æƒ…å†µ3ï¼šä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è°ƒç”¨ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•å’Œä¸€ä¸ªéé™æ€åŒæ­¥æ–¹æ³•"></a>æƒ…å†µ3ï¼šä¸€ä¸ªå¯¹è±¡åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«è°ƒç”¨ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•å’Œä¸€ä¸ªéé™æ€åŒæ­¥æ–¹æ³•</h3><p><strong>ç»“æœ</strong>ï¼šä¸ä¼šäº§ç”Ÿäº’æ–¥ã€‚</p>
<p><strong>è§£é‡Š</strong>ï¼šå› ä¸ºè™½ç„¶æ˜¯ä¸€ä¸ªå¯¹è±¡è°ƒç”¨ï¼Œä½†æ˜¯ä¸¤ä¸ªæ–¹æ³•çš„é”ç±»å‹ä¸åŒï¼Œè°ƒç”¨çš„é™æ€æ–¹æ³•å®é™…ä¸Šæ˜¯ç±»å¯¹è±¡åœ¨è°ƒç”¨ï¼Œå³è¿™ä¸¤ä¸ªæ–¹æ³•äº§ç”Ÿçš„å¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡é”ï¼Œå› æ­¤ä¸ä¼šäº’æ–¥ï¼Œä¼šå¹¶å‘æ‰§è¡Œã€‚</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<p>åŒæ­¥æ–¹æ³•ç±»ï¼šSynchronizedTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedTest</span> &#123;</span><br><span class="line">	<span class="comment">/*private SynchronizedTest()&#123;&#125;</span></span><br><span class="line"><span class="comment">	private static SynchronizedTest st;           //æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œéœ€è¦åŠ synchronizedåŒæ­¥</span></span><br><span class="line"><span class="comment">	public static SynchronizedTest getInstance()&#123;</span></span><br><span class="line"><span class="comment">		if(st == null)&#123;</span></span><br><span class="line"><span class="comment">			st = new SynchronizedTest();</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		return st;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">	<span class="comment">/*private SynchronizedTest()&#123;&#125;</span></span><br><span class="line"><span class="comment">	private static final SynchronizedTest st = new SynchronizedTest();  //é¥¿æ±‰å¼å•åˆ©æ¨¡å¼ï¼Œå¤©ç”Ÿçº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment">	public static SynchronizedTest getInstance()&#123;</span></span><br><span class="line"><span class="comment">		return st;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">SynchronizedTest</span> <span class="variable">staticIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedTest</span>();   <span class="comment">//é™æ€å¯¹è±¡</span></span><br><span class="line">	</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;                                      <span class="comment">//éé™æ€æ–¹æ³•1</span></span><br><span class="line">    	 <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; <span class="number">10</span>;i++)&#123;  </span><br><span class="line">    		 System.out.println(<span class="string">&quot;method1 is running!&quot;</span>);</span><br><span class="line">    		 <span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">    	 &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>&#123;                                   <span class="comment">//éé™æ€æ–¹æ³•2</span></span><br><span class="line">    	 <span class="keyword">for</span>( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++)&#123;</span><br><span class="line">    		 System.out.println(<span class="string">&quot;method2 is running!&quot;</span>);</span><br><span class="line">    		 <span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">    	 &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticMethod1</span><span class="params">()</span>&#123;                     <span class="comment">//é™æ€æ–¹æ³•1</span></span><br><span class="line">    	<span class="keyword">for</span>( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++)&#123;</span><br><span class="line">   		 System.out.println(<span class="string">&quot;static method1 is running!&quot;</span>);</span><br><span class="line">   		 <span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">   	 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticMethod2</span><span class="params">()</span>&#123;                      <span class="comment">//é™æ€æ–¹æ³•2</span></span><br><span class="line">    	<span class="keyword">for</span>( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++)&#123;</span><br><span class="line">   		 System.out.println(<span class="string">&quot;static method2 is running!&quot;</span>);</span><br><span class="line">   		 <span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">   	 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹ç±»1ï¼šThread1.javaï¼ˆé‡Šæ”¾ä¸åŒçš„æ³¨é‡Šå¯ä»¥æµ‹è¯•ä¸åŒçš„æƒ…å†µï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread1</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//		SynchronizedTest s = SynchronizedTest.getInstance();</span></span><br><span class="line"><span class="comment">//		s.method1();</span></span><br><span class="line"><span class="comment">//		SynchronizedTest s1 = new SynchronizedTest();</span></span><br><span class="line"><span class="comment">//		s1.method1();</span></span><br><span class="line">		SynchronizedTest.staticIn.method1();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//		SynchronizedTest.staticMethod1();</span></span><br><span class="line"><span class="comment">//		SynchronizedTest.staticMethod2();</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹ç±»2ï¼šThread2.Java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"><span class="comment">//		SynchronizedTest s = SynchronizedTest.getInstance();</span></span><br><span class="line"><span class="comment">//		SynchronizedTest s2 = new SynchronizedTest();</span></span><br><span class="line"><span class="comment">//		s2.method1();</span></span><br><span class="line"><span class="comment">//		s.method2();</span></span><br><span class="line"><span class="comment">//		SynchronizedTest.staticMethod1();</span></span><br><span class="line"><span class="comment">//		SynchronizedTest.staticMethod2();</span></span><br><span class="line"><span class="comment">//		SynchronizedTest.staticIn.method2();</span></span><br><span class="line">		SynchronizedTest.staticIn.staticMethod1();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»ç±»ï¼šThreadMain.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadMain</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Thread1</span>());</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Thread2</span>());</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">exec</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        exec.execute(t1);</span><br><span class="line">        exec.execute(t2);</span><br><span class="line">        exec.shutdown();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-æ€»ç»“ï¼š"><a href="#3-æ€»ç»“ï¼š" class="headerlink" title="3. æ€»ç»“ï¼š"></a>3. æ€»ç»“ï¼š</h2><p>1.å¯¹è±¡é”é’¥åŒ™åªèƒ½æœ‰ä¸€æŠŠæ‰èƒ½äº’æ–¥ï¼Œæ‰èƒ½ä¿è¯å…±äº«å˜é‡çš„å”¯ä¸€æ€§</p>
<p>2.åœ¨é™æ€æ–¹æ³•ä¸Šçš„é”ï¼Œå’Œ å®ä¾‹æ–¹æ³•ä¸Šçš„é”ï¼Œé»˜è®¤ä¸æ˜¯åŒæ ·çš„ï¼Œå¦‚æœåŒæ­¥éœ€è¦åˆ¶å®šä¸¤æŠŠé”ä¸€æ ·ã€‚</p>
<p>3.å…³äºåŒä¸€ä¸ªç±»çš„æ–¹æ³•ä¸Šçš„é”ï¼Œæ¥è‡ªäºè°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆé”å¿…ç„¶ç›¸åŒï¼Œå¦åˆ™å°±ä¸ç›¸åŒã€‚æ¯”å¦‚ new A().x() å’Œ new A().x(),å¯¹è±¡ä¸åŒï¼Œé”ä¸åŒï¼Œå¦‚æœAçš„å•åˆ©çš„ï¼Œå°±èƒ½äº’æ–¥ã€‚</p>
<p>4.é™æ€æ–¹æ³•åŠ é”ï¼Œèƒ½å’Œæ‰€æœ‰å…¶ä»–é™æ€æ–¹æ³•åŠ é”çš„ è¿›è¡Œäº’æ–¥</p>
<p>5.é™æ€æ–¹æ³•åŠ é”ï¼Œå’Œxx.class é”æ•ˆæœä¸€æ ·ï¼Œç›´æ¥å±äºç±»çš„</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gat00jvxyig30p00dw4qq.gif"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-mysqlä¼˜åŒ–ï¼šè¦†ç›–ç´¢å¼•ï¼ˆå»¶è¿Ÿå…³è”ï¼‰"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/06/mysql%E4%BC%98%E5%8C%96%EF%BC%9A%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%88%E5%BB%B6%E8%BF%9F%E5%85%B3%E8%81%94%EF%BC%89/"
    >mysqlä¼˜åŒ–ï¼šè¦†ç›–ç´¢å¼•ã€å»¶è¿Ÿå…³è”</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/06/mysql%E4%BC%98%E5%8C%96%EF%BC%9A%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%EF%BC%88%E5%BB%B6%E8%BF%9F%E5%85%B3%E8%81%94%EF%BC%89/" class="article-date">
  <time datetime="2020-01-06T15:14:17.000Z" itemprop="datePublished">2020-01-06</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>ä½œè€…ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wang-meng/" title="ä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«">ä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«</a></p>
<p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wang-meng/p/ae6d1c4a7b553e9a5c8f46b67fb3e3aa.html">https://www.cnblogs.com/wang-meng/p/ae6d1c4a7b553e9a5c8f46b67fb3e3aa.html</a></p>
<p>å°ç»“ï¼š</p>
<p><strong>å›è¡¨</strong>ï¼šå›åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå›è¡¨ã€‚</p>
<p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šå°±æ˜¯ select çš„æ•°æ®åˆ—åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—ï¼Œä¸å¿…ä»æ•°æ®è¡¨ä¸­è¯»å–ã€‚ç®€å•ç‚¹è¯´å°±æ˜¯ä½ è¦æŸ¥çš„æ•°æ®ç´¢å¼•é‡Œéƒ½æœ‰ï¼Œä¸€æ¬¡æå®šï¼Œç¾æ»‹æ»‹ ğŸ˜ã€‚</p>
<p><strong>å»¶è¿Ÿå…³è”</strong>ï¼šé€šè¿‡ä½¿ç”¨è¦†ç›–ç´¢å¼•æŸ¥è¯¢è¿”å›éœ€è¦çš„ä¸»é”®ï¼Œå†æ ¹æ®ä¸»é”®å…³è”åŸè¡¨è·å¾—éœ€è¦çš„æ•°æ®ã€‚</p>
</blockquote>
<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h2><p>ä¸Šå‘¨æ–°ç³»ç»Ÿæ”¹ç‰ˆä¸Šçº¿ï¼Œä¸Šçº¿ç¬¬äºŒå¤©å°±å‡ºç°äº†è¾ƒå¤šçš„çº¿ä¸Š<strong>æ…¢ sql</strong> æŸ¥è¯¢ï¼Œç´§æ¥ç€ dba ç»™å‡ºäº†å®šä½åŠè§£å†³æ–¹æ¡ˆï¼Œè¿™é‡Œè¾ƒå¤šçš„æ˜¯ä½¿ç”¨<strong>å»¶è¿Ÿå…³è”</strong>å»ä¼˜åŒ–ã€‚</p>
<p>è€Œæˆ‘å¯¹äºè¿™ä¸ª<strong>å»¶è¿Ÿå…³è”</strong>ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å¬è¯´ï¼ˆo(â•¥ï¹â•¥)oï¼‰ï¼Œæ‰€ä»¥ä»Šå¤©ä¸€å®šè¦å­¦ä¹ å¹¶äº§å‡ºä¸€ç¯‡å­¦ä¹ ç¬”è®°ã€‚(<em>^â–½^</em>)</p>
<h2 id="2-å›è¡¨"><a href="#2-å›è¡¨" class="headerlink" title="2. å›è¡¨"></a>2. å›è¡¨</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ InnoDB é‡‡ç”¨çš„ B+ tree æ¥å®ç°ç´¢å¼•çš„ï¼Œç´¢å¼•åˆåˆ†ä¸ºä¸»é”®ç´¢å¼•(èšç°‡ç´¢å¼•)å’Œæ™®é€šç´¢å¼•(äºŒçº§ç´¢å¼•)ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹ä¸‹<strong>åŸºäºä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„æŸ¥è¯¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li>å¦‚æœè¯­å¥æ˜¯ select * from T where ID&#x3D;500ï¼Œå³ä¸»é”®æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™åªéœ€è¦æœç´¢ ID è¿™æ£µ B+æ ‘ï¼›</li>
<li>å¦‚æœè¯­å¥æ˜¯ select * from T where k&#x3D;5ï¼Œå³æ™®é€šç´¢å¼•æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™éœ€è¦å…ˆæœç´¢ k ç´¢å¼•æ ‘ï¼Œå¾—åˆ° ID çš„å€¼ä¸º 500ï¼Œå†åˆ° ID ç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›è¡¨ã€‚</li>
</ul>
<p>ä¸¾ä¸ªæ —å­ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ganac2wt4kj30l505b3yq.jpg"></p>
<p>å¯ä»¥çœ‹å‡ºæˆ‘ä»¬æœ‰ä¸€ä¸ªæ™®é€šç´¢å¼• kï¼Œé‚£ä¹ˆä¸¤é¢— B+æ ‘çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ganacgk91rj30vq0nsgnf.jpg"></p>
<p><strong>ï¼ˆæ³¨ï¼šå›¾æ¥è‡ªæå®¢æ—¶é—´ä¸“æ ï¼‰</strong></p>
<p>å½“æˆ‘ä»¬æŸ¥è¯¢ <strong><code>select \* from T where k=5</code></strong> å…¶å®ä¼šå…ˆåˆ° k é‚£ä¸ªç´¢å¼•æ ‘ä¸ŠæŸ¥è¯¢ k &#x3D; 5ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„ id ä¸º 500ï¼Œæœ€åå›è¡¨åˆ°ä¸»é”®ç´¢å¼•çš„ç´¢å¼•æ ‘æ‰¾è¿”å›æ‰€éœ€æ•°æ®ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŸ¥è¯¢**<code>select id from T where k=5</code>** åˆ™ä¸éœ€è¦å›è¡¨å°±ç›´æ¥è¿”å›ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºäºéä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢éœ€è¦å¤šæ‰«æä¸€æ£µç´¢å¼•æ ‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­åº”è¯¥å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢ã€‚</p>
<h2 id="3-è¦†ç›–ç´¢å¼•"><a href="#3-è¦†ç›–ç´¢å¼•" class="headerlink" title="3. è¦†ç›–ç´¢å¼•"></a>3. è¦†ç›–ç´¢å¼•</h2><ul>
<li>è§£é‡Šä¸€ï¼š å°±æ˜¯ select çš„æ•°æ®åˆ—åªç”¨ä»ç´¢å¼•ä¸­å°±èƒ½å¤Ÿå–å¾—ï¼Œä¸å¿…ä»æ•°æ®è¡¨ä¸­è¯»å–ï¼Œæ¢å¥è¯è¯´æŸ¥è¯¢åˆ—è¦è¢«æ‰€ä½¿ç”¨çš„ç´¢å¼•è¦†ç›–ã€‚</li>
<li>è§£é‡ŠäºŒï¼š ç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå½“èƒ½é€šè¿‡æ£€ç´¢ç´¢å¼•å°±å¯ä»¥è¯»å–æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦å†åˆ°æ•°æ®è¡¨ä¸­è¯»å–è¡Œäº†ã€‚å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«äº†ï¼ˆæˆ–è¦†ç›–äº†ï¼‰æ»¡è¶³æŸ¥è¯¢è¯­å¥ä¸­å­—æ®µä¸æ¡ä»¶çš„æ•°æ®å°±å«åšè¦†ç›–ç´¢å¼•ã€‚</li>
<li>è§£é‡Šä¸‰ï¼šæ˜¯éèšé›†ç»„åˆç´¢å¼•çš„ä¸€ç§å½¢å¼ï¼Œå®ƒåŒ…æ‹¬åœ¨æŸ¥è¯¢é‡Œçš„ Selectã€Join å’Œ Where å­å¥ç”¨åˆ°çš„æ‰€æœ‰åˆ—ï¼ˆå³å»ºç«‹ç´¢å¼•çš„å­—æ®µæ­£å¥½æ˜¯è¦†ç›–æŸ¥è¯¢è¯­å¥[select å­å¥]ä¸æŸ¥è¯¢æ¡ä»¶[Where å­å¥]ä¸­æ‰€æ¶‰åŠçš„å­—æ®µï¼Œä¹Ÿå³ï¼Œç´¢å¼•åŒ…å«äº†æŸ¥è¯¢æ­£åœ¨æŸ¥æ‰¾çš„æ‰€æœ‰æ•°æ®ï¼‰ã€‚</li>
<li><strong>ä¸æ˜¯æ‰€æœ‰ç±»å‹çš„ç´¢å¼•éƒ½å¯ä»¥æˆä¸ºè¦†ç›–ç´¢å¼•ã€‚è¦†ç›–ç´¢å¼•å¿…é¡»è¦å­˜å‚¨ç´¢å¼•çš„åˆ—ï¼Œè€Œå“ˆå¸Œç´¢å¼•ã€ç©ºé—´ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•ç­‰éƒ½ä¸å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼ï¼Œæ‰€ä»¥ MySQL åªèƒ½ä½¿ç”¨ B-Tree ç´¢å¼•åšè¦†ç›–ç´¢å¼•</strong></li>
<li><strong>å½“å‘èµ·ä¸€ä¸ªè¢«ç´¢å¼•è¦†ç›–çš„æŸ¥è¯¢(ä¹Ÿå«ä½œç´¢å¼•è¦†ç›–æŸ¥è¯¢)æ—¶ï¼Œåœ¨ EXPLAIN çš„ Extra åˆ—å¯ä»¥çœ‹åˆ°â€œUsing indexâ€çš„ä¿¡æ¯</strong></li>
</ul>
<p>æ¦‚å¿µå¦‚ä¸Šï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ä¾‹å­æ¥è¯´æ˜ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ganad2p4unj30vq0nsgnf.jpg"></p>
<p><strong>ï¼ˆæ³¨ï¼šå›¾æ¥è‡ªæå®¢æ—¶é—´ä¸“æ ï¼‰</strong></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™æ¡ SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼š select * from T where k between 3 and 5</p>
<ol>
<li>åœ¨ k ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ° k&#x3D;3 çš„è®°å½•ï¼Œå–å¾— ID &#x3D; 300ï¼›</li>
<li>å†åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID&#x3D;300 å¯¹åº”çš„ R3ï¼›</li>
<li>åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k&#x3D;5ï¼Œå–å¾— ID&#x3D;500ï¼›</li>
<li>å†å›åˆ° ID ç´¢å¼•æ ‘æŸ¥åˆ° ID&#x3D;500 å¯¹åº”çš„ R4ï¼›</li>
<li>åœ¨ k ç´¢å¼•æ ‘å–ä¸‹ä¸€ä¸ªå€¼ k&#x3D;6ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå¾ªç¯ç»“æŸã€‚</li>
</ol>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<strong>å›åˆ°ä¸»é”®ç´¢å¼•æ ‘æœç´¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¸ºå›è¡¨ã€‚</strong>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹è¯»äº† k ç´¢å¼•æ ‘çš„ 3 æ¡è®°å½•ï¼ˆæ­¥éª¤ 1ã€3 å’Œ 5ï¼‰ï¼Œå›è¡¨äº†ä¸¤æ¬¡ï¼ˆæ­¥éª¤ 2 å’Œ 4ï¼‰ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºæŸ¥è¯¢ç»“æœæ‰€éœ€è¦çš„æ•°æ®åªåœ¨ä¸»é”®ç´¢å¼•ä¸Šæœ‰ï¼Œæ‰€ä»¥ä¸å¾—ä¸å›è¡¨ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å¯èƒ½ç»è¿‡ç´¢å¼•ä¼˜åŒ–ï¼Œé¿å…å›è¡¨è¿‡ç¨‹å‘¢ï¼Ÿ</p>
<p>å¦‚æœæ‰§è¡Œçš„è¯­å¥æ˜¯ select ID from T where k between 3 and 5ï¼Œè¿™æ—¶åªéœ€è¦æŸ¥ ID çš„å€¼ï¼Œè€Œ ID çš„å€¼å·²ç»åœ¨ k ç´¢å¼•æ ‘ä¸Šäº†ï¼Œå› æ­¤å¯ä»¥ç›´æ¥æä¾›æŸ¥è¯¢ç»“æœï¼Œä¸éœ€è¦å›è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ªæŸ¥è¯¢é‡Œé¢ï¼Œç´¢å¼• k å·²ç»â€œè¦†ç›–äº†â€æˆ‘ä»¬çš„æŸ¥è¯¢éœ€æ±‚ï¼Œæˆ‘ä»¬ç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚</p>
<p><strong>ç”±äºè¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚</strong></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¼•æ“å†…éƒ¨ä½¿ç”¨è¦†ç›–ç´¢å¼•åœ¨ç´¢å¼• k ä¸Šå…¶å®è¯»äº†ä¸‰ä¸ªè®°å½•ï¼ŒR3~R5ï¼ˆå¯¹åº”çš„ç´¢å¼• k ä¸Šçš„è®°å½•é¡¹ï¼‰ï¼Œä½†æ˜¯å¯¹äº MySQL çš„ Server å±‚æ¥è¯´ï¼Œå®ƒå°±æ˜¯æ‰¾å¼•æ“æ‹¿åˆ°äº†ä¸¤æ¡è®°å½•ï¼Œå› æ­¤ MySQL è®¤ä¸ºæ‰«æè¡Œæ•°æ˜¯ 2ã€‚</p>
<h2 id="4-å»¶è¿Ÿå…³è”"><a href="#4-å»¶è¿Ÿå…³è”" class="headerlink" title="4. å»¶è¿Ÿå…³è”"></a>4. å»¶è¿Ÿå…³è”</h2><p>ä¸Šé¢ä»‹ç»äº†é‚£ä¹ˆå¤š å…¶å®æ˜¯åœ¨ä¸ºå»¶è¿Ÿå…³è”åšé“ºå«ï¼Œè¿™é‡Œç›´æ¥ç»­ä¸Šæˆ‘ä»¬æœ¬æ¬¡æ…¢æŸ¥è¯¢çš„ sqlï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ganadnaw4nj30w70a4dhu.jpg"></p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨åšåˆ†é¡µæ—¶ä¼šç”¨åˆ° Limit å…³é”®å­—å»ç­›é€‰æ‰€éœ€æ•°æ®ï¼Œlimit æ¥å— 1 ä¸ªæˆ–è€… 2 ä¸ªå‚æ•°ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°æ—¶ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºåç§»é‡ï¼Œå³ä»å“ªä¸€è¡Œå¼€å§‹å–æ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºè¦å–çš„è¡Œæ•°ã€‚ å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œç›¸å½“äºåç§»é‡ä¸º 0ã€‚</p>
<p>å½“åç§»é‡å¾ˆå¤§æ—¶ï¼Œå¦‚ limit 100000,10 å–ç¬¬ 100001-100010 æ¡è®°å½•ï¼Œmysql ä¼šå–å‡º 100010 æ¡è®°å½•ç„¶åå°†å‰ 100000 æ¡è®°å½•ä¸¢å¼ƒï¼Œè¿™æ— ç–‘æ˜¯ä¸€ç§å·¨å¤§çš„æ€§èƒ½æµªè´¹ã€‚</p>
<p>è¿™ä¸ª sql å¹¶æ²¡æœ‰åˆ©ç”¨ç´¢å¼•è¦†ç›–ï¼Œå› ä¸ºæ‰€è¦ select çš„å­—æ®µä¸å…¨éƒ½åœ¨ç´¢å¼•ä¸Šï¼Œæ¯æ¬¡æ ¹æ®äºŒçº§ç´¢å¼•ï¼ˆexpert_idï¼‰ æŸ¥è¯¢åˆ°ä¸€æ¡è®°å½•ï¼Œéƒ½è¦å†èµ°ä¸€éä¸»é”®ç´¢å¼•å»è¡¨é‡Œæ‰¾å‡ºæ‰€éœ€è¦çš„å…¶ä»–åˆ—ï¼Œé€Ÿåº¦è‡ªç„¶æ…¢ã€‚</p>
<p>å½“æœ‰è¿™ç§å†™æ³•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å»¶è¿Ÿå…³è”æ¥è¿›è¡Œä¼˜åŒ–ï¼Œé‡ç‚¹å…³æ³¨ï¼š<strong>SELECT id FROM qa_question WHERE expert_id &#x3D; 69 AND STATUS &#x3D; 30 ORDER BY over_time DESC LIMIT 0, 10</strong>ï¼Œ è¿™é‡Œå…¶å®åˆ©ç”¨äº†ç´¢å¼•è¦†ç›–ï¼Œwhere æ¡ä»¶åçš„ expert_id æ˜¯æœ‰æ·»åŠ ç´¢å¼•çš„ï¼Œè¿™é‡ŒæŸ¥è¯¢ id å¯ä»¥é¿å…å›è¡¨ï¼Œå¤§å¤§æå‡æ•ˆç‡ã€‚</p>
<h2 id="5-ç»“è¯­"><a href="#5-ç»“è¯­" class="headerlink" title="5. ç»“è¯­"></a>5. ç»“è¯­</h2><p>å·¥ä½œä¸­ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼Œå¯¹äºä¸€ä¸ªç ”å‘æ¥è¯´æœ€é‡è¦çš„æ˜¯èƒ½å¤Ÿä»è¿™äº›é—®é¢˜ä¸­å­¦åˆ°ä»€ä¹ˆã€‚å¥½ä¹…æ²¡æœ‰å†™åšå®¢äº†ï¼Œç©¶å…¶åŸå› è¿˜æ˜¯è‡ªå·±å˜å¾—æ‡’æƒ°äº†ã€‚ (ï¿£ã‚§ï¿£)</p>
<p>æœ€åä»¥ã€Šé«˜æ€§èƒ½ Mysqlã€‹ä¸­çš„ä¸€æ®µè¯ç»“æŸï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwly1ganae8vmo7j30na0awq66.jpg"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-å‚»å‚»åˆ†ä¸æ¸…ä¹‹-Cookieã€Sessionã€Tokenã€JWT"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/01/04/%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85%E4%B9%8B-Cookie%E3%80%81Session%E3%80%81Token%E3%80%81JWT/"
    >å‚»å‚»åˆ†ä¸æ¸…ä¹‹ Cookieã€Sessionã€Tokenã€JWT</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/01/04/%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85%E4%B9%8B-Cookie%E3%80%81Session%E3%80%81Token%E3%80%81JWT/" class="article-date">
  <time datetime="2020-01-04T05:19:48.000Z" itemprop="datePublished">2020-01-04</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/5e055d9ef265da33997a42cc">https://juejin.im/post/5e055d9ef265da33997a42cc</a></p>
<p>ä½œè€…ï¼šç§‹å¤©ä¸è½å¶</p>
</blockquote>
<h2 id="1-ä»€ä¹ˆæ˜¯è®¤è¯ï¼ˆAuthenticationï¼‰"><a href="#1-ä»€ä¹ˆæ˜¯è®¤è¯ï¼ˆAuthenticationï¼‰" class="headerlink" title="1. ä»€ä¹ˆæ˜¯è®¤è¯ï¼ˆAuthenticationï¼‰"></a>1. ä»€ä¹ˆæ˜¯è®¤è¯ï¼ˆAuthenticationï¼‰</h2><ul>
<li>é€šä¿—åœ°è®²å°±æ˜¯<strong>éªŒè¯å½“å‰ç”¨æˆ·çš„èº«ä»½</strong>ï¼Œè¯æ˜â€œä½ æ˜¯ä½ è‡ªå·±â€ï¼ˆæ¯”å¦‚ï¼šä½ æ¯å¤©ä¸Šä¸‹ç­æ‰“å¡ï¼Œéƒ½éœ€è¦é€šè¿‡æŒ‡çº¹æ‰“å¡ï¼Œå½“ä½ çš„æŒ‡çº¹å’Œç³»ç»Ÿé‡Œå½•å…¥çš„æŒ‡çº¹ç›¸åŒ¹é…æ—¶ï¼Œå°±æ‰“å¡æˆåŠŸï¼‰</li>
<li>äº’è”ç½‘ä¸­çš„è®¤è¯ï¼š<ul>
<li>ç”¨æˆ·åå¯†ç ç™»å½•</li>
<li>é‚®ç®±å‘é€ç™»å½•é“¾æ¥</li>
<li>æ‰‹æœºå·æ¥æ”¶éªŒè¯ç </li>
<li>åªè¦ä½ èƒ½æ”¶åˆ°é‚®ç®±&#x2F;éªŒè¯ç ï¼Œå°±é»˜è®¤ä½ æ˜¯è´¦å·çš„ä¸»äºº</li>
</ul>
</li>
</ul>
<h2 id="2-ä»€ä¹ˆæ˜¯æˆæƒï¼ˆAuthorizationï¼‰"><a href="#2-ä»€ä¹ˆæ˜¯æˆæƒï¼ˆAuthorizationï¼‰" class="headerlink" title="2. ä»€ä¹ˆæ˜¯æˆæƒï¼ˆAuthorizationï¼‰"></a>2. ä»€ä¹ˆæ˜¯æˆæƒï¼ˆAuthorizationï¼‰</h2><ul>
<li>ç”¨æˆ·æˆäºˆç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è¯¥ç”¨æˆ·æŸäº›èµ„æºçš„æƒé™<ul>
<li>ä½ åœ¨å®‰è£…æ‰‹æœºåº”ç”¨çš„æ—¶å€™ï¼ŒAPP ä¼šè¯¢é—®æ˜¯å¦å…è®¸æˆäºˆæƒé™ï¼ˆè®¿é—®ç›¸å†Œã€åœ°ç†ä½ç½®ç­‰æƒé™ï¼‰</li>
<li>ä½ åœ¨è®¿é—®å¾®ä¿¡å°ç¨‹åºæ—¶ï¼Œå½“ç™»å½•æ—¶ï¼Œå°ç¨‹åºä¼šè¯¢é—®æ˜¯å¦å…è®¸æˆäºˆæƒé™ï¼ˆè·å–æ˜µç§°ã€å¤´åƒã€åœ°åŒºã€æ€§åˆ«ç­‰ä¸ªäººä¿¡æ¯ï¼‰</li>
</ul>
</li>
<li>å®ç°æˆæƒçš„æ–¹å¼æœ‰ï¼šcookieã€sessionã€tokenã€OAuth</li>
</ul>
<h2 id="3-ä»€ä¹ˆæ˜¯å‡­è¯ï¼ˆCredentialsï¼‰"><a href="#3-ä»€ä¹ˆæ˜¯å‡­è¯ï¼ˆCredentialsï¼‰" class="headerlink" title="3. ä»€ä¹ˆæ˜¯å‡­è¯ï¼ˆCredentialsï¼‰"></a>3. ä»€ä¹ˆæ˜¯å‡­è¯ï¼ˆCredentialsï¼‰</h2><ul>
<li><p>å®ç°è®¤è¯å’Œæˆæƒçš„å‰æ</p>
<p>æ˜¯éœ€è¦ä¸€ç§</p>
<p>åª’ä»‹ï¼ˆè¯ä¹¦ï¼‰</p>
<p>æ¥æ ‡è®°è®¿é—®è€…çš„èº«ä»½</p>
<ul>
<li>åœ¨æˆ˜å›½æ—¶æœŸï¼Œå•†é…å˜æ³•ï¼Œå‘æ˜äº†ç…§èº«å¸–ã€‚ç…§èº«å¸–ç”±å®˜åºœå‘æ”¾ï¼Œæ˜¯ä¸€å—æ‰“ç£¨å…‰æ»‘ç»†å¯†çš„ç«¹æ¿ï¼Œä¸Šé¢åˆ»æœ‰æŒæœ‰äººçš„å¤´åƒå’Œç±è´¯ä¿¡æ¯ã€‚å›½äººå¿…é¡»æŒæœ‰ï¼Œå¦‚è‹¥æ²¡æœ‰å°±è¢«è®¤ä¸ºæ˜¯é»‘æˆ·ï¼Œæˆ–è€…é—´è°ä¹‹ç±»çš„ã€‚</li>
<li>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ¯ä¸ªäººéƒ½ä¼šæœ‰ä¸€å¼ ä¸“å±çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%B1%85%E6%B0%91%E8%BA%AB%E4%BB%BD%E8%AF%81/2080960" title="å±…æ°‘èº«ä»½è¯">å±…æ°‘èº«ä»½è¯</a>ï¼Œæ˜¯ç”¨äºè¯æ˜æŒæœ‰äººèº«ä»½çš„ä¸€ç§æ³•å®š<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%AF%81%E4%BB%B6/5804999" title="è¯ä»¶">è¯ä»¶</a>ã€‚é€šè¿‡èº«ä»½è¯ï¼Œæˆ‘ä»¬å¯ä»¥åŠç†æ‰‹æœºå¡&#x2F;é“¶è¡Œå¡&#x2F;ä¸ªäººè´·æ¬¾&#x2F;äº¤é€šå‡ºè¡Œç­‰ç­‰ï¼Œè¿™å°±æ˜¯<strong>è®¤è¯çš„å‡­è¯ã€‚</strong></li>
<li>åœ¨äº’è”ç½‘åº”ç”¨ä¸­ï¼Œä¸€èˆ¬ç½‘ç«™ï¼ˆå¦‚æ˜é‡‘ï¼‰ä¼šæœ‰ä¸¤ç§æ¨¡å¼ï¼Œæ¸¸å®¢æ¨¡å¼å’Œç™»å½•æ¨¡å¼ã€‚æ¸¸å®¢æ¨¡å¼ä¸‹ï¼Œå¯ä»¥æ­£å¸¸æµè§ˆç½‘ç«™ä¸Šé¢çš„æ–‡ç« ï¼Œä¸€æ—¦æƒ³è¦ç‚¹èµ&#x2F;æ”¶è—&#x2F;åˆ†äº«æ–‡ç« ï¼Œå°±éœ€è¦ç™»å½•æˆ–è€…æ³¨å†Œè´¦å·ã€‚å½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨ä¼šç»™è¯¥ç”¨æˆ·ä½¿ç”¨çš„æµè§ˆå™¨é¢å‘ä¸€ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œè¿™ä¸ªä»¤ç‰Œç”¨æ¥è¡¨æ˜ä½ çš„èº«ä»½ï¼Œæ¯æ¬¡æµè§ˆå™¨å‘é€è¯·æ±‚æ—¶ä¼šå¸¦ä¸Šè¿™ä¸ªä»¤ç‰Œï¼Œå°±å¯ä»¥ä½¿ç”¨æ¸¸å®¢æ¨¡å¼ä¸‹æ— æ³•ä½¿ç”¨çš„åŠŸèƒ½ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-ä»€ä¹ˆæ˜¯-Cookie"><a href="#4-ä»€ä¹ˆæ˜¯-Cookie" class="headerlink" title="4. ä»€ä¹ˆæ˜¯ Cookie"></a>4. ä»€ä¹ˆæ˜¯ Cookie</h2><ul>
<li><strong>HTTP æ˜¯æ— çŠ¶æ€çš„åè®®ï¼ˆå¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼šè¯å®Œæˆæ—¶ï¼ŒæœåŠ¡ç«¯ä¸ä¼šä¿å­˜ä»»ä½•ä¼šè¯ä¿¡æ¯</strong>ï¼‰ï¼šæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼ŒæœåŠ¡ç«¯æ— æ³•ç¡®è®¤å½“å‰è®¿é—®è€…çš„èº«ä»½ä¿¡æ¯ï¼Œæ— æ³•åˆ†è¾¨ä¸Šä¸€æ¬¡çš„è¯·æ±‚å‘é€è€…å’Œè¿™ä¸€æ¬¡çš„å‘é€è€…æ˜¯ä¸æ˜¯åŒä¸€ä¸ªäººã€‚æ‰€ä»¥æœåŠ¡å™¨ä¸æµè§ˆå™¨ä¸ºäº†è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼ˆçŸ¥é“æ˜¯è°åœ¨è®¿é—®æˆ‘ï¼‰ï¼Œå°±å¿…é¡»ä¸»åŠ¨çš„å»ç»´æŠ¤ä¸€ä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯å‰åä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚è€Œè¿™ä¸ªçŠ¶æ€éœ€è¦é€šè¿‡ cookie æˆ–è€… session å»å®ç°ã€‚</li>
<li><strong>cookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼š</strong> cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚</li>
<li><strong>cookie æ˜¯ä¸å¯è·¨åŸŸçš„ï¼š</strong> æ¯ä¸ª cookie éƒ½ä¼šç»‘å®šå•ä¸€çš„åŸŸåï¼Œæ— æ³•åœ¨åˆ«çš„åŸŸåä¸‹è·å–ä½¿ç”¨ï¼Œ<strong>ä¸€çº§åŸŸåå’ŒäºŒçº§åŸŸåä¹‹é—´æ˜¯å…è®¸å…±äº«ä½¿ç”¨çš„</strong>ï¼ˆ<strong>é çš„æ˜¯ domainï¼‰</strong>ã€‚</li>
</ul>
<p><strong>cookie é‡è¦çš„å±æ€§</strong></p>
<table>
<thead>
<tr>
<th align="left">å±æ€§</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>name&#x3D;value</strong></td>
<td align="left">é”®å€¼å¯¹ï¼Œè®¾ç½® Cookie çš„åç§°åŠç›¸å¯¹åº”çš„å€¼ï¼Œéƒ½å¿…é¡»æ˜¯<strong>å­—ç¬¦ä¸²ç±»å‹</strong> - å¦‚æœå€¼ä¸º Unicode å­—ç¬¦ï¼Œéœ€è¦ä¸ºå­—ç¬¦ç¼–ç ã€‚ - å¦‚æœå€¼ä¸ºäºŒè¿›åˆ¶æ•°æ®ï¼Œåˆ™éœ€è¦ä½¿ç”¨ BASE64 ç¼–ç ã€‚</td>
</tr>
<tr>
<td align="left"><strong>domain</strong></td>
<td align="left">æŒ‡å®š cookie æ‰€å±åŸŸåï¼Œé»˜è®¤æ˜¯å½“å‰åŸŸå</td>
</tr>
<tr>
<td align="left"><strong>path</strong></td>
<td align="left">**æŒ‡å®š cookie åœ¨å“ªä¸ªè·¯å¾„ï¼ˆè·¯ç”±ï¼‰ä¸‹ç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯ â€˜&#x2F;â€˜**ã€‚ å¦‚æœè®¾ç½®ä¸º <code>/abc</code>ï¼Œåˆ™åªæœ‰ <code>/abc</code> ä¸‹çš„è·¯ç”±å¯ä»¥è®¿é—®åˆ°è¯¥ cookieï¼Œå¦‚ï¼š<code>/abc/read</code>ã€‚</td>
</tr>
<tr>
<td align="left"><strong>maxAge</strong></td>
<td align="left">cookie å¤±æ•ˆçš„æ—¶é—´ï¼Œå•ä½ç§’ã€‚å¦‚æœä¸ºæ•´æ•°ï¼Œåˆ™è¯¥ cookie åœ¨ maxAge ç§’åå¤±æ•ˆã€‚å¦‚æœä¸ºè´Ÿæ•°ï¼Œè¯¥ cookie ä¸ºä¸´æ—¶ cookie ï¼Œå…³é—­æµè§ˆå™¨å³å¤±æ•ˆï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šä»¥ä»»ä½•å½¢å¼ä¿å­˜è¯¥ cookie ã€‚å¦‚æœä¸º 0ï¼Œè¡¨ç¤ºåˆ é™¤è¯¥ cookie ã€‚é»˜è®¤ä¸º -1ã€‚ - <strong>æ¯” expires å¥½ç”¨</strong>ã€‚</td>
</tr>
<tr>
<td align="left"><strong>expires</strong></td>
<td align="left">è¿‡æœŸæ—¶é—´ï¼Œåœ¨è®¾ç½®çš„æŸä¸ªæ—¶é—´ç‚¹åè¯¥ cookie å°±ä¼šå¤±æ•ˆã€‚ ä¸€èˆ¬æµè§ˆå™¨çš„ cookie éƒ½æ˜¯é»˜è®¤å‚¨å­˜çš„ï¼Œå½“å…³é—­æµè§ˆå™¨ç»“æŸè¿™ä¸ªä¼šè¯çš„æ—¶å€™ï¼Œè¿™ä¸ª cookie ä¹Ÿå°±ä¼šè¢«åˆ é™¤</td>
</tr>
<tr>
<td align="left"><strong>secure</strong></td>
<td align="left">è¯¥ cookie æ˜¯å¦ä»…è¢«ä½¿ç”¨å®‰å…¨åè®®ä¼ è¾“ã€‚å®‰å…¨åè®®æœ‰ HTTPSï¼ŒSSL ç­‰ï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“æ•°æ®ä¹‹å‰å…ˆå°†æ•°æ®åŠ å¯†ã€‚é»˜è®¤ä¸º falseã€‚ å½“ secure å€¼ä¸º true æ—¶ï¼Œcookie åœ¨ HTTP ä¸­æ˜¯æ— æ•ˆï¼Œåœ¨ HTTPS ä¸­æ‰æœ‰æ•ˆã€‚</td>
</tr>
<tr>
<td align="left"><strong>httpOnly</strong></td>
<td align="left"><strong>å¦‚æœç»™æŸä¸ª cookie è®¾ç½®äº† httpOnly å±æ€§ï¼Œåˆ™æ— æ³•é€šè¿‡ JS è„šæœ¬ è¯»å–åˆ°è¯¥ cookie çš„ä¿¡æ¯ï¼Œä½†è¿˜æ˜¯èƒ½é€šè¿‡ Application ä¸­æ‰‹åŠ¨ä¿®æ”¹ cookieï¼Œæ‰€ä»¥åªæ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥é˜²æ­¢ XSS æ”»å‡»ï¼Œä¸æ˜¯ç»å¯¹çš„å®‰å…¨</strong></td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="5-ä»€ä¹ˆæ˜¯-Session"><a href="#5-ä»€ä¹ˆæ˜¯-Session" class="headerlink" title="5. ä»€ä¹ˆæ˜¯ Session"></a>5. ä»€ä¹ˆæ˜¯ Session</h2><ul>
<li><strong>session æ˜¯å¦ä¸€ç§è®°å½•æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€çš„æœºåˆ¶</strong></li>
<li><strong>session æ˜¯åŸºäº cookie å®ç°çš„ï¼Œsession å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼ŒsessionId ä¼šè¢«å­˜å‚¨åˆ°å®¢æˆ·ç«¯çš„ cookie ä¸­</strong></li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/29/16f523a04d0b3cf5?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="session.png"></p>
<ul>
<li>session è®¤è¯æµç¨‹ï¼š<ul>
<li>ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨æ ¹æ®ç”¨æˆ·æäº¤çš„ç›¸å…³ä¿¡æ¯ï¼Œåˆ›å»ºå¯¹åº”çš„ Session</li>
<li>è¯·æ±‚è¿”å›æ—¶å°†æ­¤ Session çš„å”¯ä¸€æ ‡è¯†ä¿¡æ¯ SessionID è¿”å›ç»™æµè§ˆå™¨</li>
<li>æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ SessionID ä¿¡æ¯åï¼Œä¼šå°†æ­¤ä¿¡æ¯å­˜å…¥åˆ° Cookie ä¸­ï¼ŒåŒæ—¶ Cookie è®°å½•æ­¤ SessionID å±äºå“ªä¸ªåŸŸå</li>
<li>å½“ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨åˆ¤æ–­æ­¤åŸŸåä¸‹æ˜¯å¦å­˜åœ¨ Cookie ä¿¡æ¯ï¼Œå¦‚æœå­˜åœ¨è‡ªåŠ¨å°† Cookie ä¿¡æ¯ä¹Ÿå‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¼šä» Cookie ä¸­è·å– SessionIDï¼Œå†æ ¹æ® SessionID æŸ¥æ‰¾å¯¹åº”çš„ Session ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯´æ˜ç”¨æˆ·æ²¡æœ‰ç™»å½•æˆ–è€…ç™»å½•å¤±æ•ˆï¼Œå¦‚æœæ‰¾åˆ° Session è¯æ˜ç”¨æˆ·å·²ç»ç™»å½•å¯æ‰§è¡Œåé¢æ“ä½œã€‚</li>
</ul>
</li>
</ul>
<p>æ ¹æ®ä»¥ä¸Šæµç¨‹å¯çŸ¥ï¼Œ<strong>SessionID æ˜¯è¿æ¥ Cookie å’Œ Session çš„ä¸€é“æ¡¥æ¢</strong>ï¼Œå¤§éƒ¨åˆ†ç³»ç»Ÿä¹Ÿæ˜¯æ ¹æ®æ­¤åŸç†æ¥éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚</p>
<h2 id="6-Cookie-å’Œ-Session-çš„åŒºåˆ«"><a href="#6-Cookie-å’Œ-Session-çš„åŒºåˆ«" class="headerlink" title="6. Cookie å’Œ Session çš„åŒºåˆ«"></a>6. Cookie å’Œ Session çš„åŒºåˆ«</h2><ul>
<li><strong>å®‰å…¨æ€§ï¼š</strong> Session æ¯” Cookie å®‰å…¨ï¼ŒSession æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ï¼ŒCookie æ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ã€‚</li>
<li><strong>å­˜å–å€¼çš„ç±»å‹ä¸åŒ</strong>ï¼šCookie åªæ”¯æŒå­˜å­—ç¬¦ä¸²æ•°æ®ï¼Œæƒ³è¦è®¾ç½®å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œéœ€è¦å°†å…¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼ŒSession å¯ä»¥å­˜ä»»æ„æ•°æ®ç±»å‹ã€‚</li>
<li><strong>æœ‰æ•ˆæœŸä¸åŒï¼š</strong> Cookie å¯è®¾ç½®ä¸ºé•¿æ—¶é—´ä¿æŒï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„é»˜è®¤ç™»å½•åŠŸèƒ½ï¼ŒSession ä¸€èˆ¬å¤±æ•ˆæ—¶é—´è¾ƒçŸ­ï¼Œå®¢æˆ·ç«¯å…³é—­ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰æˆ–è€… Session è¶…æ—¶éƒ½ä¼šå¤±æ•ˆã€‚</li>
<li><strong>å­˜å‚¨å¤§å°ä¸åŒï¼š</strong> å•ä¸ª Cookie ä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡ 4Kï¼ŒSession å¯å­˜å‚¨æ•°æ®è¿œé«˜äº Cookieï¼Œä½†æ˜¯å½“è®¿é—®é‡è¿‡å¤šï¼Œä¼šå ç”¨è¿‡å¤šçš„æœåŠ¡å™¨èµ„æºã€‚</li>
</ul>
<h2 id="7-ä»€ä¹ˆæ˜¯-Tokenï¼ˆä»¤ç‰Œï¼‰"><a href="#7-ä»€ä¹ˆæ˜¯-Tokenï¼ˆä»¤ç‰Œï¼‰" class="headerlink" title="7. ä»€ä¹ˆæ˜¯ Tokenï¼ˆä»¤ç‰Œï¼‰"></a>7. ä»€ä¹ˆæ˜¯ Tokenï¼ˆä»¤ç‰Œï¼‰</h2><h3 id="7-1-Acesss-Token"><a href="#7-1-Acesss-Token" class="headerlink" title="7.1 Acesss Token"></a>7.1 Acesss Token</h3><ul>
<li><strong>è®¿é—®èµ„æºæ¥å£ï¼ˆAPIï¼‰æ—¶æ‰€éœ€è¦çš„èµ„æºå‡­è¯</strong></li>
<li><strong>ç®€å• token çš„ç»„æˆï¼š</strong> uid(ç”¨æˆ·å”¯ä¸€çš„èº«ä»½æ ‡è¯†)ã€time(å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³)ã€signï¼ˆç­¾åï¼Œtoken çš„å‰å‡ ä½ä»¥å“ˆå¸Œç®—æ³•å‹ç¼©æˆçš„ä¸€å®šé•¿åº¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰</li>
<li>ç‰¹ç‚¹ï¼š<ul>
<li><strong>æœåŠ¡ç«¯æ— çŠ¶æ€åŒ–ã€å¯æ‰©å±•æ€§å¥½</strong></li>
<li><strong>æ”¯æŒç§»åŠ¨ç«¯è®¾å¤‡</strong></li>
<li>å®‰å…¨</li>
<li>æ”¯æŒè·¨ç¨‹åºè°ƒç”¨</li>
</ul>
</li>
<li><strong>token çš„èº«ä»½éªŒè¯æµç¨‹ï¼š</strong></li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/29/16f523a04d9c745f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<ol>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åè·Ÿå¯†ç è¯·æ±‚ç™»å½•</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå»éªŒè¯ç”¨æˆ·åä¸å¯†ç </li>
<li>éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç­¾å‘ä¸€ä¸ª token å¹¶æŠŠè¿™ä¸ª token å‘é€ç»™å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ° token ä»¥åï¼Œä¼šæŠŠå®ƒå­˜å‚¨èµ·æ¥ï¼Œæ¯”å¦‚æ”¾åœ¨ cookie é‡Œæˆ–è€… localStorage é‡Œ</li>
<li>å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºçš„æ—¶å€™éœ€è¦å¸¦ç€æœåŠ¡ç«¯ç­¾å‘çš„ token</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå»éªŒè¯å®¢æˆ·ç«¯è¯·æ±‚é‡Œé¢å¸¦ç€çš„ token ï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›è¯·æ±‚çš„æ•°æ®</li>
</ol>
<ul>
<li><strong>æ¯ä¸€æ¬¡è¯·æ±‚éƒ½éœ€è¦æºå¸¦ tokenï¼Œéœ€è¦æŠŠ token æ”¾åˆ° HTTP çš„ Header é‡Œ</strong></li>
<li><strong>åŸºäº token çš„ç”¨æˆ·è®¤è¯æ˜¯ä¸€ç§æœåŠ¡ç«¯æ— çŠ¶æ€çš„è®¤è¯æ–¹å¼ï¼ŒæœåŠ¡ç«¯ä¸ç”¨å­˜æ”¾ token æ•°æ®ã€‚ç”¨è§£æ token çš„è®¡ç®—æ—¶é—´æ¢å– session çš„å­˜å‚¨ç©ºé—´ï¼Œä»è€Œå‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå‡å°‘é¢‘ç¹çš„æŸ¥è¯¢æ•°æ®åº“</strong></li>
<li><strong>token å®Œå…¨ç”±åº”ç”¨ç®¡ç†ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é¿å¼€åŒæºç­–ç•¥</strong></li>
</ul>
<h3 id="7-2-Refresh-Token"><a href="#7-2-Refresh-Token" class="headerlink" title="7.2 Refresh Token"></a>7.2 Refresh Token</h3><ul>
<li>å¦å¤–ä¸€ç§ tokenâ€”â€”refresh token</li>
<li>refresh token æ˜¯ä¸“ç”¨äºåˆ·æ–° access token çš„ tokenã€‚å¦‚æœæ²¡æœ‰ refresh tokenï¼Œä¹Ÿå¯ä»¥åˆ·æ–° access tokenï¼Œä½†æ¯æ¬¡åˆ·æ–°éƒ½è¦ç”¨æˆ·è¾“å…¥ç™»å½•ç”¨æˆ·åä¸å¯†ç ï¼Œä¼šå¾ˆéº»çƒ¦ã€‚æœ‰äº† refresh tokenï¼Œå¯ä»¥å‡å°‘è¿™ä¸ªéº»çƒ¦ï¼Œå®¢æˆ·ç«¯ç›´æ¥ç”¨ refresh token å»æ›´æ–° access tokenï¼Œæ— éœ€ç”¨æˆ·è¿›è¡Œé¢å¤–çš„æ“ä½œã€‚</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/29/16f523a04d1c887b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<ul>
<li>Access Token çš„æœ‰æ•ˆæœŸæ¯”è¾ƒçŸ­ï¼Œå½“ Acesss Token ç”±äºè¿‡æœŸè€Œå¤±æ•ˆæ—¶ï¼Œä½¿ç”¨ Refresh Token å°±å¯ä»¥è·å–åˆ°æ–°çš„ Tokenï¼Œå¦‚æœ Refresh Token ä¹Ÿå¤±æ•ˆäº†ï¼Œç”¨æˆ·å°±åªèƒ½é‡æ–°ç™»å½•äº†ã€‚</li>
<li>Refresh Token åŠè¿‡æœŸæ—¶é—´æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨çš„æ•°æ®åº“ä¸­ï¼Œåªæœ‰åœ¨ç”³è¯·æ–°çš„ Acesss Token æ—¶æ‰ä¼šéªŒè¯ï¼Œä¸ä¼šå¯¹ä¸šåŠ¡æ¥å£å“åº”æ—¶é—´é€ æˆå½±å“ï¼Œä¹Ÿä¸éœ€è¦å‘ Session ä¸€æ ·ä¸€ç›´ä¿æŒåœ¨å†…å­˜ä¸­ä»¥åº”å¯¹å¤§é‡çš„è¯·æ±‚ã€‚</li>
</ul>
<h2 id="8-Token-å’Œ-Session-çš„åŒºåˆ«"><a href="#8-Token-å’Œ-Session-çš„åŒºåˆ«" class="headerlink" title="8. Token å’Œ Session çš„åŒºåˆ«"></a>8. Token å’Œ Session çš„åŒºåˆ«</h2><ul>
<li>Session æ˜¯ä¸€ç§<strong>è®°å½•æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€çš„æœºåˆ¶ï¼Œä½¿æœåŠ¡ç«¯æœ‰çŠ¶æ€åŒ–ï¼Œå¯ä»¥è®°å½•ä¼šè¯ä¿¡æ¯</strong>ã€‚è€Œ Token æ˜¯<strong>ä»¤ç‰Œ</strong>ï¼Œ<strong>è®¿é—®èµ„æºæ¥å£ï¼ˆAPIï¼‰æ—¶æ‰€éœ€è¦çš„èµ„æºå‡­è¯</strong>ã€‚Token <strong>ä½¿æœåŠ¡ç«¯æ— çŠ¶æ€åŒ–ï¼Œä¸ä¼šå­˜å‚¨ä¼šè¯ä¿¡æ¯ã€‚</strong></li>
<li>Session å’Œ Token å¹¶ä¸çŸ›ç›¾ï¼Œä½œä¸ºèº«ä»½è®¤è¯ Token å®‰å…¨æ€§æ¯” Session å¥½ï¼Œå› ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚éƒ½æœ‰ç­¾åè¿˜èƒ½é˜²æ­¢ç›‘å¬ä»¥åŠé‡æ”¾æ”»å‡»ï¼Œè€Œ Session å°±å¿…é¡»ä¾èµ–é“¾è·¯å±‚æ¥ä¿éšœé€šè®¯å®‰å…¨äº†ã€‚<strong>å¦‚æœä½ éœ€è¦å®ç°æœ‰çŠ¶æ€çš„ä¼šè¯ï¼Œä»ç„¶å¯ä»¥å¢åŠ  Session æ¥åœ¨æœåŠ¡å™¨ç«¯ä¿å­˜ä¸€äº›çŠ¶æ€ã€‚</strong></li>
<li>æ‰€è°“ Session è®¤è¯åªæ˜¯ç®€å•çš„æŠŠ User ä¿¡æ¯å­˜å‚¨åˆ° Session é‡Œï¼Œå› ä¸º SessionID çš„ä¸å¯é¢„æµ‹æ€§ï¼Œæš‚ä¸”è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚è€Œ Token ï¼Œå¦‚æœæŒ‡çš„æ˜¯ OAuth Token æˆ–ç±»ä¼¼çš„æœºåˆ¶çš„è¯ï¼Œæä¾›çš„æ˜¯ è®¤è¯ å’Œ æˆæƒ ï¼Œè®¤è¯æ˜¯é’ˆå¯¹ç”¨æˆ·ï¼Œæˆæƒæ˜¯é’ˆå¯¹ App ã€‚å…¶ç›®çš„æ˜¯è®©æŸ App æœ‰æƒåˆ©è®¿é—®æŸç”¨æˆ·çš„ä¿¡æ¯ã€‚è¿™é‡Œçš„ Token æ˜¯å”¯ä¸€çš„ã€‚ä¸å¯ä»¥è½¬ç§»åˆ°å…¶å®ƒ App ä¸Šï¼Œä¹Ÿä¸å¯ä»¥è½¬åˆ°å…¶å®ƒç”¨æˆ·ä¸Šã€‚Session åªæä¾›ä¸€ç§ç®€å•çš„è®¤è¯ï¼Œå³åªè¦æœ‰æ­¤ SessionID ï¼Œå³è®¤ä¸ºæœ‰æ­¤ User çš„å…¨éƒ¨æƒåˆ©ã€‚æ˜¯éœ€è¦ä¸¥æ ¼ä¿å¯†çš„ï¼Œè¿™ä¸ªæ•°æ®åº”è¯¥åªä¿å­˜åœ¨ç«™æ–¹ï¼Œä¸åº”è¯¥å…±äº«ç»™å…¶å®ƒç½‘ç«™æˆ–è€…ç¬¬ä¸‰æ–¹ Appã€‚æ‰€ä»¥ç®€å•æ¥è¯´ï¼š<strong>å¦‚æœä½ çš„ç”¨æˆ·æ•°æ®å¯èƒ½éœ€è¦å’Œç¬¬ä¸‰æ–¹å…±äº«ï¼Œæˆ–è€…å…è®¸ç¬¬ä¸‰æ–¹è°ƒç”¨ API æ¥å£ï¼Œç”¨ Token ã€‚å¦‚æœæ°¸è¿œåªæ˜¯è‡ªå·±çš„ç½‘ç«™ï¼Œè‡ªå·±çš„ Appï¼Œç”¨ä»€ä¹ˆå°±æ— æ‰€è°“äº†ã€‚</strong></li>
</ul>
<h2 id="9-ä»€ä¹ˆæ˜¯-JWT"><a href="#9-ä»€ä¹ˆæ˜¯-JWT" class="headerlink" title="9. ä»€ä¹ˆæ˜¯ JWT"></a>9. ä»€ä¹ˆæ˜¯ JWT</h2><ul>
<li>JSON Web Tokenï¼ˆç®€ç§° JWTï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„<strong>è·¨åŸŸè®¤è¯</strong>è§£å†³æ–¹æ¡ˆã€‚</li>
<li>æ˜¯ä¸€ç§<strong>è®¤è¯æˆæƒæœºåˆ¶</strong>ã€‚</li>
<li>JWT æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´<strong>ä¼ é€’å£°æ˜</strong>è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäº JSON çš„å¼€æ”¾æ ‡å‡†ï¼ˆ<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519" title="RFC 7519">RFC 7519</a>ï¼‰ã€‚JWT çš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºã€‚æ¯”å¦‚ç”¨åœ¨ç”¨æˆ·ç™»å½•ä¸Šã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–è€…æ˜¯ RSA çš„å…¬&#x2F;ç§ç§˜é’¥å¯¹ JWT è¿›è¡Œç­¾åã€‚å› ä¸ºæ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œè¿™äº›ä¼ é€’çš„ä¿¡æ¯æ˜¯å¯ä¿¡çš„ã€‚</li>
<li><strong>é˜®ä¸€å³°è€å¸ˆçš„ <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html" title="JSON Web Token å…¥é—¨æ•™ç¨‹">JSON Web Token å…¥é—¨æ•™ç¨‹</a> è®²çš„éå¸¸é€šä¿—æ˜“æ‡‚ï¼Œè¿™é‡Œå°±ä¸å†ç­é—¨å¼„æ–§äº†</strong></li>
</ul>
<h3 id="9-1-ç”Ÿæˆ-JWT"><a href="#9-1-ç”Ÿæˆ-JWT" class="headerlink" title="9.1 ç”Ÿæˆ JWT"></a>9.1 ç”Ÿæˆ JWT</h3><p><a target="_blank" rel="noopener" href="https://jwt.io/" title="jwt.io/">jwt.io&#x2F;</a><br><a target="_blank" rel="noopener" href="https://www.jsonwebtoken.io/" title="www.jsonwebtoken.io/">www.jsonwebtoken.io/</a></p>
<h3 id="9-2-JWT-çš„åŸç†"><a href="#9-2-JWT-çš„åŸç†" class="headerlink" title="9.2 JWT çš„åŸç†"></a>9.2 JWT çš„åŸç†</h3><p><img src="https://user-gold-cdn.xitu.io/2019/12/29/16f523a04e881087?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<ul>
<li>JWT è®¤è¯æµç¨‹ï¼š<ul>
<li>ç”¨æˆ·è¾“å…¥ç”¨æˆ·å&#x2F;å¯†ç ç™»å½•ï¼ŒæœåŠ¡ç«¯è®¤è¯æˆåŠŸåï¼Œä¼šè¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ª JWT</li>
<li>å®¢æˆ·ç«¯å°† token ä¿å­˜åˆ°æœ¬åœ°ï¼ˆé€šå¸¸ä½¿ç”¨ localstorageï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ cookieï¼‰</li>
<li>å½“ç”¨æˆ·å¸Œæœ›è®¿é—®ä¸€ä¸ªå—ä¿æŠ¤çš„è·¯ç”±æˆ–è€…èµ„æºçš„æ—¶å€™ï¼Œéœ€è¦è¯·æ±‚å¤´çš„ Authorization å­—æ®µä¸­ä½¿ç”¨ Bearer æ¨¡å¼æ·»åŠ  JWTï¼Œå…¶å†…å®¹çœ‹èµ·æ¥æ˜¯ä¸‹é¢è¿™æ ·</li>
</ul>
</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>æœåŠ¡ç«¯çš„ä¿æŠ¤è·¯ç”±å°†ä¼šæ£€æŸ¥è¯·æ±‚å¤´ Authorization ä¸­çš„ JWT ä¿¡æ¯ï¼Œå¦‚æœåˆæ³•ï¼Œåˆ™å…è®¸ç”¨æˆ·çš„è¡Œä¸º</li>
<li>å› ä¸º JWT æ˜¯è‡ªåŒ…å«çš„ï¼ˆå†…éƒ¨åŒ…å«äº†ä¸€äº›ä¼šè¯ä¿¡æ¯ï¼‰ï¼Œå› æ­¤å‡å°‘äº†éœ€è¦æŸ¥è¯¢æ•°æ®åº“çš„éœ€è¦</li>
<li>å› ä¸º JWT å¹¶ä¸ä½¿ç”¨ Cookie çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•åŸŸåæä¾›ä½ çš„ API æœåŠ¡è€Œä¸éœ€è¦æ‹…å¿ƒè·¨åŸŸèµ„æºå…±äº«é—®é¢˜ï¼ˆCORSï¼‰</li>
<li>å› ä¸ºç”¨æˆ·çš„çŠ¶æ€ä¸å†å­˜å‚¨åœ¨æœåŠ¡ç«¯çš„å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ç§æ— çŠ¶æ€çš„è®¤è¯æœºåˆ¶</li>
</ul>
<h3 id="9-3-JWT-çš„ä½¿ç”¨æ–¹å¼"><a href="#9-3-JWT-çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="9.3 JWT çš„ä½¿ç”¨æ–¹å¼"></a>9.3 JWT çš„ä½¿ç”¨æ–¹å¼</h3><ul>
<li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ JWTï¼Œå¯ä»¥å‚¨å­˜åœ¨ Cookie é‡Œé¢ï¼Œä¹Ÿå¯ä»¥å‚¨å­˜åœ¨ localStorageã€‚</li>
</ul>
<h4 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h4><ul>
<li><p>å½“ç”¨æˆ·å¸Œæœ›è®¿é—®ä¸€ä¸ªå—ä¿æŠ¤çš„è·¯ç”±æˆ–è€…èµ„æºçš„æ—¶å€™ï¼Œå¯ä»¥æŠŠå®ƒæ”¾åœ¨ Cookie é‡Œé¢è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯è¿™æ ·ä¸èƒ½è·¨åŸŸï¼Œæ‰€ä»¥æ›´å¥½çš„åšæ³•æ˜¯æ”¾åœ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯çš„ Authorization å­—æ®µé‡Œï¼Œä½¿ç”¨ Bearer æ¨¡å¼æ·»åŠ  JWTã€‚</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /calendar/v1/events</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>api.example.com</span><br><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”¨æˆ·çš„çŠ¶æ€ä¸ä¼šå­˜å‚¨åœ¨æœåŠ¡ç«¯çš„å†…å­˜ä¸­ï¼Œè¿™æ˜¯ä¸€ç§ <strong>æ— çŠ¶æ€çš„è®¤è¯æœºåˆ¶</strong></p>
<ul>
<li>æœåŠ¡ç«¯çš„ä¿æŠ¤è·¯ç”±å°†ä¼šæ£€æŸ¥è¯·æ±‚å¤´ Authorization ä¸­çš„ JWT ä¿¡æ¯ï¼Œå¦‚æœåˆæ³•ï¼Œåˆ™å…è®¸ç”¨æˆ·çš„è¡Œä¸ºã€‚</li>
<li>ç”±äº JWT æ˜¯è‡ªåŒ…å«çš„ï¼Œå› æ­¤å‡å°‘äº†éœ€è¦æŸ¥è¯¢æ•°æ®åº“çš„éœ€è¦</li>
<li>JWT çš„è¿™äº›ç‰¹æ€§ä½¿å¾—æˆ‘ä»¬å¯ä»¥å®Œå…¨ä¾èµ–å…¶æ— çŠ¶æ€çš„ç‰¹æ€§æä¾›æ•°æ® API æœåŠ¡ï¼Œç”šè‡³æ˜¯åˆ›å»ºä¸€ä¸ªä¸‹è½½æµæœåŠ¡ã€‚</li>
<li>å› ä¸º JWT å¹¶ä¸ä½¿ç”¨ Cookie ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•åŸŸåæä¾›ä½ çš„ API æœåŠ¡è€Œ<strong>ä¸éœ€è¦æ‹…å¿ƒè·¨åŸŸèµ„æºå…±äº«é—®é¢˜</strong>ï¼ˆCORSï¼‰</li>
</ul>
</li>
</ul>
<h4 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h4><ul>
<li>è·¨åŸŸçš„æ—¶å€™ï¼Œå¯ä»¥æŠŠ JWT æ”¾åœ¨ POST è¯·æ±‚çš„æ•°æ®ä½“é‡Œã€‚</li>
</ul>
<h4 id="æ–¹å¼ä¸‰"><a href="#æ–¹å¼ä¸‰" class="headerlink" title="æ–¹å¼ä¸‰"></a>æ–¹å¼ä¸‰</h4><ul>
<li>é€šè¿‡ URL ä¼ è¾“</li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com/user?token=xxx</span><br></pre></td></tr></table></figure>

<h3 id="9-4-é¡¹ç›®ä¸­ä½¿ç”¨-JWT"><a href="#9-4-é¡¹ç›®ä¸­ä½¿ç”¨-JWT" class="headerlink" title="9.4 é¡¹ç›®ä¸­ä½¿ç”¨ JWT"></a>9.4 é¡¹ç›®ä¸­ä½¿ç”¨ JWT</h3><p><a target="_blank" rel="noopener" href="https://github.com/yjdjiayou/jwt-demo" title="**é¡¹ç›®åœ°å€**"><strong>é¡¹ç›®åœ°å€</strong></a></p>
<h2 id="10-Token-å’Œ-JWT-çš„åŒºåˆ«"><a href="#10-Token-å’Œ-JWT-çš„åŒºåˆ«" class="headerlink" title="10. Token å’Œ JWT çš„åŒºåˆ«"></a>10. Token å’Œ JWT çš„åŒºåˆ«</h2><p><strong>ç›¸åŒï¼š</strong></p>
<ul>
<li>éƒ½æ˜¯è®¿é—®èµ„æºçš„ä»¤ç‰Œ</li>
<li>éƒ½å¯ä»¥è®°å½•ç”¨æˆ·çš„ä¿¡æ¯</li>
<li>éƒ½æ˜¯ä½¿æœåŠ¡ç«¯æ— çŠ¶æ€åŒ–</li>
<li>éƒ½æ˜¯åªæœ‰éªŒè¯æˆåŠŸåï¼Œå®¢æˆ·ç«¯æ‰èƒ½è®¿é—®æœåŠ¡ç«¯ä¸Šå—ä¿æŠ¤çš„èµ„æº</li>
</ul>
<p><strong>åŒºåˆ«ï¼š</strong></p>
<ul>
<li>Tokenï¼šæœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ Token æ—¶ï¼Œè¿˜éœ€è¦æŸ¥è¯¢æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åéªŒè¯ Token æ˜¯å¦æœ‰æ•ˆã€‚</li>
<li>JWTï¼š å°† Token å’Œ Payload åŠ å¯†åå­˜å‚¨äºå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯åªéœ€è¦ä½¿ç”¨å¯†é’¥è§£å¯†è¿›è¡Œæ ¡éªŒï¼ˆæ ¡éªŒä¹Ÿæ˜¯ JWT è‡ªå·±å®ç°çš„ï¼‰å³å¯ï¼Œä¸éœ€è¦æŸ¥è¯¢æˆ–è€…å‡å°‘æŸ¥è¯¢æ•°æ®åº“ï¼Œå› ä¸º JWT è‡ªåŒ…å«äº†ç”¨æˆ·ä¿¡æ¯å’ŒåŠ å¯†çš„æ•°æ®ã€‚</li>
</ul>
<h2 id="11-å¸¸è§çš„å‰åç«¯é‰´æƒæ–¹å¼"><a href="#11-å¸¸è§çš„å‰åç«¯é‰´æƒæ–¹å¼" class="headerlink" title="11. å¸¸è§çš„å‰åç«¯é‰´æƒæ–¹å¼"></a>11. å¸¸è§çš„å‰åç«¯é‰´æƒæ–¹å¼</h2><ol>
<li>Session-Cookie</li>
<li>Token éªŒè¯ï¼ˆåŒ…æ‹¬ JWTï¼ŒSSOï¼‰</li>
<li>OAuth2.0ï¼ˆå¼€æ”¾æˆæƒï¼‰</li>
</ol>
<h2 id="12-å¸¸è§çš„åŠ å¯†ç®—æ³•"><a href="#12-å¸¸è§çš„åŠ å¯†ç®—æ³•" class="headerlink" title="12. å¸¸è§çš„åŠ å¯†ç®—æ³•"></a>12. å¸¸è§çš„åŠ å¯†ç®—æ³•</h2><p><img src="https://user-gold-cdn.xitu.io/2019/12/29/16f523a04f17f2fc?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<ul>
<li>å“ˆå¸Œç®—æ³•(Hash Algorithm)åˆç§°æ•£åˆ—ç®—æ³•ã€æ•£åˆ—å‡½æ•°ã€å“ˆå¸Œå‡½æ•°ï¼Œæ˜¯ä¸€ç§ä»ä»»ä½•ä¸€ç§æ•°æ®ä¸­åˆ›å»ºå°çš„æ•°å­—â€œæŒ‡çº¹â€çš„æ–¹æ³•ã€‚å“ˆå¸Œç®—æ³•å°†æ•°æ®é‡æ–°æ‰“ä¹±æ··åˆï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªå“ˆå¸Œå€¼ã€‚</li>
<li>å“ˆå¸Œç®—æ³•ä¸»è¦ç”¨æ¥ä¿éšœæ•°æ®çœŸå®æ€§(å³å®Œæ•´æ€§)ï¼Œå³å‘ä¿¡äººå°†åŸå§‹æ¶ˆæ¯å’Œå“ˆå¸Œå€¼ä¸€èµ·å‘é€ï¼Œæ”¶ä¿¡äººé€šè¿‡ç›¸åŒçš„å“ˆå¸Œå‡½æ•°æ¥æ ¡éªŒåŸå§‹æ•°æ®æ˜¯å¦çœŸå®ã€‚</li>
<li>å“ˆå¸Œç®—æ³•é€šå¸¸æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š<ul>
<li>æ­£åƒå¿«é€Ÿï¼šåŸå§‹æ•°æ®å¯ä»¥å¿«é€Ÿè®¡ç®—å‡ºå“ˆå¸Œå€¼</li>
<li>é€†å‘å›°éš¾ï¼šé€šè¿‡å“ˆå¸Œå€¼åŸºæœ¬ä¸å¯èƒ½æ¨å¯¼å‡ºåŸå§‹æ•°æ®</li>
<li>è¾“å…¥æ•æ„Ÿï¼šåŸå§‹æ•°æ®åªè¦æœ‰ä¸€ç‚¹å˜åŠ¨ï¼Œå¾—åˆ°çš„å“ˆå¸Œå€¼å·®åˆ«å¾ˆå¤§</li>
<li>å†²çªé¿å…ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸åŒçš„åŸå§‹æ•°æ®å¾—åˆ°ç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå®‡å®™ä¸­åŸå­æ•°å¤§çº¦åœ¨ 10 çš„ 60 æ¬¡æ–¹åˆ° 80 æ¬¡æ–¹ä¹‹é—´ï¼Œæ‰€ä»¥ 2 çš„ 256 æ¬¡æ–¹æœ‰è¶³å¤Ÿçš„ç©ºé—´å®¹çº³æ‰€æœ‰çš„å¯èƒ½ï¼Œç®—æ³•å¥½çš„æƒ…å†µä¸‹å†²çªç¢°æ’çš„æ¦‚ç‡å¾ˆä½ï¼š<ul>
<li>2 çš„ 128 æ¬¡æ–¹ä¸º 340282366920938463463374607431768211456ï¼Œä¹Ÿå°±æ˜¯ 10 çš„ 39 æ¬¡æ–¹çº§åˆ«</li>
<li>2 çš„ 160 æ¬¡æ–¹ä¸º 1.4615016373309029182036848327163e+48ï¼Œä¹Ÿå°±æ˜¯ 10 çš„ 48 æ¬¡æ–¹çº§åˆ«</li>
<li>2 çš„ 256 æ¬¡æ–¹ä¸º 1.1579208923731619542357098500869 Ã— 10 çš„ 77 æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯ 10 çš„ 77 æ¬¡æ–¹</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ol>
<li>ä»¥ä¸Šä¸èƒ½ä¿è¯æ•°æ®è¢«æ¶æ„ç¯¡æ”¹ï¼ŒåŸå§‹æ•°æ®å’Œå“ˆå¸Œå€¼éƒ½å¯èƒ½è¢«æ¶æ„ç¯¡æ”¹ï¼Œè¦ä¿è¯ä¸è¢«ç¯¡æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ RSA å…¬é’¥ç§é’¥æ–¹æ¡ˆï¼Œå†é…åˆå“ˆå¸Œå€¼ã€‚</li>
<li>å“ˆå¸Œç®—æ³•ä¸»è¦ç”¨æ¥é˜²æ­¢è®¡ç®—æœºä¼ è¾“è¿‡ç¨‹ä¸­çš„é”™è¯¯ï¼Œæ—©æœŸè®¡ç®—æœºé€šè¿‡å‰ 7 ä½æ•°æ®ç¬¬ 8 ä½å¥‡å¶æ ¡éªŒç æ¥ä¿éšœï¼ˆ12.5% çš„æµªè´¹æ•ˆç‡ä½ï¼‰ï¼Œå¯¹äºä¸€æ®µæ•°æ®æˆ–æ–‡ä»¶ï¼Œé€šè¿‡å“ˆå¸Œç®—æ³•ç”Ÿæˆ 128bit æˆ–è€… 256bit çš„å“ˆå¸Œå€¼ï¼Œå¦‚æœæ ¡éªŒæœ‰é—®é¢˜å°±è¦æ±‚é‡ä¼ ã€‚</li>
</ol>
<h2 id="13-å¸¸è§é—®é¢˜"><a href="#13-å¸¸è§é—®é¢˜" class="headerlink" title="13. å¸¸è§é—®é¢˜"></a>13. å¸¸è§é—®é¢˜</h2><h3 id="13-1-ä½¿ç”¨-cookie-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"><a href="#13-1-ä½¿ç”¨-cookie-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜" class="headerlink" title="13.1 ä½¿ç”¨ cookie æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"></a>13.1 ä½¿ç”¨ cookie æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</h3><ul>
<li>å› ä¸ºå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œå®¹æ˜“è¢«å®¢æˆ·ç«¯ç¯¡æ”¹ï¼Œä½¿ç”¨å‰éœ€è¦éªŒè¯åˆæ³•æ€§</li>
<li>ä¸è¦å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·å¯†ç ï¼Œè´¦æˆ·ä½™é¢</li>
<li>ä½¿ç”¨ httpOnly åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å®‰å…¨æ€§</li>
<li>å°½é‡å‡å°‘ cookie çš„ä½“ç§¯ï¼Œèƒ½å­˜å‚¨çš„æ•°æ®é‡ä¸èƒ½è¶…è¿‡ 4kb</li>
<li>è®¾ç½®æ­£ç¡®çš„ domain å’Œ pathï¼Œå‡å°‘æ•°æ®ä¼ è¾“</li>
<li><strong>cookie æ— æ³•è·¨åŸŸ</strong></li>
<li>ä¸€ä¸ªæµè§ˆå™¨é’ˆå¯¹ä¸€ä¸ªç½‘ç«™æœ€å¤šå­˜ 20 ä¸ª Cookieï¼Œæµè§ˆå™¨ä¸€èˆ¬åªå…è®¸å­˜æ”¾ 300 ä¸ª Cookie</li>
<li><strong>ç§»åŠ¨ç«¯å¯¹ cookie çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œè€Œ session éœ€è¦åŸºäº cookie å®ç°ï¼Œæ‰€ä»¥ç§»åŠ¨ç«¯å¸¸ç”¨çš„æ˜¯ token</strong></li>
</ul>
<h3 id="13-2-ä½¿ç”¨-session-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"><a href="#13-2-ä½¿ç”¨-session-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜" class="headerlink" title="13.2 ä½¿ç”¨ session æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"></a>13.2 ä½¿ç”¨ session æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</h3><ul>
<li>å°† session å­˜å‚¨åœ¨æœåŠ¡å™¨é‡Œé¢ï¼Œå½“ç”¨æˆ·åŒæ—¶åœ¨çº¿é‡æ¯”è¾ƒå¤šæ—¶ï¼Œè¿™äº› session ä¼šå æ®è¾ƒå¤šçš„å†…å­˜ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯å®šæœŸçš„å»æ¸…ç†è¿‡æœŸçš„ session</li>
<li>å½“ç½‘ç«™é‡‡ç”¨<strong>é›†ç¾¤éƒ¨ç½²</strong>çš„æ—¶å€™ï¼Œä¼šé‡åˆ°å¤šå° web æœåŠ¡å™¨ä¹‹é—´å¦‚ä½•åš session å…±äº«çš„é—®é¢˜ã€‚å› ä¸º session æ˜¯ç”±å•ä¸ªæœåŠ¡å™¨åˆ›å»ºçš„ï¼Œä½†æ˜¯å¤„ç†ç”¨æˆ·è¯·æ±‚çš„æœåŠ¡å™¨ä¸ä¸€å®šæ˜¯é‚£ä¸ªåˆ›å»º session çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å™¨å°±æ— æ³•æ‹¿åˆ°ä¹‹å‰å·²ç»æ”¾å…¥åˆ° session ä¸­çš„ç™»å½•å‡­è¯ä¹‹ç±»çš„ä¿¡æ¯äº†ã€‚</li>
<li>å½“å¤šä¸ªåº”ç”¨è¦å…±äº« session æ—¶ï¼Œé™¤äº†ä»¥ä¸Šé—®é¢˜ï¼Œè¿˜ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ï¼Œå› ä¸ºä¸åŒçš„åº”ç”¨å¯èƒ½éƒ¨ç½²çš„ä¸»æœºä¸ä¸€æ ·ï¼Œéœ€è¦åœ¨å„ä¸ªåº”ç”¨åšå¥½ cookie è·¨åŸŸçš„å¤„ç†ã€‚</li>
<li><strong>sessionId æ˜¯å­˜å‚¨åœ¨ cookie ä¸­çš„ï¼Œå‡å¦‚æµè§ˆå™¨ç¦æ­¢ cookie æˆ–ä¸æ”¯æŒ cookie æ€ä¹ˆåŠï¼Ÿ</strong> ä¸€èˆ¬ä¼šæŠŠ sessionId è·Ÿåœ¨ url å‚æ•°åé¢å³é‡å†™ urlï¼Œæ‰€ä»¥ session ä¸ä¸€å®šéå¾—éœ€è¦é  cookie å®ç°</li>
<li><strong>ç§»åŠ¨ç«¯å¯¹ cookie çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œè€Œ session éœ€è¦åŸºäº cookie å®ç°ï¼Œæ‰€ä»¥ç§»åŠ¨ç«¯å¸¸ç”¨çš„æ˜¯ token</strong></li>
</ul>
<h3 id="13-3-ä½¿ç”¨-token-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"><a href="#13-3-ä½¿ç”¨-token-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜" class="headerlink" title="13.3 ä½¿ç”¨ token æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"></a>13.3 ä½¿ç”¨ token æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</h3><ul>
<li>å¦‚æœä½ è®¤ä¸ºç”¨æ•°æ®åº“æ¥å­˜å‚¨ token ä¼šå¯¼è‡´æŸ¥è¯¢æ—¶é—´å¤ªé•¿ï¼Œå¯ä»¥é€‰æ‹©æ”¾åœ¨å†…å­˜å½“ä¸­ã€‚æ¯”å¦‚ redis å¾ˆé€‚åˆä½ å¯¹ token æŸ¥è¯¢çš„éœ€æ±‚ã€‚</li>
<li><strong>token å®Œå…¨ç”±åº”ç”¨ç®¡ç†ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é¿å¼€åŒæºç­–ç•¥</strong></li>
<li><strong>token å¯ä»¥é¿å… CSRF æ”»å‡»(å› ä¸ºä¸éœ€è¦ cookie äº†)</strong></li>
<li><strong>ç§»åŠ¨ç«¯å¯¹ cookie çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œè€Œ session éœ€è¦åŸºäº cookie å®ç°ï¼Œæ‰€ä»¥ç§»åŠ¨ç«¯å¸¸ç”¨çš„æ˜¯ token</strong></li>
</ul>
<h3 id="13-4-ä½¿ç”¨-JWT-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"><a href="#13-4-ä½¿ç”¨-JWT-æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜" class="headerlink" title="13.4 ä½¿ç”¨ JWT æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"></a>13.4 ä½¿ç”¨ JWT æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</h3><ul>
<li>å› ä¸º JWT å¹¶ä¸ä¾èµ– Cookie çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•åŸŸåæä¾›ä½ çš„ API æœåŠ¡è€Œä¸éœ€è¦æ‹…å¿ƒè·¨åŸŸèµ„æºå…±äº«é—®é¢˜ï¼ˆCORSï¼‰</li>
<li>JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚</li>
<li>JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</li>
<li>JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</li>
<li>JWT æœ€å¤§çš„ä¼˜åŠ¿æ˜¯æœåŠ¡å™¨ä¸å†éœ€è¦å­˜å‚¨ Sessionï¼Œä½¿å¾—æœåŠ¡å™¨è®¤è¯é‰´æƒä¸šåŠ¡å¯ä»¥æ–¹ä¾¿æ‰©å±•ã€‚ä½†è¿™ä¹Ÿæ˜¯ JWT æœ€å¤§çš„ç¼ºç‚¹ï¼šç”±äºæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ Session çŠ¶æ€ï¼Œå› æ­¤ä½¿ç”¨è¿‡ç¨‹ä¸­æ— æ³•åºŸå¼ƒæŸä¸ª Token æˆ–è€…æ›´æ”¹ Token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</li>
<li>JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</li>
<li>JWT é€‚åˆä¸€æ¬¡æ€§çš„å‘½ä»¤è®¤è¯ï¼Œé¢å‘ä¸€ä¸ªæœ‰æ•ˆæœŸæçŸ­çš„ JWTï¼Œå³ä½¿æš´éœ²äº†å±é™©ä¹Ÿå¾ˆå°ï¼Œç”±äºæ¯æ¬¡æ“ä½œéƒ½ä¼šç”Ÿæˆæ–°çš„ JWTï¼Œå› æ­¤ä¹Ÿæ²¡å¿…è¦ä¿å­˜ JWTï¼ŒçœŸæ­£å®ç°æ— çŠ¶æ€ã€‚</li>
<li>ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</li>
</ul>
<h3 id="13-5-ä½¿ç”¨åŠ å¯†ç®—æ³•æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"><a href="#13-5-ä½¿ç”¨åŠ å¯†ç®—æ³•æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜" class="headerlink" title="13.5 ä½¿ç”¨åŠ å¯†ç®—æ³•æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜"></a>13.5 ä½¿ç”¨åŠ å¯†ç®—æ³•æ—¶éœ€è¦è€ƒè™‘çš„é—®é¢˜</h3><ul>
<li>ç»ä¸è¦ä»¥<strong>æ˜æ–‡å­˜å‚¨</strong>å¯†ç </li>
<li><strong>æ°¸è¿œä½¿ç”¨ å“ˆå¸Œç®—æ³• æ¥å¤„ç†å¯†ç ï¼Œç»ä¸è¦ä½¿ç”¨ Base64 æˆ–å…¶ä»–ç¼–ç æ–¹å¼æ¥å­˜å‚¨å¯†ç ï¼Œè¿™å’Œä»¥æ˜æ–‡å­˜å‚¨å¯†ç æ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨å“ˆå¸Œï¼Œè€Œä¸è¦ä½¿ç”¨ç¼–ç </strong>ã€‚ç¼–ç ä»¥åŠåŠ å¯†ï¼Œéƒ½æ˜¯åŒå‘çš„è¿‡ç¨‹ï¼Œè€Œå¯†ç æ˜¯ä¿å¯†çš„ï¼Œåº”è¯¥åªè¢«å®ƒçš„æ‰€æœ‰è€…çŸ¥é“ï¼Œ è¿™ä¸ªè¿‡ç¨‹å¿…é¡»æ˜¯å•å‘çš„ã€‚å“ˆå¸Œæ­£æ˜¯ç”¨äºåšè¿™ä¸ªçš„ï¼Œä»æ¥æ²¡æœ‰è§£å“ˆå¸Œè¿™ç§è¯´æ³•ï¼Œ ä½†æ˜¯ç¼–ç å°±å­˜åœ¨è§£ç ï¼ŒåŠ å¯†å°±å­˜åœ¨è§£å¯†ã€‚</li>
<li>ç»ä¸è¦ä½¿ç”¨å¼±å“ˆå¸Œæˆ–å·²è¢«ç ´è§£çš„å“ˆå¸Œç®—æ³•ï¼Œåƒ MD5 æˆ– SHA1 ï¼Œåªä½¿ç”¨å¼ºå¯†ç å“ˆå¸Œç®—æ³•ã€‚</li>
<li>ç»ä¸è¦ä»¥æ˜æ–‡å½¢å¼æ˜¾ç¤ºæˆ–å‘é€å¯†ç ï¼Œå³ä½¿æ˜¯å¯¹å¯†ç çš„æ‰€æœ‰è€…ä¹Ÿåº”è¯¥è¿™æ ·ã€‚å¦‚æœä½ éœ€è¦ â€œå¿˜è®°å¯†ç â€ çš„åŠŸèƒ½ï¼Œå¯ä»¥éšæœºç”Ÿæˆä¸€ä¸ªæ–°çš„ <strong>ä¸€æ¬¡æ€§çš„</strong>ï¼ˆè¿™ç‚¹å¾ˆé‡è¦ï¼‰å¯†ç ï¼Œç„¶åæŠŠè¿™ä¸ªå¯†ç å‘é€ç»™ç”¨æˆ·ã€‚</li>
</ul>
<h3 id="13-6-åˆ†å¸ƒå¼æ¶æ„ä¸‹-session-å…±äº«æ–¹æ¡ˆ"><a href="#13-6-åˆ†å¸ƒå¼æ¶æ„ä¸‹-session-å…±äº«æ–¹æ¡ˆ" class="headerlink" title="13.6 åˆ†å¸ƒå¼æ¶æ„ä¸‹ session å…±äº«æ–¹æ¡ˆ"></a>13.6 åˆ†å¸ƒå¼æ¶æ„ä¸‹ session å…±äº«æ–¹æ¡ˆ</h3><h4 id="1-session-å¤åˆ¶"><a href="#1-session-å¤åˆ¶" class="headerlink" title="1. session å¤åˆ¶"></a>1. session å¤åˆ¶</h4><ul>
<li>ä»»ä½•ä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ session å‘ç”Ÿæ”¹å˜ï¼ˆå¢åˆ æ”¹ï¼‰ï¼Œè¯¥èŠ‚ç‚¹ä¼šæŠŠè¿™ä¸ª session çš„æ‰€æœ‰å†…å®¹åºåˆ—åŒ–ï¼Œç„¶åå¹¿æ’­ç»™æ‰€æœ‰å…¶å®ƒèŠ‚ç‚¹ï¼Œä¸ç®¡å…¶ä»–æœåŠ¡å™¨éœ€ä¸éœ€è¦ session ï¼Œä»¥æ­¤æ¥ä¿è¯ session åŒæ­¥</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong> å¯å®¹é”™ï¼Œå„ä¸ªæœåŠ¡å™¨é—´ session èƒ½å¤Ÿå®æ—¶å“åº”ã€‚<br><strong>ç¼ºç‚¹ï¼š</strong> ä¼šå¯¹ç½‘ç»œè´Ÿè·é€ æˆä¸€å®šå‹åŠ›ï¼Œå¦‚æœ session é‡å¤§çš„è¯å¯èƒ½ä¼šé€ æˆç½‘ç»œå µå¡ï¼Œæ‹–æ…¢æœåŠ¡å™¨æ€§èƒ½ã€‚</p>
<h4 id="2-ç²˜æ€§-session-x2F-IP-ç»‘å®šç­–ç•¥"><a href="#2-ç²˜æ€§-session-x2F-IP-ç»‘å®šç­–ç•¥" class="headerlink" title="2. ç²˜æ€§ session &#x2F;IP ç»‘å®šç­–ç•¥"></a>2. ç²˜æ€§ session &#x2F;IP ç»‘å®šç­–ç•¥</h4><ul>
<li><strong>é‡‡ç”¨ Ngnix ä¸­çš„ ip_hash æœºåˆ¶ï¼Œå°†æŸä¸ª ip çš„æ‰€æœ‰è¯·æ±‚éƒ½å®šå‘åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå³å°†ç”¨æˆ·ä¸æœåŠ¡å™¨ç»‘å®šã€‚</strong> ç”¨æˆ·ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œè´Ÿè½½å‡è¡¡å™¨å°†ç”¨æˆ·çš„è¯·æ±‚è½¬å‘åˆ°äº† A æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœè´Ÿè½½å‡è¡¡å™¨è®¾ç½®äº†ç²˜æ€§ session çš„è¯ï¼Œé‚£ä¹ˆç”¨æˆ·ä»¥åçš„æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ° A æœåŠ¡å™¨ä¸Šï¼Œç›¸å½“äºæŠŠç”¨æˆ·å’Œ A æœåŠ¡å™¨ç²˜åˆ°äº†ä¸€å—ï¼Œè¿™å°±æ˜¯ç²˜æ€§ session æœºåˆ¶ã€‚</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong> ç®€å•ï¼Œä¸éœ€è¦å¯¹ session åšä»»ä½•å¤„ç†ã€‚<br><strong>ç¼ºç‚¹ï¼š</strong> ç¼ºä¹å®¹é”™æ€§ï¼Œå¦‚æœå½“å‰è®¿é—®çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œç”¨æˆ·è¢«è½¬ç§»åˆ°ç¬¬äºŒä¸ªæœåŠ¡å™¨ä¸Šæ—¶ï¼Œä»–çš„ session ä¿¡æ¯éƒ½å°†å¤±æ•ˆã€‚<br><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> å‘ç”Ÿæ•…éšœå¯¹å®¢æˆ·äº§ç”Ÿçš„å½±å“è¾ƒå°ï¼›æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ˜¯ä½æ¦‚ç‡äº‹ä»¶ ã€‚<br><strong>å®ç°æ–¹å¼ï¼š</strong> ä»¥ Nginx ä¸ºä¾‹ï¼Œåœ¨ upstream æ¨¡å—é…ç½® ip_hash å±æ€§å³å¯å®ç°ç²˜æ€§ sessionã€‚</p>
<h4 id="3-session-å…±äº«ï¼ˆå¸¸ç”¨ï¼‰"><a href="#3-session-å…±äº«ï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="3. session å…±äº«ï¼ˆå¸¸ç”¨ï¼‰"></a>3. session å…±äº«ï¼ˆå¸¸ç”¨ï¼‰</h4><ul>
<li>ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜æ–¹æ¡ˆæ¯”å¦‚ Memcached ã€Redis æ¥ç¼“å­˜ sessionï¼Œä½†æ˜¯è¦æ±‚ Memcached æˆ– Redis å¿…é¡»æ˜¯é›†ç¾¤</li>
<li>æŠŠ session æ”¾åˆ° Redis ä¸­å­˜å‚¨ï¼Œè™½ç„¶æ¶æ„ä¸Šå˜å¾—å¤æ‚ï¼Œå¹¶ä¸”éœ€è¦å¤šè®¿é—®ä¸€æ¬¡ Redis ï¼Œä½†æ˜¯è¿™ç§æ–¹æ¡ˆå¸¦æ¥çš„å¥½å¤„ä¹Ÿæ˜¯å¾ˆå¤§çš„ï¼š<ul>
<li>å®ç°äº† session å…±äº«ï¼›</li>
<li>å¯ä»¥æ°´å¹³æ‰©å±•ï¼ˆå¢åŠ  Redis æœåŠ¡å™¨ï¼‰ï¼›</li>
<li>æœåŠ¡å™¨é‡å¯ session ä¸ä¸¢å¤±ï¼ˆä¸è¿‡ä¹Ÿè¦æ³¨æ„ session åœ¨ Redis ä¸­çš„åˆ·æ–°&#x2F;å¤±æ•ˆæœºåˆ¶ï¼‰ï¼›</li>
<li>ä¸ä»…å¯ä»¥è·¨æœåŠ¡å™¨ session å…±äº«ï¼Œç”šè‡³å¯ä»¥è·¨å¹³å°ï¼ˆä¾‹å¦‚ç½‘é¡µç«¯å’Œ APP ç«¯ï¼‰</li>
</ul>
</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/12/29/16f523a04fb8b4b8?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h4 id="4-session-æŒä¹…åŒ–"><a href="#4-session-æŒä¹…åŒ–" class="headerlink" title="4. session æŒä¹…åŒ–"></a>4. session æŒä¹…åŒ–</h4><ul>
<li>å°† session å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œä¿è¯ session çš„æŒä¹…åŒ–</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong> æœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼Œsession ä¸ä¼šä¸¢å¤±<br><strong>ç¼ºç‚¹ï¼š</strong> å¦‚æœç½‘ç«™çš„è®¿é—®é‡å¾ˆå¤§ï¼ŒæŠŠ session å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œä¼šå¯¹æ•°æ®åº“é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œè¿˜éœ€è¦å¢åŠ é¢å¤–çš„å¼€é”€ç»´æŠ¤æ•°æ®åº“ã€‚</p>
<h3 id="13-7-åªè¦å…³é—­æµè§ˆå™¨-ï¼Œsession-çœŸçš„å°±æ¶ˆå¤±äº†ï¼Ÿ"><a href="#13-7-åªè¦å…³é—­æµè§ˆå™¨-ï¼Œsession-çœŸçš„å°±æ¶ˆå¤±äº†ï¼Ÿ" class="headerlink" title="13.7 åªè¦å…³é—­æµè§ˆå™¨ ï¼Œsession çœŸçš„å°±æ¶ˆå¤±äº†ï¼Ÿ"></a>13.7 <strong>åªè¦å…³é—­æµè§ˆå™¨ ï¼Œsession çœŸçš„å°±æ¶ˆå¤±äº†ï¼Ÿ</strong></h3><p>ä¸å¯¹ã€‚å¯¹ session æ¥è¯´ï¼Œé™¤éç¨‹åºé€šçŸ¥æœåŠ¡å™¨åˆ é™¤ä¸€ä¸ª sessionï¼Œå¦åˆ™æœåŠ¡å™¨ä¼šä¸€ç›´ä¿ç•™ï¼Œç¨‹åºä¸€èˆ¬éƒ½æ˜¯åœ¨ç”¨æˆ·åš log off çš„æ—¶å€™å‘ä¸ªæŒ‡ä»¤å»åˆ é™¤ sessionã€‚<br>ç„¶è€Œæµè§ˆå™¨ä»æ¥ä¸ä¼šä¸»åŠ¨åœ¨å…³é—­ä¹‹å‰é€šçŸ¥æœåŠ¡å™¨å®ƒå°†è¦å…³é—­ï¼Œå› æ­¤æœåŠ¡å™¨æ ¹æœ¬ä¸ä¼šæœ‰æœºä¼šçŸ¥é“æµè§ˆå™¨å·²ç»å…³é—­ï¼Œä¹‹æ‰€ä»¥ä¼šæœ‰è¿™ç§é”™è§‰ï¼Œæ˜¯å¤§éƒ¨åˆ† session æœºåˆ¶éƒ½ä½¿ç”¨ä¼šè¯ cookie æ¥ä¿å­˜ session idï¼Œè€Œå…³é—­æµè§ˆå™¨åè¿™ä¸ª session id å°±æ¶ˆå¤±äº†ï¼Œå†æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶ä¹Ÿå°±æ— æ³•æ‰¾åˆ°åŸæ¥çš„ sessionã€‚å¦‚æœæœåŠ¡å™¨è®¾ç½®çš„ cookie è¢«ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œæˆ–è€…ä½¿ç”¨æŸç§æ‰‹æ®µæ”¹å†™æµè§ˆå™¨å‘å‡ºçš„ HTTP è¯·æ±‚å¤´ï¼ŒæŠŠåŸæ¥çš„ session id å‘é€ç»™æœåŠ¡å™¨ï¼Œåˆ™å†æ¬¡æ‰“å¼€æµè§ˆå™¨ä»ç„¶èƒ½å¤Ÿæ‰“å¼€åŸæ¥çš„ sessionã€‚<br>æ°æ°æ˜¯<strong>ç”±äºå…³é—­æµè§ˆå™¨ä¸ä¼šå¯¼è‡´ session è¢«åˆ é™¤ï¼Œè¿«ä½¿æœåŠ¡å™¨ä¸º session è®¾ç½®äº†ä¸€ä¸ªå¤±æ•ˆæ—¶é—´ï¼Œå½“è·ç¦»å®¢æˆ·ç«¯ä¸Šä¸€æ¬¡ä½¿ç”¨ session çš„æ—¶é—´è¶…è¿‡è¿™ä¸ªå¤±æ•ˆæ—¶é—´æ—¶ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å·²ç»åœæ­¢äº†æ´»åŠ¨ï¼Œæ‰ä¼šæŠŠ session åˆ é™¤ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</strong></p>
<h2 id="14-é¡¹ç›®åœ°å€"><a href="#14-é¡¹ç›®åœ°å€" class="headerlink" title="14. é¡¹ç›®åœ°å€"></a>14. é¡¹ç›®åœ°å€</h2><p><a target="_blank" rel="noopener" href="https://github.com/yjdjiayou/jwt-demo" title="**åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ JWT**"><strong>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ JWT</strong></a></p>
<h2 id="15-åè¯­"><a href="#15-åè¯­" class="headerlink" title="15. åè¯­"></a>15. åè¯­</h2><ul>
<li>æœ¬æ–‡åªæ˜¯åŸºäºè‡ªå·±çš„ç†è§£è®²äº†ç†è®ºçŸ¥è¯†ï¼Œå› ä¸ºå¯¹åç«¯&#x2F;ç®—æ³•çŸ¥è¯†ä¸æ˜¯å¾ˆç†Ÿï¼Œå¦‚æœ‰è°¬è¯¯ï¼Œè¿˜è¯·å‘ŠçŸ¥ï¼Œä¸‡åˆ†æ„Ÿè°¢</li>
<li>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜è¯·ç‚¹ä¸ªèµ~~</li>
</ul>
<h2 id="16-å‚è€ƒ"><a href="#16-å‚è€ƒ" class="headerlink" title="16. å‚è€ƒ"></a>16. å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/cookie/1119?fr=aladdin" title="**ç™¾åº¦ç™¾ç§‘-cookie**"><strong>ç™¾åº¦ç™¾ç§‘-cookie</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/session/479100?fr=aladdin#3" title="**ç™¾åº¦ç™¾ç§‘-session**"><strong>ç™¾åº¦ç™¾ç§‘-session</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5d01f82cf265da1b67210869" title="**è¯¦è§£ Cookieï¼ŒSessionï¼ŒToken**"><strong>è¯¦è§£ Cookieï¼ŒSessionï¼ŒToken</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5de4c3c76fb9a071b86cc482#heading-0" title="**ä¸€æ–‡å½»åº•ææ‡‚Cookieã€Sessionã€Tokenåˆ°åº•æ˜¯ä»€ä¹ˆ**"><strong>ä¸€æ–‡å½»åº•ææ‡‚ Cookieã€Sessionã€Token åˆ°åº•æ˜¯ä»€ä¹ˆ</strong></a></p>
<p><strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lyzg/p/6067766.html" title="3ç§webä¼šè¯ç®¡ç†çš„æ–¹å¼">3 ç§ web ä¼šè¯ç®¡ç†çš„æ–¹å¼</a>ï¼ï¼ï¼</strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/JamesWang1993/p/8593494.html" title="Token ï¼ŒCookieå’ŒSessionçš„åŒºåˆ«">Token ï¼ŒCookie å’Œ Session çš„åŒºåˆ«</a>ï¼ï¼ï¼</strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/moyand/p/9047978.html" title="å½»åº•ç†è§£ cookieã€sessionã€token">å½»åº•ç†è§£ cookieã€sessionã€token</a>ï¼ï¼ï¼</strong></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5c6e6063f265da2da53ec8f3" title="**å‰ç«¯é‰´æƒ**"><strong>å‰ç«¯é‰´æƒ</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-1" title="**SHA-1**"><strong>SHA-1</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-2" title="**SHA-2**"><strong>SHA-2</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SHA-3" title="**SHA-3**"><strong>SHA-3</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhezhebie/article/details/71631077" title="**ä¸è¦å†ä½¿ç”¨MD5å’ŒSHA1åŠ å¯†å¯†ç äº†ï¼**"><strong>ä¸è¦å†ä½¿ç”¨ MD5 å’Œ SHA1 åŠ å¯†å¯†ç äº†ï¼</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1022910821149312/1023025778520640" title="**å»–é›ªå³° Node æ•™ç¨‹ä¹‹ crypto**"><strong>å»–é›ªå³° Node æ•™ç¨‹ä¹‹ crypto</strong></a><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1022910821149312/1023025778520640" title=" "> </a></p>
<h2 id="17-æ¨èé˜…è¯»"><a href="#17-æ¨èé˜…è¯»" class="headerlink" title="17. æ¨èé˜…è¯»"></a>17. æ¨èé˜…è¯»</h2><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5df648836fb9a016526eba01" title="**ä½ çœŸçš„äº†è§£ React ç”Ÿå‘½å‘¨æœŸå—**"><strong>ä½ çœŸçš„äº†è§£ React ç”Ÿå‘½å‘¨æœŸå—</strong></a></p>
<p><strong><a target="_blank" rel="noopener" href="https://juejin.im/post/5dbbdbd5f265da4d4b5fe57d" title="React Hooks è¯¦è§£ ã€è¿‘ 1W å­—ã€‘+ é¡¹ç›®å®æˆ˜">React Hooks è¯¦è§£ ã€è¿‘ 1W å­—ã€‘+ é¡¹ç›®å®æˆ˜</a></strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://juejin.im/post/5def0816f265da33aa6aa7fe" title="React SSR è¯¦è§£ã€è¿‘ 1W å­—ã€‘+ 2ä¸ªé¡¹ç›®å®æˆ˜">React SSR è¯¦è§£ã€è¿‘ 1W å­—ã€‘+ 2 ä¸ªé¡¹ç›®å®æˆ˜</a></strong></p>
<p><strong><a target="_blank" rel="noopener" href="https://juejin.im/post/5da56e34f265da5b932e73fa" title="ä» 0 åˆ° 1 å®ç°ä¸€æ¬¾ç®€æ˜“ç‰ˆ Webpack">ä» 0 åˆ° 1 å®ç°ä¸€æ¬¾ç®€æ˜“ç‰ˆ Webpack</a></strong></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-åå°„çš„åŸºæœ¬åŸç†"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/30/%E5%8F%8D%E5%B0%84%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"
    >åå°„çš„åŸºæœ¬åŸç†</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/12/30/%E5%8F%8D%E5%B0%84%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/" class="article-date">
  <time datetime="2019-12-30T14:53:54.000Z" itemprop="datePublished">2019-12-30</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/5b2f8bd2f265da59b457cf47">https://juejin.im/post/5b2f8bd2f265da59b457cf47</a></p>
<p>ä½œè€…ï¼šYangAM</p>
<p>å°ç»“ï¼š</p>
<p>åå°„å°±æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½å¤ŸåŠ¨æ€çš„è·å–åˆ°ä¸€ä¸ªç±»çš„ç±»å‹ä¿¡æ¯çš„ä¸€ç§æ“ä½œã€‚</p>
<p>è·å–ä¸€ä¸ª Class å¯¹è±¡çš„æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚</p>
<p><strong>ç±»å.class</strong></p>
<p><strong>getClass æ–¹æ³•</strong></p>
<p><strong>forName æ–¹æ³•</strong></p>
</blockquote>
<p><img src="https://images2015.cnblogs.com/blog/1037972/201610/1037972-20161018144629217-1068318939.png" alt="img"></p>
<p>å›¾ç‰‡æ¥è‡ª <a target="_blank" rel="noopener" href="https://www.cnblogs.com/fengmingyue/p/5973260.html">https://www.cnblogs.com/fengmingyue/p/5973260.html</a></p>
<p>ã€åå°„ã€å°±æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½å¤ŸåŠ¨æ€çš„è·å–åˆ°ä¸€ä¸ªç±»çš„ç±»å‹ä¿¡æ¯çš„ä¸€ç§æ“ä½œã€‚å®ƒæ˜¯ç°ä»£æ¡†æ¶çš„çµé­‚ï¼Œå‡ å°½æ‰€æœ‰çš„æ¡†æ¶èƒ½å¤Ÿæä¾›çš„ä¸€äº›è‡ªåŠ¨åŒ–æœºåˆ¶éƒ½æ˜¯é åå°„å®ç°çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå„ç±»æ¡†æ¶éƒ½ä¸å…è®¸ä½ è¦†ç›–æ‰é»˜è®¤çš„æ— å‚æ„é€ å™¨çš„åŸå› ï¼Œå› ä¸ºæ¡†æ¶éœ€è¦ä»¥åå°„æœºåˆ¶åˆ©ç”¨æ— å‚æ„é€ å™¨åˆ›å»ºå®ä¾‹ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œã€åå°„ã€æ˜¯å¾ˆå€¼å¾—å¤§å®¶èŠ±æ—¶é—´å­¦ä¹ çš„ï¼Œå°½ç®¡å¤§éƒ¨åˆ†äººéƒ½å¾ˆå°‘æœ‰æœºä¼šå»æ‰‹å†™æ¡†æ¶ï¼Œä½†æ˜¯è¿™å°†æœ‰åŠ©äºä½ å¯¹äºå„ç±»æ¡†æ¶çš„ç†è§£ã€‚ä¸å¥¢æ±‚ä½ é€šè¿‡æœ¬ç¯‡æ–‡ç« çš„å­¦ä¹ å¯¹äºã€åå°„ã€èƒ½å¤Ÿæœ‰å¤šä¹ˆæ·±å±‚æ¬¡çš„ç†è§£ï¼Œä½†è‡³å°‘ä¿è¯ä½ äº†è§£ã€åå°„ã€çš„åŸºæœ¬åŸç†åŠä½¿ç”¨ã€‚</p>
<h3 id="1-Class-ç±»å‹ä¿¡æ¯"><a href="#1-Class-ç±»å‹ä¿¡æ¯" class="headerlink" title="1. Class ç±»å‹ä¿¡æ¯"></a>1. Class ç±»å‹ä¿¡æ¯</h3><p>ä¹‹é—´ä»‹ç»è¿‡è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ï¼Œå…¶ä¸­æˆ‘ä»¬æåˆ°è¿‡ï¼Œæ¯ä¸€ç§ç±»å‹éƒ½ä¼šåœ¨åˆæ¬¡ä½¿ç”¨æ—¶è¢«åŠ è½½è¿›è™šæ‹Ÿæœºå†…å­˜çš„ã€æ–¹æ³•åŒºã€ä¸­ï¼ŒåŒ…å«ç±»ä¸­å®šä¹‰çš„å±æ€§å­—æ®µï¼Œæ–¹æ³•å­—èŠ‚ç ç­‰ä¿¡æ¯ã€‚</p>
<p>Java ä¸­ä½¿ç”¨ç±» java.lang.Class æ¥æŒ‡å‘ä¸€ä¸ªç±»å‹ä¿¡æ¯ï¼Œé€šè¿‡è¿™ä¸ª Class å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è¯¥ç±»çš„æ‰€æœ‰å†…éƒ¨ä¿¡æ¯ã€‚è€Œè·å–ä¸€ä¸ª Class å¯¹è±¡çš„æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚</p>
<p><strong>ç±»å.class</strong></p>
<p>è¿™ç§æ–¹å¼å°±æ¯”è¾ƒç®€å•ï¼Œåªè¦ä½¿ç”¨ç±»åç‚¹ class å³å¯å¾—åˆ°æ–¹æ³•åŒºè¯¥ç±»å‹çš„ç±»å‹ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Object.class;</span><br><span class="line">Integer.class;</span><br><span class="line"><span class="type">int</span>.class;</span><br><span class="line">String.class;</span><br><span class="line"><span class="comment">//ç­‰ç­‰</span></span><br></pre></td></tr></table></figure>

<p><strong>getClass æ–¹æ³•</strong></p>
<p>Object ç±»æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass();</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå¹¶ä¸”ä¸å…è®¸å­ç±»é‡å†™ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ‰€æœ‰ç±»å‹çš„å®ä¾‹éƒ½å…·æœ‰åŒä¸€ä¸ª getClass æ–¹æ³•ã€‚å…·ä½“ä½¿ç”¨ä¸Šä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer integer = new Integer(12);</span><br><span class="line">integer.getClass();</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p><strong>forName æ–¹æ³•</strong></p>
<p>forName ç®—æ˜¯è·å– Class ç±»å‹çš„ä¸€ä¸ªæœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå®ƒå…è®¸ä½ ä¼ å…¥ä¸€ä¸ªå…¨ç±»åï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›æ–¹æ³•åŒºä»£è¡¨è¿™ä¸ªç±»å‹çš„ Class å¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½è¿›æ–¹æ³•åŒºï¼ŒforName ä¼šå…ˆè¿›è¡Œç±»åŠ è½½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static Class&lt;?&gt; forName(String className) &#123;</span><br><span class="line">    Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">    return forName0(className, true, ClassLoader.getClassLoader(caller), caller);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ–¹æ³•åŒº Class ç±»å‹ä¿¡æ¯ç”±ç±»åŠ è½½å™¨å’Œç±»å…¨é™å®šåå”¯ä¸€ç¡®å®šï¼Œæ‰€ä»¥æƒ³è¦å»æ‰¾è¿™ä¹ˆä¸€ä¸ª Class å°±å¿…é¡»æä¾›ç±»åŠ è½½å™¨å’Œç±»å…¨é™å®šåï¼Œè¿™ä¸ª forName æ–¹æ³•é»˜è®¤ä½¿ç”¨è°ƒç”¨è€…çš„ç±»åŠ è½½å™¨ã€‚</p>
<p>å½“ç„¶ï¼ŒClass ç±»ä¸­ä¹Ÿæœ‰ä¸€ä¸ª forName é‡è½½ï¼Œå…è®¸ä½ ä¼ å…¥ç±»åŠ è½½å™¨å’Œç±»å…¨é™å®šåæ¥åŒ¹é…æ–¹æ³•åŒºç±»å‹ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static Class&lt;?&gt; forName(String name, boolean initialize,</span><br><span class="line">ClassLoader loader)&#123;</span><br><span class="line">    //.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œé€šè¿‡è¿™äº›æ–¹æ³•ä½ å¯ä»¥å¾—åˆ°ä»»æ„ç±»çš„ç±»å‹ä¿¡æ¯ï¼Œè¯¥ç±»çš„æ‰€æœ‰å­—æ®µå±æ€§ï¼Œæ–¹æ³•è¡¨ç­‰ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ª Class å¯¹è±¡è¿›è¡Œè·å–ã€‚</p>
<h3 id="2-åå°„å­—æ®µå±æ€§"><a href="#2-åå°„å­—æ®µå±æ€§" class="headerlink" title="2. åå°„å­—æ®µå±æ€§"></a>2. åå°„å­—æ®µå±æ€§</h3><p>Class ä¸­æœ‰å…³è·å–å­—æ®µå±æ€§çš„æ–¹æ³•ä¸»è¦ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li>public Field[] getFields()ï¼šè¿”å›è¯¥ç±»å‹çš„æ‰€æœ‰ public ä¿®é¥°çš„å±æ€§ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„</li>
<li>public Field getField(String name)ï¼šæ ¹æ®å­—æ®µåç§°è¿”å›ç›¸åº”çš„å­—æ®µ</li>
<li>public Field[] getDeclaredFields()ï¼šè¿”å›æœ¬ç±»å‹ä¸­ç”³æ˜çš„æ‰€æœ‰å­—æ®µï¼ŒåŒ…å«é public ä¿®é¥°çš„ä½†ä¸åŒ…å«çˆ¶ç±»ä¸­çš„</li>
<li>public Field getDeclaredField(String name)ï¼šåŒç†</li>
</ul>
<p>å½“ç„¶ï¼Œä¸€ä¸ª Field å®ä¾‹åŒ…å«æŸä¸ªç±»çš„ä¸€ä¸ªå±æ€§çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­—æ®µåç§°ï¼Œè®¿é—®ä¿®é¥°ç¬¦ï¼Œå­—æ®µç±»å‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒField è¿˜æä¾›äº†å¤§é‡çš„æ“ä½œè¯¥å±æ€§å€¼çš„æ–¹æ³•ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ªç±»å®ä¾‹ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ Field å®ä¾‹æ“ä½œè¯¥å®ä¾‹çš„å½“å‰å­—æ®µå±æ€§çš„å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå¾…åå°„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;People&gt; cls = People.class;</span><br><span class="line"><span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> cls.getField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">People</span>();</span><br><span class="line">name.set(people,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">System.out.println(people.name);</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºä¼šè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œset æ–¹æ³•ä¼šæ£€ç´¢ People å¯¹è±¡æ˜¯å¦å…·æœ‰ä¸€ä¸ª name ä»£è¡¨çš„å­—æ®µï¼Œå¦‚æœæœ‰å°†å­—ç¬¦ä¸² hello èµ‹å€¼ç»™è¯¥å­—æ®µå³å¯ã€‚</p>
<p>æ•´ä¸ª Field ç±»ä¸»è¦ç”±ä¸¤å¤§éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†å°±æ˜¯æœ‰å…³è¯¥å­—æ®µå±æ€§çš„æè¿°ä¿¡æ¯ï¼Œä¾‹å¦‚åç§°ï¼Œç±»å‹ï¼Œå¤–å›´ç±» Class å¯¹è±¡ç­‰ï¼Œç¬¬äºŒéƒ¨åˆ†å°±æ˜¯å¤§é‡çš„ get å’Œ set æ–¹æ³•ç”¨äºé—´æ¥æ“ä½œä»»æ„çš„å¤–å›´ç±»å®ä¾‹çš„å½“å‰å±æ€§å€¼ã€‚</p>
<h3 id="3-åå°„æ–¹æ³•"><a href="#3-åå°„æ–¹æ³•" class="headerlink" title="3. åå°„æ–¹æ³•"></a>3. åå°„æ–¹æ³•</h3><p>åŒæ ·çš„ï¼ŒClass ç±»ä¹Ÿæä¾›äº†å››ç§æ–¹æ³•æ¥è·å–å…¶ä¸­çš„æ–¹æ³•å±æ€§ï¼š</p>
<ul>
<li>public Method[] getMethods()ï¼šè¿”å›æ‰€æœ‰çš„ public æ–¹æ³•ï¼ŒåŒ…æ‹¬çˆ¶ç±»ä¸­çš„</li>
<li>public Method getMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)ï¼šè¿”å›æŒ‡å®šçš„æ–¹æ³•</li>
<li>public Method[] getDeclaredMethods()ï¼šè¿”å›æœ¬ç±»ç”³æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬é public ä¿®é¥°çš„ï¼Œä½†ä¸åŒ…æ‹¬çˆ¶ç±»ä¸­çš„</li>
<li>public Method getDeclaredMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)ï¼šåŒç†</li>
</ul>
<p>Method æŠ½è±¡åœ°ä»£è¡¨äº†ä¸€ä¸ªæ–¹æ³•ï¼ŒåŒæ ·æœ‰æè¿°è¿™ä¸ªæ–¹æ³•åŸºæœ¬ä¿¡æ¯çš„å­—æ®µå’Œæ–¹æ³•ï¼Œä¾‹å¦‚æ–¹æ³•åï¼Œæ–¹æ³•çš„å‚æ•°é›†åˆï¼Œæ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œå¼‚å¸¸ç±»å‹é›†åˆï¼Œæ–¹æ³•çš„æ³¨è§£ç­‰ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–çš„è¿˜æœ‰ä¸€ä¸ª invoke æ–¹æ³•ç”¨äºé—´æ¥è°ƒç”¨å…¶ä»–å®ä¾‹çš„è¯¥æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello wrold &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;People&gt; cls = People.class;</span><br><span class="line"><span class="type">Method</span> <span class="variable">sayHello</span> <span class="operator">=</span> cls.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line"><span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">People</span>();</span><br><span class="line">sayHello.invoke(people);</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello wrold</span><br></pre></td></tr></table></figure>

<h3 id="4-åå°„æ„é€ å™¨"><a href="#4-åå°„æ„é€ å™¨" class="headerlink" title="4. åå°„æ„é€ å™¨"></a>4. åå°„æ„é€ å™¨</h3><p>å¯¹äº Constructor æ¥è¯´ï¼ŒClass ç±»ä¾ç„¶ä¸ºå®ƒæä¾›äº†å››ç§è·å–å®ä¾‹çš„æ–¹æ³•ï¼š</p>
<ul>
<li>public Constructor&lt;?&gt;[] getConstructors()ï¼šè¿”å›æ‰€æœ‰ public ä¿®é¥°çš„æ„é€ å™¨</li>
<li>public Constructor&lt;?&gt;[] getDeclaredConstructors()ï¼šè¿”å›æ‰€æœ‰çš„æ„é€ å™¨ï¼Œæ— è§†è®¿é—®ä¿®é¥°ç¬¦</li>
<li>public Constructor getConstructor(Class&lt;?&gt;â€¦ parameterTypes)ï¼šå¸¦æŒ‡å®šå‚æ•°çš„</li>
<li>public Constructor getDeclaredConstructor(Class&lt;?&gt;â€¦ parameterTypes) ï¼šåŒç†</li>
</ul>
<p>Constructor æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œåªæ˜¯æ²¡æœ‰è¿”å›å€¼è€Œå·²ï¼Œæ‰€ä»¥å†…éƒ¨çš„åŸºæœ¬å†…å®¹å’Œ Method æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ Constructor ç±»ä¸­æœ‰ä¸€ä¸ª newInstance æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªè¯¥ Class ç±»å‹çš„å®ä¾‹å¯¹è±¡å‡ºæ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ€ç®€å•çš„ä¸€ä¸ªåå°„åˆ›å»ºå®ä¾‹çš„è¿‡ç¨‹</span></span><br><span class="line">Class&lt;People&gt; cls = People.class;</span><br><span class="line"><span class="type">Constructor</span> <span class="variable">c</span> <span class="operator">=</span> cls.getConstructor();</span><br><span class="line"><span class="type">People</span> <span class="variable">p</span> <span class="operator">=</span> (People) c.newInstance();</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šï¼Œæˆ‘ä»¬ç®€å•çš„ä»‹ç»äº†åå°„çš„åŸºæœ¬ä½¿ç”¨æƒ…å†µï¼Œä½†éƒ½å¾ˆåŸºç¡€ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹åå°„å’Œä¸€äº›ç¨å¾®å¤æ‚çš„ç±»å‹ç»“åˆä½¿ç”¨çš„æƒ…å†µï¼Œä¾‹å¦‚ï¼šæ•°ç»„ï¼Œæ³›å‹ï¼Œæ³¨è§£ç­‰ã€‚</p>
<h3 id="5-åå°„çš„å…¶ä»–ç»†èŠ‚"><a href="#5-åå°„çš„å…¶ä»–ç»†èŠ‚" class="headerlink" title="5. åå°„çš„å…¶ä»–ç»†èŠ‚"></a>5. åå°„çš„å…¶ä»–ç»†èŠ‚</h3><h4 id="5-1-åå°„ä¸æ•°ç»„"><a href="#5-1-åå°„ä¸æ•°ç»„" class="headerlink" title="5.1 åå°„ä¸æ•°ç»„"></a>5.1 <strong>åå°„ä¸æ•°ç»„</strong></h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ•°ç»„æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒæœ¬è´¨ä¸Šç”±è™šæ‹Ÿæœºåœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆï¼Œæ‰€ä»¥åœ¨åå°„è¿™ç§ç±»å‹çš„æ—¶å€™ä¼šç¨æœ‰ä¸åŒã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> Class&lt;?&gt; getComponentType();</span><br></pre></td></tr></table></figure>

<p>Class ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†è¿”å›æ•°ç»„ Class å®ä¾‹å…ƒç´ çš„åŸºæœ¬ç±»å‹ã€‚åªæœ‰å½“å‰çš„ Class å¯¹è±¡ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•æ‰ä¼šè¿”å›æ•°ç»„çš„å…ƒç´ å®é™…ç±»å‹ï¼Œå…¶ä»–çš„ä»»ä½•æ—¶å€™éƒ½ä¼šè¿”å› nullã€‚</p>
<p>å½“ç„¶ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼Œä»£è¡¨æ•°ç»„çš„è¿™ä¸ªç”±è™šæ‹ŸæœºåŠ¨æ€åˆ›å»ºçš„ç±»å‹ï¼Œå®ƒç›´æ¥ç»§æ‰¿çš„ Object ç±»ï¼Œå¹¶ä¸”æ‰€æœ‰æœ‰å…³æ•°ç»„ç±»çš„æ“ä½œï¼Œæ¯”å¦‚ä¸ºæŸä¸ªå…ƒç´ èµ‹å€¼æˆ–æ˜¯è·å–æ•°ç»„é•¿åº¦çš„æ“ä½œéƒ½ç›´æ¥å¯¹åº”ä¸€ä¸ªå•ç‹¬çš„è™šæ‹Ÿæœºæ•°ç»„æ“ä½œæŒ‡ä»¤ã€‚</p>
<p>åŒæ ·ä¹Ÿå› ä¸ºæ•°ç»„ç±»ç›´æ¥ç”±è™šæ‹Ÿæœºè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºï¼Œæ‰€ä»¥ä½ ä¸å¯èƒ½ä»ä¸€ä¸ªæ•°ç»„ç±»å‹çš„ Class å®ä¾‹ä¸­å¾—åˆ°æ„é€ æ–¹æ³•ï¼Œç¼–è¯‘å™¨æ ¹æœ¬æ²¡æœºä¼šä¸ºç±»ç”Ÿæˆé»˜è®¤çš„æ„é€ å™¨ã€‚äºæ˜¯ä½ ä¹Ÿä¸èƒ½ä»¥å¸¸è§„çš„æ–¹æ³•é€šè¿‡ Constructor æ¥åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p>
<p>å¦‚æœä½ éè¦å°è¯•ä½¿ç”¨ Constructor æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹çš„è¯ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ç¨‹åºå°†å‘Šè¯‰ä½ æ— æ³•åŒ¹é…ä¸€ä¸ªæ„é€ å™¨ã€‚åƒè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;String[]&gt; cls = String[].class;</span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> cls.getConstructor();</span><br><span class="line">String[] strs = (String[]) constructor.newInstance();</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å°è¾“å‡ºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gaf6k587kej30kq04oaaz.jpg"></p>
<p>å‘Šè¯‰ä½ ï¼ŒClass å®ä¾‹ä¸­æ ¹æœ¬æ‰¾ä¸åˆ°ä¸€ä¸ªæ— å‚çš„æ„é€ å™¨ã€‚é‚£ä¹ˆéš¾é“æˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ•°ç»„äº†å—ï¼Ÿ</p>
<p>å½“ç„¶ä¸æ˜¯ï¼ŒJava ä¸­æœ‰ä¸€ä¸ªç±» java.lang.reflect.Array æä¾›äº†ä¸€äº›é™æ€çš„æ–¹æ³•ç”¨äºåŠ¨æ€çš„åˆ›å»ºå’Œè·å–ä¸€ä¸ªæ•°ç»„ç±»å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼ŒcomponentType ä¸ºæ•°ç»„å…ƒç´ ç±»å‹ï¼Œlength æ•°ç»„é•¿åº¦</span><br><span class="line">public static Object newInstance(Class&lt;?&gt; componentType, int length)</span><br><span class="line"></span><br><span class="line">//å¯å˜å‚æ•° dimensionsï¼ŒæŒ‡å®šå¤šä¸ªç»´åº¦çš„å•ç»´åº¦é•¿åº¦</span><br><span class="line">public static Object newInstance(Class&lt;?&gt; componentType, int... dimensions)</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æˆ‘è®¤ä¸º Array ç±»ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“ç„¶äº† Array ç±»ä¸­è¿˜æœ‰ä¸€äº›å…¶å®ƒæ–¹æ³•ç”¨äºè·å–æŒ‡å®šæ•°ç»„çš„æŒ‡å®šä½ç½®å…ƒç´ ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ã€‚</p>
<p>å®Œå…¨æ˜¯å› ä¸ºæ•°ç»„è¿™ç§ç±»å‹å¹¶ä¸æ˜¯ç”±å¸¸è§„çš„ç¼–è¯‘å™¨ç¼–è¯‘ç”Ÿæˆï¼Œè€Œæ˜¯ç”±è™šæ‹ŸæœºåŠ¨æ€åˆ›å»ºçš„ï¼Œæ‰€ä»¥æƒ³è¦é€šè¿‡åå°„çš„æ–¹å¼å®ä¾‹åŒ–ä¸€ä¸ªæ•°ç»„ç±»å‹æ˜¯å¾—ä¾èµ– Array è¿™ä¸ªç±»å‹çš„ç›¸å…³ newInstance æ–¹æ³•çš„ã€‚</p>
<h4 id="5-2-åå°„ä¸æ³›å‹"><a href="#5-2-åå°„ä¸æ³›å‹" class="headerlink" title="5.2 åå°„ä¸æ³›å‹"></a>5.2 <strong>åå°„ä¸æ³›å‹</strong></h4><p>æ³›å‹æ˜¯ Java ç¼–è¯‘å™¨èŒƒå›´å†…çš„æ¦‚å¿µï¼Œå®ƒèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œä¹‹å‰æä¾›ä¸€å®šçš„å®‰å…¨æ£€æŸ¥ï¼Œè€Œåå°„æ˜¯è¿è¡Œæ—¶å‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ åå°„è°ƒç”¨ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œå®é™…ä¸Šå°±ç»•è¿‡äº†ç¼–è¯‘å™¨çš„æ³›å‹æ£€æŸ¥äº†ã€‚æˆ‘ä»¬çœ‹ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">23</span>);</span><br><span class="line"><span class="comment">//list.add(&quot;fads&quot;);ç¼–è¯‘ä¸é€šè¿‡</span></span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; cls = list.getClass();</span><br><span class="line"><span class="type">Method</span> <span class="variable">add</span> <span class="operator">=</span> cls.getMethod(<span class="string">&quot;add&quot;</span>,Object.class);</span><br><span class="line">add.invoke(list,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">System.out.println(list.get(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆä½ ä¼šå‘ç°æˆ‘ä»¬ä»æ•´å‹å®¹å™¨ä¸­å–å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› ä¸ºè™šæ‹Ÿæœºåªç®¡åœ¨è¿è¡Œæ—¶ä»æ–¹æ³•åŒºæ‰¾åˆ° ArrayList è¿™ä¸ªç±»çš„ç±»å‹ä¿¡æ¯å¹¶è§£æå‡ºå®ƒçš„ add æ–¹æ³•ï¼Œæ¥ç€æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>å®ƒä¸åƒä¸€èˆ¬çš„æ–¹æ³•è°ƒç”¨ï¼Œè°ƒç”¨ä¹‹å‰ç¼–è¯‘å™¨ä¼šæ£€æµ‹è¿™ä¸ªæ–¹æ³•å­˜åœ¨ä¸å­˜åœ¨ï¼Œå‚æ•°ç±»å‹æ˜¯å¦åŒ¹é…ç­‰ï¼Œæ‰€ä»¥æ²¡äº†ç¼–è¯‘å™¨çš„è¿™å±‚å®‰å…¨æ£€æŸ¥ï¼Œåå°„åœ°è°ƒç”¨æ–¹æ³•æ›´å®¹æ˜“é‡åˆ°é—®é¢˜ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹‹å‰æˆ‘ä»¬è¯´è¿‡çš„æ³›å‹åœ¨ç»è¿‡ç¼–è¯‘æœŸä¹‹åä¼šè¢«ç±»å‹æ“¦é™¤ï¼Œä½†å®é™…ä¸Šä»£è¡¨è¯¥ç±»å‹çš„ Class ç±»å‹ä¿¡æ¯ä¸­æ˜¯ä¿å­˜æœ‰ä¸€äº›åŸºæœ¬çš„æ³›å‹ä¿¡æ¯çš„ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„å¾—åˆ°ã€‚</p>
<p>è¿™é‡Œä¸å†å¸¦å¤§å®¶ä¸€èµ·å»çœ‹äº†ï¼ŒClass ï¼ŒField å’Œ Method ä¸­éƒ½æ˜¯æœ‰ç›¸å…³æ–¹æ³•å¯ä»¥è·å–ç±»æˆ–è€…æ–¹æ³•åœ¨å®šä¹‰çš„æ—¶å€™æ‰€ä½¿ç”¨åˆ°çš„æ³›å‹ç±»ååç§°ã€‚æ³¨æ„è¿™é‡Œè¯´çš„ï¼Œåªæ˜¯åç§°ï¼Œç±»ä¼¼ Eã€V è¿™æ ·çš„ä¸œè¥¿ã€‚</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Spring-IOCè¿‡ç¨‹æºç åˆ†æ"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/30/Spring-IOC%E8%BF%87%E7%A8%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"
    >Spring IOCè¿‡ç¨‹æºç åˆ†æ</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2019/12/30/Spring-IOC%E8%BF%87%E7%A8%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2019-12-29T16:04:10.000Z" itemprop="datePublished">2019-12-30</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>ä½œè€…ï¼š<a target="_blank" rel="noopener" href="http://vc2x.com/" title="valarchie">valarchie</a><br>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://vc2x.com/articles/2019/09/10/1568056055049.html">http://vc2x.com/articles/2019/09/10/1568056055049.html</a></p>
<p>å°ç»“ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šè¯»å– xml æ–‡ä»¶å½¢æˆ DOM å¯¹è±¡</li>
<li>ç¬¬äºŒæ­¥ï¼šè¯»å– DOM æ–‡æ¡£å¯¹è±¡é‡Œçš„ Bean å®šä¹‰å¹¶è£…è½½è¿› BeanFactory ä¸­</li>
<li>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨åˆ›å»ºå¥½çš„ Bean å®šä¹‰ï¼Œå¼€å§‹å®ä¾‹åŒ– Beanã€‚</li>
</ul>
</blockquote>
<h3 id="åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªå‚»ç“œç‰ˆçš„-IOC-demo-ä½œä¸ºä¾‹å­"><a href="#åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªå‚»ç“œç‰ˆçš„-IOC-demo-ä½œä¸ºä¾‹å­" class="headerlink" title="åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªå‚»ç“œç‰ˆçš„ IOC demo ä½œä¸ºä¾‹å­"></a>åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªå‚»ç“œç‰ˆçš„ IOC demo ä½œä¸ºä¾‹å­</h3><p>è‡ªå®šä¹‰çš„ Bean å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyBeanDefinition</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="keyword">public</span> String className;</span><br><span class="line">    <span class="keyword">public</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBeanDefinition</span><span class="params">(String id, String className, String value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.className = className;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰çš„ Bean å·¥å‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyBeanFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; beanMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBeanFactory</span><span class="params">(MyBeanDefinition beanDefinition)</span> <span class="keyword">throws</span> ClassNotFoundException,</span><br><span class="line">            IllegalAccessException, InstantiationException &#123;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; beanClass = Class.forName(beanDefinition.className);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> beanClass.newInstance();</span><br><span class="line">        ((UserService) bean).setName(beanDefinition.value);</span><br><span class="line">        beanMap.put(beanDefinition.id, bean);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beanMap.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•å‚»ç“œç‰ˆ IOC å®¹å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyIOC</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException, ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">MyBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBeanDefinition</span>(<span class="string">&quot;userService&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.valarchie.UserService&quot;</span>, <span class="string">&quot;archie&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">MyBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBeanFactory</span>(beanDefinition);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(userService.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="çœ‹å®Œä»¥ä¸Šè¿™ä¸ªå‚»ç“œç‰ˆçš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Ÿè®©æˆ‘ä»¬è‡ªå·±å®ç°-IOC-çš„å®¹å™¨çš„å…³é”®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"><a href="#çœ‹å®Œä»¥ä¸Šè¿™ä¸ªå‚»ç“œç‰ˆçš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Ÿè®©æˆ‘ä»¬è‡ªå·±å®ç°-IOC-çš„å®¹å™¨çš„å…³é”®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" class="headerlink" title="çœ‹å®Œä»¥ä¸Šè¿™ä¸ªå‚»ç“œç‰ˆçš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Ÿè®©æˆ‘ä»¬è‡ªå·±å®ç° IOC çš„å®¹å™¨çš„å…³é”®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"></a>çœ‹å®Œä»¥ä¸Šè¿™ä¸ªå‚»ç“œç‰ˆçš„ä¾‹å­æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Ÿè®©æˆ‘ä»¬è‡ªå·±å®ç° IOC çš„å®¹å™¨çš„å…³é”®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</h3><p>æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œæˆ‘æ€»ç»“ä¸ºä»¥ä¸‹ä¸‰æ­¥</p>
<ul>
<li>è¯»å– xml æ–‡ä»¶å½¢æˆ DOM å¯¹è±¡</li>
<li>è¯»å– DOM æ–‡æ¡£å¯¹è±¡é‡Œçš„ Bean å®šä¹‰å¹¶è£…è½½è¿› BeanFactory ä¸­</li>
<li>æ ¹æ® bean å®šä¹‰ç”Ÿæˆå®ä¾‹æ”¾è¿›å®¹å™¨ï¼Œä»¥ä¾›ä½¿ç”¨</li>
</ul>
<p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸ä¼šé€šç›˜åˆ†ææ•´ä¸ª IOC çš„æµç¨‹ï¼Œå› ä¸ºæ—æç»†èŠ‚å¤ªå¤šè¯»è€…çœ‹å®Œä¹Ÿäº‘é‡Œé›¾é‡ŒæŠ“ä¸åˆ°é‡ç‚¹ã€‚<br>æˆ‘ä»¬é€šè¿‡åˆ†ææœ€é‡è¦çš„è¿™æ¡ä»£ç ä¸»å¹²çº¿æ¥ç†è§£ IOC çš„è¿‡ç¨‹ã€‚</p>
<h2 id="å¼€å§‹åˆ†æï¼š"><a href="#å¼€å§‹åˆ†æï¼š" class="headerlink" title="å¼€å§‹åˆ†æï¼š"></a>å¼€å§‹åˆ†æï¼š</h2><p>é¦–å…ˆæˆ‘ä»¬ä» xml çš„é…ç½®æ–¹å¼å¼€å§‹åˆ†æï¼Œå› ä¸º Spring æœ€åˆçš„é…ç½®æ–¹å¼å°±æ˜¯åˆ©ç”¨ xml æ¥è¿›è¡Œé…ç½®ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†äººå¯¹ xml çš„é…ç½®å½¢å¼è¾ƒä¸ºç†Ÿæ‚‰ï¼Œä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ç†è§£ã€‚</p>
<p>ä» ClassPathXmlApplicationContext çš„æ„é€ å™¨å¼€å§‹è®²èµ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSpring</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// IOCå®¹å™¨çš„å¯åŠ¨å°±ä»ClassPathXmlApplicationContextçš„æ„é€ æ–¹æ³•å¼€å§‹</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;classpath:application.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(userService.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥åˆ°æ„é€ æ–¹æ³•ä¸­ï¼Œè°ƒç”¨é‡è½½çš„å¦ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºClassPathXmlApplicationContextï¼ŒåŠ è½½ç»™å®šçš„ä½ç½®çš„xmlæ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨åˆ·æ–°context</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ClassPathXmlApplicationContext</span><span class="params">(String configLocation)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="built_in">this</span>(<span class="keyword">new</span> <span class="title class_">String</span>[] &#123;configLocation&#125;, <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡è½½çš„æ„é€ æ–¹æ³•ä¸­ï¼Œç”±äºåˆšæ‰ parrent å‚æ•°ä¼ ä¸º nullï¼Œæ‰€ä»¥ä¸è®¾ç½®çˆ¶å®¹å™¨ã€‚refresh åˆšæ‰è®¾ç½®ä¸º trueï¼Œæµç¨‹å°±ä¼šè¿›å…¥ refresh()æ–¹æ³•ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ClassPathXmlApplicationContext</span><span class="params">(String[] configLocations, <span class="type">boolean</span> refresh, ApplicationContext parent)</span></span><br><span class="line">			<span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// ç”±äºä¹‹å‰çš„æ–¹æ³•è°ƒç”¨å°†parentè®¾ç½®ä¸ºnullï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸åˆ†æäº†</span></span><br><span class="line">		<span class="built_in">super</span>(parent);</span><br><span class="line">		<span class="comment">// è®¾ç½®è·¯å¾„æ•°ç»„ï¼Œå¹¶ä¾æ¬¡å¯¹é…ç½®è·¯å¾„è¿›è¡Œç®€å•å ä½ç¬¦æ›¿æ¢å¤„ç†ï¼Œæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¹Ÿä¸è¿›å…¥åˆ†æäº†</span></span><br><span class="line">		setConfigLocations(configLocations);</span><br><span class="line">		<span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">			refresh();</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•´ä¸ª refresh()æ–¹æ³•ä¸­å°±æ˜¯ IOC å®¹å™¨å¯åŠ¨çš„ä¸»å¹²è„‰ç»œäº†ï¼ŒSpring é‡‡ç”¨äº†æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼è¿›è¡Œ refresh()æ–¹æ³•çš„è®¾è®¡ï¼Œå…ˆè§„å®šå¥½æ•´ä¸ª IOC å®¹å™¨çš„å…·ä½“æ­¥éª¤ï¼Œç„¶åå°†æ¯ä¸€ä¸ªå°æ­¥éª¤ç”±å„ç§ä¸åŒçš„å­ç±»è‡ªå·±å®ç°ã€‚</p>
<p>æ‰€æœ‰é‡è¦çš„æ“ä½œéƒ½æ˜¯å›´ç»•ç€ BeanFactory åœ¨è¿›è¡Œã€‚<br>åœ¨æ³¨é‡Šå½“ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†çš„åˆ—å‡ºäº†æ¯ä¸€æ­¥æ–¹æ³•æ‰€å®Œæˆçš„äº‹æƒ…ã€‚ApplicationContext å†…éƒ¨æŒæœ‰äº† FactoryBean çš„å®ä¾‹ã€‚å…¶å® ApplicationContext æœ¬èº«æœ€ä¸Šå±‚çš„çˆ¶æ¥å£ä¹Ÿæ˜¯ BeanFactoryï¼Œä»–æ‹“å±•äº† BeanFactory ä¹‹å¤–çš„åŠŸèƒ½ï¼ˆæä¾›å›½é™…åŒ–çš„æ¶ˆæ¯è®¿é—®ã€èµ„æºè®¿é—®ï¼Œå¦‚ URL å’Œæ–‡ä»¶ã€äº‹ä»¶ä¼ æ’­ã€è½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ï¼‰</p>
<p>æˆ‘ä»¬å…ˆé€šè¿‡é˜…è¯»ä»£ç ä¸­çš„æ³¨é‡Šæ¥äº†è§£å¤§æ¦‚çš„è„‰ç»œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">        <span class="comment">// å…ˆåŠ é”é˜²æ­¢å¯åŠ¨ã€ç»“æŸå†²çª</span></span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">			<span class="comment">// åœ¨åˆ·æ–°ä¹‹å‰åšä¸€äº›å‡†å¤‡å·¥ä½œ</span></span><br><span class="line">			<span class="comment">// è®¾ç½®å¯åŠ¨çš„æ—¶é—´ã€ç›¸å…³çŠ¶æ€çš„æ ‡å¿—ä½ï¼ˆæ´»åŠ¨ã€å…³é—­ï¼‰ã€åˆå§‹åŒ–å ä½ç¬¦å±æ€§æºï¼Œå¹¶ç¡®è®¤</span></span><br><span class="line">			<span class="comment">// æ¯ä¸ªæ ‡è®°ä¸ºå¿…é¡»çš„å±æ€§éƒ½æ˜¯å¯è§£æçš„ã€‚</span></span><br><span class="line">			prepareRefresh();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// è·å–ä¸€ä¸ªå·²åˆ·æ–°çš„BeanFactoryå®ä¾‹ã€‚</span></span><br><span class="line">			<span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// å®šä¹‰å¥½Beanå·¥å‚çš„ç¯å¢ƒç‰¹æ€§ï¼Œä¾‹å¦‚ç±»åŠ è½½å™¨ï¼Œæˆ–è€…åç½®å¤„ç†å™¨</span></span><br><span class="line">			prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// è®¾ç½®åœ¨BeanFactoryå®Œæˆåˆå§‹åŒ–ä¹‹ååšä¸€äº›åç½®æ“ä½œï¼Œspringç•™ç»™å­ç±»çš„æ‰©å±•ã€‚</span></span><br><span class="line">				postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å¯åŠ¨ä¹‹å‰å·²è®¾ç½®çš„BeanFactoryåç½®å¤„ç†å™¨</span></span><br><span class="line">				invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// æ³¨å†ŒBeanå¤„ç†å™¨</span></span><br><span class="line">				registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// ä¸ºæˆ‘ä»¬çš„åº”ç”¨ä¸Šä¸‹æ–‡è®¾ç½®æ¶ˆæ¯æºï¼ˆi18nï¼‰</span></span><br><span class="line">				initMessageSource();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// åˆå§‹åŒ–äº‹ä»¶å¹¿æ’­å™¨</span></span><br><span class="line">				initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// åˆå§‹åŒ–ç‰¹æ®Šçš„Beanåœ¨ç‰¹æ®Šçš„Contextä¸­ï¼Œé»˜è®¤å®ç°ä¸ºç©ºï¼Œäº¤ç»™å„ä¸ªå…·ä½“å­ç±»å®ç°</span></span><br><span class="line">				onRefresh();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// æ£€æŸ¥ç›‘å¬å™¨å¹¶æ³¨å†Œ</span></span><br><span class="line">				registerListeners();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½çš„Bean</span></span><br><span class="line">				finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// æœ€åä¸€æ­¥å‘å¸ƒç›¸åº”çš„äº‹ä»¶</span></span><br><span class="line">				finishRefresh();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">				<span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">					logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">							<span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å¦‚æœå¯åŠ¨å¤±è´¥çš„è¯ï¼Œè¦é”€æ¯ä¹‹å‰åˆ›å»ºçš„Beansã€‚</span></span><br><span class="line">				destroyBeans();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// é‡ç½®ApplicationContextå†…éƒ¨activeçš„æ ‡å¿—ä½</span></span><br><span class="line">				cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// å‘è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">				<span class="keyword">throw</span> ex;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">finally</span> &#123;</span><br><span class="line">			    <span class="comment">// é‡ç½®Springæ ¸å¿ƒå†…çš„ç¼“å­˜ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½ä¸å†éœ€è¦å•ä¾‹beanç›¸å…³çš„å…ƒæ•°æ®</span></span><br><span class="line">				resetCommonCaches();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>é˜…è¯»å®Œä¹‹åæˆ‘ä»¬é‡ç‚¹å…³æ³¨ obtainFreshBeanFactory()ã€finishBeanFactoryInitialization(beanFactory)è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå› ä¸ºå®è´¨ä¸Šæ•´ä¸ª IOC çš„æµç¨‹éƒ½åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•å½“ä¸­ï¼Œå…¶ä»–çš„æ–¹æ³•ä¸€éƒ¨åˆ†æ˜¯ Spring é¢„ç•™ç»™ç”¨æˆ·çš„è‡ªå®šä¹‰æ“ä½œå¦‚ BeanFactory çš„åç½®å¤„ç†å™¨å’Œ Bean åç½®å¤„ç†å™¨ï¼Œä¸€éƒ¨åˆ†æ˜¯å…³é”®å¯åŠ¨äº‹ä»¶çš„å‘å¸ƒå’Œç›‘å¬æ“ä½œï¼Œä¸€éƒ¨åˆ†æ˜¯å…³äº AOP çš„æ“ä½œã€‚</p>
<p>é¦–å…ˆï¼Œå…ˆä» obtainFreshBeanFactory()å¼€å§‹è¯´èµ·ã€‚</p>
<h2 id="ç¬¬ä¸€æ­¥ï¼šè¯»å–-xml-æ–‡ä»¶å½¢æˆ-DOM-å¯¹è±¡"><a href="#ç¬¬ä¸€æ­¥ï¼šè¯»å–-xml-æ–‡ä»¶å½¢æˆ-DOM-å¯¹è±¡" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šè¯»å– xml æ–‡ä»¶å½¢æˆ DOM å¯¹è±¡"></a>ç¬¬ä¸€æ­¥ï¼šè¯»å– xml æ–‡ä»¶å½¢æˆ DOM å¯¹è±¡</h2><p>åœ¨ getBeanFactory()æ–¹æ³•ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ refreshBeanFactory()æ–¹æ³•è¿›è¡Œåˆ·æ–°ã€‚æˆ‘ä»¬å…ˆè¯´æ˜ä¸€ä¸‹ï¼ŒgetBeanFactory()éå¸¸ç®€å•ï¼Œé»˜è®¤å®ç°åªæ˜¯å°†ä¸Šä¸€æ­¥åˆ·æ–°æˆåŠŸå¥½æ„å»ºå¥½çš„ Bean å·¥å‚è¿›è¡Œè¿”å›ã€‚è¿”å›å‡ºå»çš„ Bean å·¥å‚å·²ç»åŠ è½½å¥½ Bean å®šä¹‰äº†ã€‚æ‰€ä»¥åœ¨ refreshBeanFactory()è¿™ä¸ªæ–¹æ³•ä¸­å·²ç»åŒ…å«äº†ç¬¬ä¸€æ­¥è¯»å– xml æ–‡ä»¶æ„å»º DOM å¯¹è±¡å’Œç¬¬äºŒæ­¥è§£æ DOM ä¸­çš„å…ƒç´ ç”Ÿæˆ Bean å®šä¹‰è¿›è¡Œä¿å­˜ã€‚è®°ä½ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¿å­˜å¥½ Bean å®šä¹‰ï¼Œæ­¤æ—¶å¹¶æœªæ¶‰åŠ Bean çš„å®ä¾‹åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ConfigurableListableBeanFactory <span class="title function_">obtainFreshBeanFactory</span><span class="params">()</span> &#123;</span><br><span class="line">		refreshBeanFactory();</span><br><span class="line">		<span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> getBeanFactory();</span><br><span class="line">		<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">			logger.debug(<span class="string">&quot;Bean factory for &quot;</span> + getDisplayName() + <span class="string">&quot;: &quot;</span> + beanFactory);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> beanFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ refreshBeanFactory()æ–¹æ³•ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">protected final void refreshBeanFactory() throws BeansException &#123;</span><br><span class="line">        // å¦‚æœå½“å‰ApplicationContextä¸­å·²å­˜åœ¨FactoryBeançš„è¯è¿›è¡Œé”€æ¯</span><br><span class="line">		if (hasBeanFactory()) &#123;</span><br><span class="line">			destroyBeans();</span><br><span class="line">			closeBeanFactory();</span><br><span class="line">		&#125;</span><br><span class="line">		try &#123;</span><br><span class="line">		    // å…ˆç”Ÿæˆä¸€ä¸ªBeanFactory</span><br><span class="line">			DefaultListableBeanFactory beanFactory = createBeanFactory();</span><br><span class="line">			// è®¾ç½®åºåˆ—åŒ–</span><br><span class="line">			beanFactory.setSerializationId(getId());</span><br><span class="line">			// è®¾ç½®æ˜¯å¦å¯ä»¥è¦†ç›–Beanå®šä¹‰å’Œæ˜¯å¦å¯ä»¥å¾ªç¯ä¾èµ–ï¼Œå…·ä½“æˆ‘å°±ä¸è§£é‡Šäº†</span><br><span class="line">			customizeBeanFactory(beanFactory);</span><br><span class="line">			// åŠ è½½Beanå®šä¹‰åˆ°Factoryå½“ä¸­å»</span><br><span class="line">			// é‡ç‚¹ï¼</span><br><span class="line">			loadBeanDefinitions(beanFactory);</span><br><span class="line">			synchronized (this.beanFactoryMonitor) &#123;</span><br><span class="line">				this.beanFactory = beanFactory;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		catch (IOException ex) &#123;</span><br><span class="line">			throw new ApplicationContextException(&quot;I/O error parsing bean definition source for &quot; + getDisplayName(), ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œè¿›å…¥æ ¸å¿ƒæ–¹æ³• loadBeanDefinitions(beanFactory)ä¸­ï¼Œå‚æ•°æ˜¯åˆšåˆ›å»ºçš„ beanFactory</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException &#123;</span><br><span class="line">		// æ ¹æ®ä¼ å…¥çš„beanfactoryåˆ›å»ºä¸€ä¸ªxmlè¯»å–å™¨</span><br><span class="line">		XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		// è®¾ç½®beanå®šä¹‰è¯»å–å™¨çš„ç›¸å…³èµ„æºåŠ è½½ç¯å¢ƒ</span><br><span class="line">		beanDefinitionReader.setEnvironment(this.getEnvironment());</span><br><span class="line">		beanDefinitionReader.setResourceLoader(this);</span><br><span class="line">		beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));</span><br><span class="line"></span><br><span class="line">		// è¿™ä¸ªæ–¹æ³•è®©å­ç±»è‡ªå®šä¹‰è¯»å–å™¨Readerçš„åˆå§‹åŒ–</span><br><span class="line">		initBeanDefinitionReader(beanDefinitionReader);</span><br><span class="line">		// æ¥ç€å¼€å§‹å®é™…åŠ è½½Beanå®šä¹‰</span><br><span class="line">		loadBeanDefinitions(beanDefinitionReader);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ loadBeanDefinitions(beanDefinitionReader)æ–¹æ³•ä¸­ï¼Œå‚æ•°æ˜¯åˆšåˆšåˆ›å»ºå¥½çš„ Reader è¯»å–å™¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException &#123;</span><br><span class="line">        // å¦‚æœæœ‰å·²ç»ç”Ÿæˆå¥½çš„Resouceå®ä¾‹çš„è¯å°±ç›´æ¥è¿›è¡Œè§£æã€‚</span><br><span class="line">        // é»˜è®¤çš„å®ç°æ˜¯è¿”å›nullï¼Œç”±å­ç±»è‡ªè¡Œå®ç°ã€‚</span><br><span class="line">		Resource[] configResources = getConfigResources();</span><br><span class="line">		if (configResources != null) &#123;</span><br><span class="line">			reader.loadBeanDefinitions(configResources);</span><br><span class="line">		&#125;</span><br><span class="line">		// æ²¡æœ‰Resoucesçš„è¯å°±è¿›è¡Œè·¯å¾„è§£æã€‚</span><br><span class="line">		String[] configLocations = getConfigLocations();</span><br><span class="line">		if (configLocations != null) &#123;</span><br><span class="line">			reader.loadBeanDefinitions(configLocations);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿›å…¥ reader.loadBeanDefinitions(configLocations)æ–¹æ³•ä¸­ï¼Œè¿™é‡Œé¢æ–¹æ³•è°ƒç”¨æœ‰ç‚¹ç»•ï¼Œæˆ‘è¿™è¾¹åªç®€å•åœ°æè¿°ä¸€ä¸‹</p>
<p>è¯¥æ–¹æ³•ä¼šæ ¹æ®å¤šä¸ªä¸åŒä½ç½®çš„ xml æ–‡ä»¶ä¾æ¬¡è¿›è¡Œå¤„ç†ã€‚<br>æ¥ç€ä¼šå¯¹è·¯å¾„çš„ä¸åŒå†™æ³•è¿›è¡Œä¸åŒå¤„ç†ï¼Œä¾‹å¦‚ classpath æˆ–è€… WEB-INF çš„å‰ç¼€è·¯å¾„ã€‚<br>æ ¹æ®ä¼ å…¥çš„ locations å˜é‡ç”Ÿæˆå¯¹åº”çš„ Resoucesã€‚<br>ç´§æ¥ç€è¿›å…¥ reader.loadBeanDefinitions(resource)æ­¤æ—¶å‚æ•°æ˜¯ Resourceã€‚<br>åœ¨ç»è¿‡ä¸€å±‚è¿›å…¥ loadBeanDefinitions(new EncodedResource(resource))çš„æ–¹æ³•è°ƒç”¨ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(EncodedResource encodedResource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">	Assert.notNull(encodedResource, <span class="string">&quot;EncodedResource must not be null&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">		logger.info(<span class="string">&quot;Loading XML bean definitions from &quot;</span> + encodedResource.getResource());</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡ThreadLocalå®ç°çš„å½“å‰currentResource</span></span><br><span class="line">	Set&lt;EncodedResource&gt; currentResources = <span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.get();</span><br><span class="line">	<span class="keyword">if</span> (currentResources == <span class="literal">null</span>) &#123;</span><br><span class="line">		currentResources = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;EncodedResource&gt;(<span class="number">4</span>);</span><br><span class="line">		<span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.set(currentResources);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!currentResources.add(encodedResource)) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">				<span class="string">&quot;Detected cyclic loading of &quot;</span> + encodedResource + <span class="string">&quot; - check your import definitions!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">	    <span class="comment">// æœ€ä¸»è¦çš„æ–¹æ³•åœ¨è¿™æ®µ</span></span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> encodedResource.getResource().getInputStream();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		    <span class="comment">// ä¼ å…¥æµå¯¹è±¡ï¼Œå¹¶è®¾ç½®å¥½ç¼–ç </span></span><br><span class="line">			<span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(inputStream);</span><br><span class="line">			<span class="keyword">if</span> (encodedResource.getEncoding() != <span class="literal">null</span>) &#123;</span><br><span class="line">				inputSource.setEncoding(encodedResource.getEncoding());</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> doLoadBeanDefinitions(inputSource, encodedResource.getResource());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">finally</span> &#123;</span><br><span class="line">			inputStream.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">				<span class="string">&quot;IOException parsing XML document from &quot;</span> + encodedResource.getResource(), ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">finally</span> &#123;</span><br><span class="line">		currentResources.remove(encodedResource);</span><br><span class="line">		<span class="keyword">if</span> (currentResources.isEmpty()) &#123;</span><br><span class="line">			<span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.remove();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•æœ€ä¸»è¦æ˜¯åˆ›å»ºäº†å¯¹åº”çš„è¾“å…¥æµï¼Œå¹¶è®¾ç½®å¥½ç¼–ç ã€‚</p>
<p>ç„¶åå¼€å§‹è°ƒç”¨ doLoadBeanDefinitions()æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†…éƒ¨æ ¸å¿ƒä»£ç å°±è¿™ä¸¤å¥</span></span><br><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> doLoadDocument(inputSource, resource);</span><br><span class="line"><span class="keyword">return</span> registerBeanDefinitions(doc, resource);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ loadDocument()æ–¹æ³•ä¸­ä¼šç”Ÿæˆä¸€ä¸ª DocumentBuilderImpl å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè°ƒç”¨ parse æ–¹æ³•ï¼Œåœ¨ parse æ–¹æ³•ä¸­ä½¿ç”¨ SAX è¿›è¡Œè§£æåˆšæ‰çš„è¾“å…¥æµåŒ…è£…çš„ InputSourceï¼Œç”Ÿæˆ DOM å¯¹è±¡è¿”å›ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Document <span class="title function_">parse</span><span class="params">(InputSource is)</span> <span class="keyword">throws</span> SAXException, IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (is == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                DOMMessageFormatter.formatMessage(DOMMessageFormatter.DOM_DOMAIN,</span><br><span class="line">                <span class="string">&quot;jaxp-null-input-source&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fSchemaValidator != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fSchemaValidationManager != <span class="literal">null</span>) &#123;</span><br><span class="line">                fSchemaValidationManager.reset();</span><br><span class="line">                fUnparsedEntityHandler.reset();</span><br><span class="line">            &#125;</span><br><span class="line">            resetSchemaValidator();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è§£æxml</span></span><br><span class="line">        domParser.parse(is);</span><br><span class="line">        <span class="comment">// è·å–åˆšæ‰è§£æå¥½çš„dom</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> domParser.getDocument();</span><br><span class="line">        domParser.dropDocumentReferences();</span><br><span class="line">        <span class="keyword">return</span> doc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ­¤æ—¶æˆ‘ä»¬çš„-xml-æ–‡ä»¶å·²ç»åŠ è½½å¹¶è§£ææˆ-DOM-ç»“æ„å¯¹è±¡äº†ï¼Œç¬¬ä¸€æ­¥å·²ç»å®Œæˆäº†ã€‚"><a href="#æ­¤æ—¶æˆ‘ä»¬çš„-xml-æ–‡ä»¶å·²ç»åŠ è½½å¹¶è§£ææˆ-DOM-ç»“æ„å¯¹è±¡äº†ï¼Œç¬¬ä¸€æ­¥å·²ç»å®Œæˆäº†ã€‚" class="headerlink" title="æ­¤æ—¶æˆ‘ä»¬çš„ xml æ–‡ä»¶å·²ç»åŠ è½½å¹¶è§£ææˆ DOM ç»“æ„å¯¹è±¡äº†ï¼Œç¬¬ä¸€æ­¥å·²ç»å®Œæˆäº†ã€‚"></a>æ­¤æ—¶æˆ‘ä»¬çš„ xml æ–‡ä»¶å·²ç»åŠ è½½å¹¶è§£ææˆ DOM ç»“æ„å¯¹è±¡äº†ï¼Œç¬¬ä¸€æ­¥å·²ç»å®Œæˆäº†ã€‚</h4><h2 id="ç¬¬äºŒæ­¥ï¼šè¯»å–-DOM-æ–‡æ¡£å¯¹è±¡é‡Œçš„-Bean-å®šä¹‰å¹¶è£…è½½è¿›-BeanFactory-ä¸­"><a href="#ç¬¬äºŒæ­¥ï¼šè¯»å–-DOM-æ–‡æ¡£å¯¹è±¡é‡Œçš„-Bean-å®šä¹‰å¹¶è£…è½½è¿›-BeanFactory-ä¸­" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šè¯»å– DOM æ–‡æ¡£å¯¹è±¡é‡Œçš„ Bean å®šä¹‰å¹¶è£…è½½è¿› BeanFactory ä¸­"></a>ç¬¬äºŒæ­¥ï¼šè¯»å– DOM æ–‡æ¡£å¯¹è±¡é‡Œçš„ Bean å®šä¹‰å¹¶è£…è½½è¿› BeanFactory ä¸­</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†…éƒ¨æ ¸å¿ƒä»£ç å°±è¿™ä¸¤å¥</span></span><br><span class="line"><span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> doLoadDocument(inputSource, resource);</span><br><span class="line"><span class="keyword">return</span> registerBeanDefinitions(doc, resource);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å†å›åˆ°åˆšåˆšè®²åˆ°çš„è¿™ä¸¤å¥æ ¸å¿ƒä»£ç ï¼Œç¬¬ä¸€å¥è·å– DOM å¯¹è±¡åï¼Œç´§æ¥ç€ç¬¬äºŒå¥ registerBeanDefinitions(doc, resource)å¼€å§‹äº† bean å®šä¹‰çš„æ³¨å†Œå·¥ä½œã€‚</p>
<p>è¿›å…¥ registerBeanDefinitions(doc, resource)æ–¹æ³•ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(Document doc, Resource resource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">    <span class="comment">// ç”ŸæˆDOMè¯»å–å™¨ï¼Œè¿™ä¸ªå’Œåˆšæ‰çš„è¯»å–å™¨ä¸ä¸€æ ·ï¼Œä¹‹å‰çš„è¯»å–å™¨æ˜¯xmlè¯»å–å™¨ã€‚</span></span><br><span class="line">		<span class="type">BeanDefinitionDocumentReader</span> <span class="variable">documentReader</span> <span class="operator">=</span> createBeanDefinitionDocumentReader();</span><br><span class="line">		<span class="comment">// è·å–ä¹‹å‰çš„beanå®šä¹‰æ•°é‡</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">countBefore</span> <span class="operator">=</span> getRegistry().getBeanDefinitionCount();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// è¿›å…¥é‡ç‚¹</span></span><br><span class="line">		documentReader.registerBeanDefinitions(doc, createReaderContext(resource));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ç”¨åˆšåˆšåˆåˆ›å»ºçš„beanå®šä¹‰æ•°é‡ - ä¹‹å‰çš„beanå®šä¹‰æ•°é‡ = åˆšåˆšä¸€å…±åˆ›å»ºçš„beanå®šä¹‰</span></span><br><span class="line">		<span class="keyword">return</span> getRegistry().getBeanDefinitionCount() - countBefore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ documentReader.registerBeanDefinitions(doc, createReaderContext(resource))æ–¹æ³•ã€‚<br>æ–¹æ³•å†…è¯»å–æ–‡æ¡£çš„ root å…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doRegisterBeanDefinitions</span><span class="params">(Element root)</span> &#123;</span><br><span class="line">		<span class="comment">// Any nested &lt;beans&gt; elements will cause recursion in this method. In</span></span><br><span class="line">		<span class="comment">// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,</span></span><br><span class="line">		<span class="comment">// keep track of the current (parent) delegate, which may be null. Create</span></span><br><span class="line">		<span class="comment">// the new (child) delegate with a reference to the parent for fallback purposes,</span></span><br><span class="line">		<span class="comment">// then ultimately reset this.delegate back to its original (parent) reference.</span></span><br><span class="line">		<span class="comment">// this behavior emulates a stack of delegates without actually necessitating one.</span></span><br><span class="line">		<span class="type">BeanDefinitionParserDelegate</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>.delegate;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ç”ŸæˆBeanå®šä¹‰è§£æç±»</span></span><br><span class="line">		<span class="built_in">this</span>.delegate = createDelegate(getReaderContext(), root, parent);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯xmlæ–‡æ¡£ä¸­çš„namespaceï¼Œè¿›è¡Œç›¸åº”å¤„ç†</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">			<span class="type">String</span> <span class="variable">profileSpec</span> <span class="operator">=</span> root.getAttribute(PROFILE_ATTRIBUTE);</span><br><span class="line">			<span class="keyword">if</span> (StringUtils.hasText(profileSpec)) &#123;</span><br><span class="line">				String[] specifiedProfiles = StringUtils.tokenizeToStringArray(</span><br><span class="line">						profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span><br><span class="line">				<span class="keyword">if</span> (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) &#123;</span><br><span class="line">					<span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">						logger.info(<span class="string">&quot;Skipped XML bean definition file due to specified profiles [&quot;</span> + profileSpec +</span><br><span class="line">								<span class="string">&quot;] not matching: &quot;</span> + getReaderContext().getResource());</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">return</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// springé¢„ç•™ç»™å­ç±»çš„æ‹“å±•æ€§æ–¹æ³•</span></span><br><span class="line">		preProcessXml(root);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// é‡ç‚¹</span></span><br><span class="line">		<span class="comment">// å¼€å§‹è§£æBeanå®šä¹‰</span></span><br><span class="line">		parseBeanDefinitions(root, <span class="built_in">this</span>.delegate);</span><br><span class="line"></span><br><span class="line">	  <span class="comment">// springé¢„ç•™ç»™å­ç±»çš„æ‹“å±•æ€§æ–¹æ³•</span></span><br><span class="line">		postProcessXml(root);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">this</span>.delegate = parent;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ parseBeanDefinitions(root, this.delegate)ã€‚å°†ä¹‹å‰çš„æ–‡æ¡£å¯¹è±¡å’Œ bean å®šä¹‰è§£æç±»ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">parseBeanDefinitions</span><span class="params">(Element root, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">			<span class="type">NodeList</span> <span class="variable">nl</span> <span class="operator">=</span> root.getChildNodes();</span><br><span class="line">			<span class="comment">// éå†å»è§£ææ ¹èŠ‚ç‚¹çš„æ¯ä¸ªå­èŠ‚ç‚¹å…ƒç´ </span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nl.getLength(); i++) &#123;</span><br><span class="line">				<span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> nl.item(i);</span><br><span class="line">				<span class="comment">// å¦‚æœæ˜¯æ ‡ç­¾å…ƒç´ çš„è¯</span></span><br><span class="line">				<span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">					<span class="type">Element</span> <span class="variable">ele</span> <span class="operator">=</span> (Element) node;</span><br><span class="line">					<span class="keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;</span><br><span class="line"></span><br><span class="line">					    <span class="comment">// è§£æé»˜è®¤çš„å…ƒç´ </span></span><br><span class="line">					    <span class="comment">// é‡ç‚¹</span></span><br><span class="line">						parseDefaultElement(ele, delegate);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> &#123;</span><br><span class="line">					    <span class="comment">// è§£ææŒ‡å®šè‡ªå®šä¹‰å…ƒç´ </span></span><br><span class="line">						delegate.parseCustomElement(ele);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">		    <span class="comment">// éé»˜è®¤å‘½åç©ºé—´çš„ï¼Œè¿›è¡Œè‡ªå®šä¹‰è§£æï¼Œå‘½åç©ºé—´å°±æ˜¯xmlæ–‡æ¡£å¤´å†…çš„xmlnsï¼Œç”¨æ¥å®šä¹‰æ ‡ç­¾ã€‚</span></span><br><span class="line">			delegate.parseCustomElement(root);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥åˆ° parseDefaultElement(ele, delegate)å½“ä¸­ï¼Œä¼šå‘ç°å…¶å®å¯¹å››ç§æ ‡ç­¾è¿›è¡Œåˆ†åˆ«çš„è§£æã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;</span><br><span class="line">			importBeanDefinitionResource(ele);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;</span><br><span class="line">			processAliasRegistration(ele);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;</span><br><span class="line">		    <span class="comment">// åˆ†æBeanæ ‡ç­¾</span></span><br><span class="line">			processBeanDefinition(ele, delegate);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;</span><br><span class="line">			<span class="comment">// recurse</span></span><br><span class="line">			doRegisterBeanDefinitions(ele);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸»è¦åˆ†æ Bean å…ƒç´ æ ‡ç­¾çš„è§£æï¼Œè¿›å…¥ processBeanDefinition(ele, delegate)æ–¹æ³•ä¸­æœ€å†…å±‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BeanDefinitionHolder <span class="title function_">parseBeanDefinitionElement</span><span class="params">(Element ele, BeanDefinition containingBean)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–beanæ ‡ç­¾å†…çš„id</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> ele.getAttribute(ID_ATTRIBUTE);</span><br><span class="line">		<span class="comment">// è·å–beanæ ‡ç­¾å†…çš„name</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">nameAttr</span> <span class="operator">=</span> ele.getAttribute(NAME_ATTRIBUTE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å¤šåˆ«å</span></span><br><span class="line">		List&lt;String&gt; aliases = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.hasLength(nameAttr)) &#123;</span><br><span class="line">			String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span><br><span class="line">			aliases.addAll(Arrays.asList(nameArr));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“æ²¡æœ‰è®¾ç½®idçš„æ—¶å€™</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> id;</span><br><span class="line">		<span class="keyword">if</span> (!StringUtils.hasText(beanName) &amp;&amp; !aliases.isEmpty()) &#123;</span><br><span class="line">			beanName = aliases.remove(<span class="number">0</span>);</span><br><span class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">				logger.debug(<span class="string">&quot;No XML &#x27;id&#x27; specified - using &#x27;&quot;</span> + beanName +</span><br><span class="line">						<span class="string">&quot;&#x27; as bean name and &quot;</span> + aliases + <span class="string">&quot; as aliases&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥beanNameæ˜¯å¦å”¯ä¸€</span></span><br><span class="line">		<span class="keyword">if</span> (containingBean == <span class="literal">null</span>) &#123;</span><br><span class="line">			checkNameUniqueness(beanName, aliases, ele);</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">// å†…éƒ¨åšäº†Beanæ ‡ç­¾çš„è§£æå·¥ä½œ</span></span><br><span class="line">		<span class="type">AbstractBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> parseBeanDefinitionElement(ele, beanName, containingBean);</span><br><span class="line">		<span class="keyword">if</span> (beanDefinition != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!StringUtils.hasText(beanName)) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (containingBean != <span class="literal">null</span>) &#123;</span><br><span class="line">						beanName = BeanDefinitionReaderUtils.generateBeanName(</span><br><span class="line">								beanDefinition, <span class="built_in">this</span>.readerContext.getRegistry(), <span class="literal">true</span>);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> &#123;</span><br><span class="line">						beanName = <span class="built_in">this</span>.readerContext.generateBeanName(beanDefinition);</span><br><span class="line">						<span class="comment">// Register an alias for the plain bean class name, if still possible,</span></span><br><span class="line">						<span class="comment">// if the generator returned the class name plus a suffix.</span></span><br><span class="line">						<span class="comment">// This is expected for Spring 1.2/2.0 backwards compatibility.</span></span><br><span class="line">						<span class="type">String</span> <span class="variable">beanClassName</span> <span class="operator">=</span> beanDefinition.getBeanClassName();</span><br><span class="line">						<span class="keyword">if</span> (beanClassName != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">								beanName.startsWith(beanClassName) &amp;&amp; beanName.length() &gt; beanClassName.length() &amp;&amp;</span><br><span class="line">								!<span class="built_in">this</span>.readerContext.getRegistry().isBeanNameInUse(beanClassName)) &#123;</span><br><span class="line">							aliases.add(beanClassName);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">						logger.debug(<span class="string">&quot;Neither XML &#x27;id&#x27; nor &#x27;name&#x27; specified - &quot;</span> +</span><br><span class="line">								<span class="string">&quot;using generated bean name [&quot;</span> + beanName + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">					error(ex.getMessage(), ele);</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			String[] aliasesArray = StringUtils.toStringArray(aliases);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(beanDefinition, beanName, aliasesArray);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†è§£æå¥½çš„ Bean å®šä¹‰å¹¶é™„åŠ åˆ«åæ•°ç»„å¡«å…¥ new BeanDefinitionHolder(beanDefinition, beanName, aliasesArray)ä¸­è¿›è¡Œè¿”å›ã€‚ç„¶åè°ƒç”¨ä»¥ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry())</span><br></pre></td></tr></table></figure>

<p>æœ€ä¸»è¦çš„æ“ä½œå°±æ˜¯å°†åˆšæ‰è§£æå¥½çš„ Bean å®šä¹‰æ”¾å…¥ beanDefinitionMap ä¸­å»ã€‚</p>
<h4 id="è§£ææˆåŠŸåå°†-Bean-å®šä¹‰è¿›è¡Œä¿å­˜ã€‚ç¬¬äºŒæ­¥ä¹Ÿå·²ç»å®Œæˆã€‚"><a href="#è§£ææˆåŠŸåå°†-Bean-å®šä¹‰è¿›è¡Œä¿å­˜ã€‚ç¬¬äºŒæ­¥ä¹Ÿå·²ç»å®Œæˆã€‚" class="headerlink" title="è§£ææˆåŠŸåå°† Bean å®šä¹‰è¿›è¡Œä¿å­˜ã€‚ç¬¬äºŒæ­¥ä¹Ÿå·²ç»å®Œæˆã€‚"></a>è§£ææˆåŠŸåå°† Bean å®šä¹‰è¿›è¡Œä¿å­˜ã€‚ç¬¬äºŒæ­¥ä¹Ÿå·²ç»å®Œæˆã€‚</h4><h2 id="ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨åˆ›å»ºå¥½çš„-Bean-å®šä¹‰ï¼Œå¼€å§‹å®ä¾‹åŒ–-Beanã€‚"><a href="#ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨åˆ›å»ºå¥½çš„-Bean-å®šä¹‰ï¼Œå¼€å§‹å®ä¾‹åŒ–-Beanã€‚" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨åˆ›å»ºå¥½çš„ Bean å®šä¹‰ï¼Œå¼€å§‹å®ä¾‹åŒ– Beanã€‚"></a>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨åˆ›å»ºå¥½çš„ Bean å®šä¹‰ï¼Œå¼€å§‹å®ä¾‹åŒ– Beanã€‚</h2><p>æˆ‘ä»¬å›åˆ°æœ€å¼€å§‹çš„ refresh æ–¹æ³•ä¸­ï¼Œåœ¨ finishBeanFactoryInitialization(beanFactory)æ–¹æ³•ä¸­ï¼Œå¼€å§‹å®ä¾‹åŒ–éæ‡’åŠ è½½çš„ Bean å¯¹è±¡ã€‚æˆ‘ä»¬è·Ÿç€è°ƒç”¨é“¾è¿›å…¥åˆ° preInstantiateSingletons()æ–¹æ³•ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preInstantiateSingletons</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">		<span class="built_in">this</span>.logger.debug(<span class="string">&quot;Pre-instantiating singletons in &quot;</span> + <span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†ä¹‹å‰åšå¥½çš„beanå®šä¹‰ååˆ—è¡¨æ‹·è´æ”¾è¿›beanNamesä¸­ï¼Œç„¶åå¼€å§‹éå†</span></span><br><span class="line">	List&lt;String&gt; beanNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(<span class="built_in">this</span>.beanDefinitionNames);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è§¦å‘æ‰€æœ‰éæ‡’åŠ è½½çš„å•ä¾‹Beanå®ä¾‹åŒ–</span></span><br><span class="line">	<span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">		<span class="type">RootBeanDefinition</span> <span class="variable">bd</span> <span class="operator">=</span> getMergedLocalBeanDefinition(beanName);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¦‚æœéæŠ½è±¡å¹¶ä¸”æ˜¯å•ä¾‹å’Œéæ‡’åŠ è½½çš„è¯</span></span><br><span class="line">		<span class="keyword">if</span> (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123;</span><br><span class="line">		    <span class="comment">// æ£€æµ‹æ˜¯å¦æ˜¯å·¥å‚æ–¹æ³•Beanã€‚ åˆ›å»ºBeançš„ä¸åŒæ–¹å¼ï¼Œè¯»è€…å¯è‡ªè¡Œç™¾åº¦ã€‚</span></span><br><span class="line">			<span class="keyword">if</span> (isFactoryBean(beanName)) &#123;</span><br><span class="line">				<span class="keyword">final</span> FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) getBean(FACTORY_BEAN_PREFIX + beanName);</span><br><span class="line">				<span class="type">boolean</span> isEagerInit;</span><br><span class="line">				<span class="keyword">if</span> (System.getSecurityManager() != <span class="literal">null</span> &amp;&amp; factory <span class="keyword">instanceof</span> SmartFactoryBean) &#123;</span><br><span class="line">					isEagerInit = AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>&lt;Boolean&gt;() &#123;</span><br><span class="line">						<span class="meta">@Override</span></span><br><span class="line">						<span class="keyword">public</span> Boolean <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">							<span class="keyword">return</span> ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit();</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;, getAccessControlContext());</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					isEagerInit = (factory <span class="keyword">instanceof</span> SmartFactoryBean &amp;&amp;</span><br><span class="line">							((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (isEagerInit) &#123;</span><br><span class="line">					getBean(beanName);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				getBean(beanName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³äºå®ä¾‹åŒ–ä¹‹ååšçš„è‡ªå®šä¹‰æ“ä½œä»£ç çœç•¥....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥æ–¹æ³•ä¸­æ ¹æ® Bean å®ä¾‹æ˜¯é€šè¿‡å·¥å‚æ–¹æ³•å®ä¾‹è¿˜æ˜¯æ™®é€šå®ä¾‹åŒ–ï¼Œæœ€ä¸»è¦çš„æ–¹æ³•è¿˜æ˜¯ getBean(beanName)æ–¹æ³•ã€‚æˆ‘ä»¬ç»§ç»­åˆ†ææ™®é€šå®ä¾‹åŒ–çš„è¿‡ç¨‹ã€‚è¿›å…¥ getBean()æ–¹æ³•å½“ä¸­ doGetBean()æ–¹æ³•ï¼Œå‘ç°æ–¹æ³•å‚æ•° doGetBean(name, null, null, false)åä¸‰ä¸ªå‚æ•°å…¨éƒ¨ä¸º null,å®ƒå°±æ˜¯æ•´ä¸ª IOC ä¸­çš„æ ¸å¿ƒä»£ç ã€‚</p>
<p>ä»£ç ä¸­å…ˆé€šè¿‡å®ä¾‹åŒ– Bean,å®ä¾‹åŒ–å¥½ä¹‹åå†åˆ¤æ–­è¯¥ Bean æ‰€éœ€çš„ä¾èµ–ï¼Œå¹¶é€’å½’è°ƒç”¨è¿›è¡Œå®ä¾‹åŒ– beanï¼ŒæˆåŠŸåæ•´ä¸ª IOC çš„æ ¸å¿ƒæµç¨‹ä¹Ÿå°±å®Œæˆäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(</span></span><br><span class="line"><span class="params">		<span class="keyword">final</span> String name, <span class="keyword">final</span> Class&lt;T&gt; requiredType, <span class="keyword">final</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span></span><br><span class="line">		<span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">final</span> <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> transformedBeanName(name);</span><br><span class="line">	Object bean;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä»ç¼“å­˜ä¸­è·å–beanNameå¯¹åº”çš„å•ä¾‹</span></span><br><span class="line">	<span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> getSingleton(beanName);</span><br><span class="line">	<span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">			<span class="keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">				logger.debug(<span class="string">&quot;Returning eagerly cached instance of singleton bean &#x27;&quot;</span> + beanName +</span><br><span class="line">						<span class="string">&quot;&#x27; that is not fully initialized yet - a consequence of a circular reference&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				logger.debug(<span class="string">&quot;Returning cached instance of singleton bean &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// è¿”å›beanNameå¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼ˆä¸»è¦ç”¨äºFactoryBeançš„ç‰¹æ®Šå¤„ç†ï¼Œ</span></span><br><span class="line">		<span class="comment">// æ™®é€šBeanä¼šç›´æ¥è¿”å›sharedInstanceæœ¬èº«ï¼‰</span></span><br><span class="line">		bean = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">	    <span class="comment">// scopeä¸ºprototypeçš„å¾ªç¯ä¾èµ–æ ¡éªŒï¼šå¦‚æœbeanNameå·²ç»æ­£åœ¨åˆ›å»ºBeanå®</span></span><br><span class="line">	    <span class="comment">// ä¾‹ä¸­ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬åˆè¦å†ä¸€æ¬¡åˆ›å»ºbeanNameçš„å®ä¾‹ï¼Œåˆ™ä»£è¡¨å‡ºç°äº†å¾ªç¯</span></span><br><span class="line">	    <span class="comment">// ä¾èµ–ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸ã€‚</span></span><br><span class="line">            <span class="comment">// ä¾‹å­ï¼šå¦‚æœå­˜åœ¨Aä¸­æœ‰Bçš„å±æ€§ï¼ŒBä¸­æœ‰Açš„å±æ€§ï¼Œé‚£ä¹ˆå½“ä¾èµ–æ³¨å…¥çš„æ—¶å€™</span></span><br><span class="line">            <span class="comment">//ï¼Œå°±ä¼šäº§ç”Ÿå½“Aè¿˜æœªåˆ›å»ºå®Œçš„æ—¶å€™å› ä¸ºå¯¹äºBçš„åˆ›å»ºå†æ¬¡è¿”å›åˆ›å»ºAï¼Œé€ æˆ</span></span><br><span class="line">            <span class="comment">//å¾ªç¯ä¾èµ–</span></span><br><span class="line">		<span class="keyword">if</span> (isPrototypeCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">    	<span class="comment">//å¦‚æœparentBeanFactoryå­˜åœ¨ï¼Œå¹¶ä¸”beanNameåœ¨å½“å‰BeanFactoryä¸å­˜åœ¨</span></span><br><span class="line">    	<span class="comment">//Beanå®šä¹‰ï¼Œåˆ™å°è¯•ä»parentBeanFactoryä¸­è·å–beanå®ä¾‹</span></span><br><span class="line">		<span class="type">BeanFactory</span> <span class="variable">parentBeanFactory</span> <span class="operator">=</span> getParentBeanFactory();</span><br><span class="line">		<span class="keyword">if</span> (parentBeanFactory != <span class="literal">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;</span><br><span class="line">			<span class="comment">// å°†åˆ«åè§£ææˆçœŸæ­£çš„beanName</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">nameToLookup</span> <span class="operator">=</span> originalBeanName(name);</span><br><span class="line">			<span class="keyword">if</span> (args != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="comment">// Delegation to parent with explicit args.</span></span><br><span class="line">				<span class="keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// No args -&gt; delegate to standard getBean method.</span></span><br><span class="line">				<span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœä¸éœ€è¦ç±»å‹æ£€æŸ¥çš„è¯ æ ‡è®°ä¸ºå·²åˆ›å»º</span></span><br><span class="line">		<span class="keyword">if</span> (!typeCheckOnly) &#123;</span><br><span class="line">			markBeanAsCreated(beanName);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		    <span class="comment">// å°†å­Beanå®šä¹‰ä¸çˆ¶Beanå®šä¹‰è¿›è¡Œæ•´åˆ</span></span><br><span class="line">			<span class="keyword">final</span> <span class="type">RootBeanDefinition</span> <span class="variable">mbd</span> <span class="operator">=</span> getMergedLocalBeanDefinition(beanName);</span><br><span class="line">			<span class="comment">// æ•´åˆåå¦‚æœå‘ç°æ˜¯æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹ æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">			checkMergedBeanDefinition(mbd, beanName, args);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// è·å–Beanå®šä¹‰æ‰€éœ€çš„ä¾èµ–å¹¶é€ä¸€åˆå§‹åŒ–å¡«å……</span></span><br><span class="line">			String[] dependsOn = mbd.getDependsOn();</span><br><span class="line">			<span class="keyword">if</span> (dependsOn != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">for</span> (String dep : dependsOn) &#123;</span><br><span class="line">				    <span class="comment">// åˆ¤æ–­æ˜¯å¦å¾ªç¯ä¾èµ–</span></span><br><span class="line">					<span class="keyword">if</span> (isDependent(beanName, dep)) &#123;</span><br><span class="line">						<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">								<span class="string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">// æ³¨å†Œä¾èµ–çš„Bean</span></span><br><span class="line">					registerDependentBean(dep, beanName);</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="comment">// é€’å½’è°ƒç”¨ç”Ÿæˆæ‰€éœ€ä¾èµ–çš„Bean</span></span><br><span class="line">						getBean(dep);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">						<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">								<span class="string">&quot;&#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>, ex);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// å¦‚æœæ˜¯å•ä¾‹çš„è¯</span></span><br><span class="line">			<span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">				sharedInstance = getSingleton(beanName, <span class="keyword">new</span> <span class="title class_">ObjectFactory</span>&lt;Object&gt;() &#123;</span><br><span class="line">					<span class="meta">@Override</span></span><br><span class="line">					<span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							<span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">							<span class="comment">// Explicitly remove instance from singleton cache: It might have been put there</span></span><br><span class="line">							<span class="comment">// eagerly by the creation process, to allow for circular reference resolution.</span></span><br><span class="line">							<span class="comment">// Also remove any beans that received a temporary reference to the bean.</span></span><br><span class="line">							destroySingleton(beanName);</span><br><span class="line">							<span class="keyword">throw</span> ex;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">				bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯åŸå‹çš„è¯</span></span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (mbd.isPrototype()) &#123;</span><br><span class="line">				<span class="comment">// It&#x27;s a prototype -&gt; create a new instance.</span></span><br><span class="line">				<span class="type">Object</span> <span class="variable">prototypeInstance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					beforePrototypeCreation(beanName);</span><br><span class="line">					prototypeInstance = createBean(beanName, mbd, args);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">finally</span> &#123;</span><br><span class="line">					afterPrototypeCreation(beanName);</span><br><span class="line">				&#125;</span><br><span class="line">				bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);</span><br><span class="line">			&#125;</span><br><span class="line">            		<span class="comment">// éå•ä¾‹å’ŒåŸå‹ èŒƒå›´çš„æƒ…å†µ ä¾‹å¦‚session,requestç­‰æƒ…å†µ</span></span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">String</span> <span class="variable">scopeName</span> <span class="operator">=</span> mbd.getScope();</span><br><span class="line">				<span class="keyword">final</span> <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> <span class="built_in">this</span>.scopes.get(scopeName);</span><br><span class="line">				<span class="keyword">if</span> (scope == <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No Scope registered for scope name &#x27;&quot;</span> + scopeName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="type">Object</span> <span class="variable">scopedInstance</span> <span class="operator">=</span> scope.get(beanName, <span class="keyword">new</span> <span class="title class_">ObjectFactory</span>&lt;Object&gt;() &#123;</span><br><span class="line">						<span class="meta">@Override</span></span><br><span class="line">						<span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">							beforePrototypeCreation(beanName);</span><br><span class="line">							<span class="keyword">try</span> &#123;</span><br><span class="line">								<span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">finally</span> &#123;</span><br><span class="line">								afterPrototypeCreation(beanName);</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;);</span><br><span class="line">					bean = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">catch</span> (IllegalStateException ex) &#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(beanName,</span><br><span class="line">							<span class="string">&quot;Scope &#x27;&quot;</span> + scopeName + <span class="string">&quot;&#x27; is not active for the current thread; consider &quot;</span> +</span><br><span class="line">							<span class="string">&quot;defining a scoped proxy for this bean if you intend to refer to it from a singleton&quot;</span>,</span><br><span class="line">							ex);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">			cleanupAfterBeanCreationFailure(beanName);</span><br><span class="line">			<span class="keyword">throw</span> ex;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€æµ‹å®ä¾‹Beançš„ç±»å‹å’Œæ‰€éœ€ç±»å‹æ˜¯å¦ä¸€è‡´</span></span><br><span class="line">	<span class="keyword">if</span> (requiredType != <span class="literal">null</span> &amp;&amp; bean != <span class="literal">null</span> &amp;&amp; !requiredType.isInstance(bean)) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> getTypeConverter().convertIfNecessary(bean, requiredType);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (TypeMismatchException ex) &#123;</span><br><span class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">				logger.debug(<span class="string">&quot;Failed to convert bean &#x27;&quot;</span> + name + <span class="string">&quot;&#x27; to required type &#x27;&quot;</span> +</span><br><span class="line">						ClassUtils.getQualifiedName(requiredType) + <span class="string">&quot;&#x27;&quot;</span>, ex);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanNotOfRequiredTypeException</span>(name, requiredType, bean.getClass());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (T) bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ ¹æ®-Bean-å®šä¹‰å»å®ä¾‹åŒ–-Beanã€‚ç¬¬ä¸‰æ­¥ä¹Ÿå·²ç»å®Œæˆã€‚"><a href="#æ ¹æ®-Bean-å®šä¹‰å»å®ä¾‹åŒ–-Beanã€‚ç¬¬ä¸‰æ­¥ä¹Ÿå·²ç»å®Œæˆã€‚" class="headerlink" title="æ ¹æ® Bean å®šä¹‰å»å®ä¾‹åŒ– Beanã€‚ç¬¬ä¸‰æ­¥ä¹Ÿå·²ç»å®Œæˆã€‚"></a>æ ¹æ® Bean å®šä¹‰å»å®ä¾‹åŒ– Beanã€‚ç¬¬ä¸‰æ­¥ä¹Ÿå·²ç»å®Œæˆã€‚</h4><p>æ–‡ç« ç¯‡å¹…æœ‰é™ï¼ŒIOC æ•´ä¸ªçš„åˆ›å»ºè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒå†—é•¿çš„ï¼Œå¸Œæœ›è¯»è€…çœ‹å®Œæ–‡ç« å¯¹ IOC çš„åˆ›å»ºè¿‡ç¨‹æœ‰ä¸€ä¸ªä¸»å¹²è„‰ç»œçš„æ€è·¯ä¹‹åè¿˜æ˜¯éœ€è¦ç¿»å¼€æºç è¿›è¡Œè§£è¯»ï¼Œå…¶å®é˜…è¯»æºç å¹¶ä¸éš¾ï¼Œå› ä¸º Spring çš„ä»£ç æ³¨é‡Šéƒ½æŒºå¥å…¨ï¼Œå¦‚æœé‡åˆ°ä¸æ¸…æ¥šçš„ç¨å¾® google ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚å»ºè®®è¯»è€…è‡ªå·±è¯•ç€ä¸€æ­¥ä¸€æ­¥çš„åˆ†æ IOC è¿‡ç¨‹çš„æºç ã€‚</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/6/">ä¸‹ä¸€é¡µ</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2023
        <i class="ri-heart-fill heart_icon"></i> é«˜è¡Œè¡Œ
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>è®¿é—®äººæ•°:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>æµè§ˆæ¬¡æ•°:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="é«˜è¡Œè¡Œçš„ä¸ªäººåšå®¢"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://gaohanghang.lofter.com">æ‘„å½±</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/twitter">Twitter</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://weibo.com/u/5125203090">å¾®åš</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">å…³äºæˆ‘</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="æœç´¢">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>è¯·æˆ‘å–æ¯å’–å•¡å§~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>