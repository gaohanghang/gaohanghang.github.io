<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="个人公众号《骇客与画家》" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 高行行的个人博客</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">高行行的个人博客</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '科技需要人文的浇灌', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  <ul class="ads">
    
        <li>
            <a target="_blank" rel="noopener" href="https://curl.qcloud.com/kvO7hb43">
                <img src="https://pic.imgdb.cn/item/62174b452ab3f51d912a5ccc.jpg" width="300" alt="云服务器限时秒杀">
            </a>
        </li>
    
        <li>
            <a target="_blank" rel="noopener" href="https://www.vultr.com/?ref=8630075">
                <img src="https://pic.imgdb.cn/item/62174b452ab3f51d912a5cd7.png" width="300" alt="vultr优惠vps">
            </a>
        </li>
    
</ul>
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-周末推荐-Vol-1"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/22/%E5%91%A8%E6%9C%AB%E6%8E%A8%E8%8D%90-Vol-1/"
    >周末推荐 Vol. 1</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/03/22/%E5%91%A8%E6%9C%AB%E6%8E%A8%E8%8D%90-Vol-1/" class="article-date">
  <time datetime="2020-03-22T13:33:27.000Z" itemprop="datePublished">2020-03-22</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdfscof826j30xc0p01kx.jpg"></p>
<blockquote>
<p>推荐些书籍和影视作品 🙃，充实周末</p>
</blockquote>
<h2 id="1-书籍"><a href="#1-书籍" class="headerlink" title="1. 书籍"></a>1. 书籍</h2><h3 id="1-1《万万没想到：用理工科思维理解世界》"><a href="#1-1《万万没想到：用理工科思维理解世界》" class="headerlink" title="1.1《万万没想到：用理工科思维理解世界》"></a>1.1《万万没想到：用理工科思维理解世界》</h3><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdfscv83hhj307i0amjvw.jpg"></p>
<blockquote>
<p>本书精选了万维钢老师的文章和书评，以“用理工科思维理解世界”为导向。作者常用有趣的实验、数据来解读感性的事物，其理工科思维涉及行为经济学、认知心理学、社会学、统计学、物理等许多学科，以前沿的科学视角解读生活，为人们提供了认知的新方法。读完本书相当于精读了十几本经过筛选 、再创作及通俗化处理的巨著，不仅有趣还十分有营养。</p>
<p>豆瓣评分8.2</p>
</blockquote>
<h3 id="1-2《罗素思想小品》"><a href="#1-2《罗素思想小品》" class="headerlink" title="1.2《罗素思想小品》"></a>1.2《罗素思想小品》</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1584805148611-fcd75f32-eccd-466e-b7f7-1d7ac0e3b501.png"></p>
<blockquote>
<p>本书由西方思想研究者、权威译者张广勇先生编译，汇集了罗素富有思想性和可读性的作品，涉及哲学、政治、社会、文化、教育、人生、伦理等各个方面。他的机智和幽默，博学与深思，让读者不仅可以获得阅读的喜悦，更能收获生活的智慧。</p>
<p>豆瓣评分7.9</p>
</blockquote>
<h2 id="2-动漫"><a href="#2-动漫" class="headerlink" title="2. 动漫"></a>2. 动漫</h2><h3 id="2-1《我的三体之章北海传》"><a href="#2-1《我的三体之章北海传》" class="headerlink" title="2.1《我的三体之章北海传》"></a>2.1《我的三体之章北海传》</h3><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdfscxje96j307i0a079h.jpg"></p>
<blockquote>
<p>《我的三体》是一部粉丝自制的动画番剧，旨在以MC风格将《三体》的故事做成动画。《我的三体》改编自刘慈欣的科幻小说《三体》，且对原著部分剧情进行了删改，除正片外，制作团队还制作了一系列符合原著描写的角色歌。</p>
<p>豆瓣评分9.7分，墙裂推荐，很喜欢，这是第三季，第二季《我的三体之罗辑传》也推荐看</p>
</blockquote>
<h3 id="2-2《异度侵入ID-INVADED》"><a href="#2-2《异度侵入ID-INVADED》" class="headerlink" title="2.2《异度侵入ID:INVADED》"></a>2.2《异度侵入ID:INVADED》</h3><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdfsd37vmwj307i0altdu.jpg"></p>
<blockquote>
<p>本片讲述利用能检测出人们杀意的装置以及利用思想粒子做出的“井”，来探知事件真相的科幻故事</p>
<p>豆瓣评分9.4，推理番</p>
</blockquote>
<h2 id="3-电视剧"><a href="#3-电视剧" class="headerlink" title="3. 电视剧"></a>3. 电视剧</h2><h3 id="3-1《王国第二季》"><a href="#3-1《王国第二季》" class="headerlink" title="3.1《王国第二季》"></a>3.1《王国第二季》</h3><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdfsdiusurj307i0b310c.jpg"></p>
<blockquote>
<p>豆瓣评分8.4，续作，第一季就很喜欢</p>
</blockquote>
<h2 id="4-综艺节目"><a href="#4-综艺节目" class="headerlink" title="4. 综艺节目"></a>4. 综艺节目</h2><h3 id="4-1《周游记》"><a href="#4-1《周游记》" class="headerlink" title="4.1《周游记》"></a>4.1《周游记》</h3><p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdfsdoqnojj307i0b9qax.jpg"></p>
<blockquote>
<p>周杰伦综艺节目。周杰伦的朋友全情参与，方文山、刘德华、五月天、萧敬腾、林俊杰、谢霆锋、陈建州等将和周杰伦一起周游世界，每个城市一首周杰伦歌曲，全程无脚本拍摄，周杰伦全程参与，魔术技能大秀，去巴黎解码《告白气球》，去新加坡看林俊杰《听妈妈的话》，和谢霆锋富士山下看《最长的电影》。</p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-使用electron创建微信读书桌面应用程序"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/06/%E4%BD%BF%E7%94%A8electron%E5%88%9B%E5%BB%BA%E5%BE%AE%E4%BF%A1%E8%AF%BB%E4%B9%A6%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/"
    >使用 electron 创建微信读书Mac客户端</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/03/06/%E4%BD%BF%E7%94%A8electron%E5%88%9B%E5%BB%BA%E5%BE%AE%E4%BF%A1%E8%AF%BB%E4%B9%A6%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" class="article-date">
  <time datetime="2020-03-06T15:57:37.000Z" itemprop="datePublished">2020-03-06</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>2019年11月，微信读书上线了网页版，使用微信读书变得更加便捷了，但使用网页版需要在浏览器打开，会多一个打开浏览器的步骤。</p>
<p>而且将微信读书跟其他网页混在一起使用，感觉自己丢失了一种仪式感和踏实感，因此我用 electron 将微信读书网页版封装为了一个桌面应用程序。</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/gaohanghang/WeChatRead/releases">https://github.com/gaohanghang/WeChatRead/releases</a></p>
<p>首先看下使用效果</p>
</blockquote>
<h2 id="1-效果"><a href="#1-效果" class="headerlink" title="1. 效果"></a>1. 效果</h2><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. <strong>安装</strong></h3><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/gaohanghang/WeChatRead/releases">https://github.com/gaohanghang/WeChatRead/releases</a></p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gclcxac2rzj317o0sqgxh.jpg"></p>
<h3 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. <strong>使用</strong></h3><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gclcxuxmldj31j40u0k60.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gclcy6nj4dj31br0u0njh.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gclcydzjlzj31c00u0qte.jpg"></p>
<h2 id="2-微信读书是什么"><a href="#2-微信读书是什么" class="headerlink" title="2. 微信读书是什么"></a>2. 微信读书是什么</h2><p>微信读书是微信推出的一款基于微信的阅读应用，之前，大家只能安装APP后才能访问，2019年11月微信悄悄上线了微信读书网页版，这对于喜欢在PC上阅读的小伙伴来讲是个好消息。从目前的页面来看，用户可以扫码登录，账户与手机APP同步，也可以查看书架，访问微信读书海量资源，体验不错。</p>
<p>官方公布数据显示，目前微信读书注册用户数2.1亿，日活跃用户超过500万，其中19-35岁年轻用户占比超过60%，本科及以上学历用户占比高达80%，北上广深及其他省会城市&#x2F;直辖市用户占比超过80%。</p>
<p>微信方面表示，微信读书的深度阅读定位和文化知识调性聚集了大量年轻化、高学历的优质用户，使微信读书尤其符合高端定位品牌对于优质曝光环境和高端人群触达的需求。</p>
<p>—— from <a target="_blank" rel="noopener" href="https://www.cnbeta.com/articles/tech/914049.htm">微信读书网页版悄然上线：体验优秀</a></p>
<p><a target="_blank" rel="noopener" href="https://static.cnbetacdn.com/article/2019/1123/e21e0d6bde055d9.png"><img src="https://static.cnbetacdn.com/article/2019/1123/e21e0d6bde055d9.png" alt="img"></a></p>
<h2 id="3-最后"><a href="#3-最后" class="headerlink" title="3. 最后"></a>3. 最后</h2><blockquote>
<p>可能有人会说直接浏览器打开不就行了，何必多次一举 😂</p>
<p>我想说用浏览器打开当然也可以，每个人都有各自的使用习惯，我是比较喜欢用 PC 客户端看书，多一种选择总归是好的</p>
</blockquote>
<h2 id="4-参考文章"><a href="#4-参考文章" class="headerlink" title="4. 参考文章"></a>4. 参考文章</h2><p><a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/tutorial/first-app#%E6%89%93%E9%80%A0%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-electron-%E5%BA%94%E7%94%A8">打造你的第一个 Electron 应用</a></p>
<p><a target="_blank" rel="noopener" href="https://cuiqingcai.com/7701.html">如何用 nativefier 将网页打包成客户端 App</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnbeta.com/articles/tech/914049.htm">微信读书网页版悄然上线：体验优秀</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-为什么我推荐你用语雀记笔记"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/03/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E6%8E%A8%E8%8D%90%E4%BD%A0%E7%94%A8%E8%AF%AD%E9%9B%80%E8%AE%B0%E7%AC%94%E8%AE%B0/"
    >为什么我推荐你用语雀记笔记
  <i class="article-topping">置顶</i>
</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/03/03/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E6%8E%A8%E8%8D%90%E4%BD%A0%E7%94%A8%E8%AF%AD%E9%9B%80%E8%AE%B0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-03-02T16:42:58.000Z" itemprop="datePublished">2020-03-03</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-什么语雀"><a href="#1-什么语雀" class="headerlink" title="1. 什么语雀"></a>1. 什么语雀</h2><p><strong>「语雀」</strong>是一个<strong>「专业的云端知识库」</strong>，孵化自 <a target="_blank" rel="noopener" href="https://www.antfin.com/">蚂蚁金服</a> ，是 <a target="_blank" rel="noopener" href="https://www.yuque.com/yubo/explore/tcaywl">体验科技</a> 理念下的一款创新产品，已是 10 万阿里员工进行文档编写、知识沉淀的标配。注册后即可免费使用。</p>
<p><strong>以下为我的语雀页面</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghi1lg3bomj31p30u0jxc.jpg"></p>
<p>我的语雀链接：<a target="_blank" rel="noopener" href="https://www.yuque.com/gaohanghang">https://www.yuque.com/gaohanghang</a></p>
<h2 id="2-我为什么选择语雀"><a href="#2-我为什么选择语雀" class="headerlink" title="2. 我为什么选择语雀"></a>2. 我为什么选择语雀</h2><p>其实我对自己理想中的笔记软件只有以下几点要求</p>
<ul>
<li>能用 Markdown</li>
<li>支持无限层级</li>
<li>能在网上使用并被别人看到</li>
</ul>
<h3 id="2-1-为什么需要支持-Markdown？"><a href="#2-1-为什么需要支持-Markdown？" class="headerlink" title="2.1 为什么需要支持 Markdown？"></a>2.1 <strong>为什么需要支持 Markdown？</strong></h3><p>Markdown是一种轻量级标记语言，创始人为约翰·格鲁伯（John Gruber），允许人们使用易读易写的纯文本格式编写文档，然后将文本格式转换成有效的XHTML（或者HTML）文档。</p>
<p>使用 Markdown 进行写作会非常方便，首先是学习成本很低，记住几个常用的用法就可以写出干净排版的文章了。自从我在大学学会用 Markdown 之后，我就再也不想用 Word 写文档了。我觉得 Markdown 应该会成为主流的文档书写语言</p>
<p>其次是可移植性高，现在基本所有常见的技术博客平台都支持通过 Markdown 进行写作了，比如 CSDN、博客园、简书、掘金、segmentfault 思否、开源中国这些博客平台。文章在一个平台写完之后，可以很方便的复制到其他平台进行发布。</p>
<p>当然也可以找个一文多发的平台，直接一键将文章发布到所有博客平台，如 OpenWrite 和 ArtiPub，我比较喜欢使用 ArtiPub 。</p>
<h3 id="2-2-为什么需要支持无限层级？"><a href="#2-2-为什么需要支持无限层级？" class="headerlink" title="2.2 为什么需要支持无限层级？"></a>2.2 <strong>为什么需要支持无限层级？</strong></h3><p>因为知识的结构肯定是树形的，只有无限层级的目录才能方便的构建你的知识体系。无限层级的目录能够很方便的存储元知识。元知识，即不可分割的最小知识点。</p>
<p>而普通的笔记软件，目录层级只有一两层，知识的之间的关系不够直观，不能显著的构建一个立体的知识结构，得到的只是线和平面的结构。微软的 OneNote 是支持无限层级的，我之前使用的笔记软件也是这个，但可惜官方一直不支持 Markdown ，用的一直有些痛苦。</p>
<p><strong>像下面这样，在语雀中我可以不断的添加目录层级</strong></p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcg37lin1pj31810u0td4.jpg"></p>
<h3 id="2-3-为什么要能在网上使用并被别人看到呢？"><a href="#2-3-为什么要能在网上使用并被别人看到呢？" class="headerlink" title="2.3 为什么要能在网上使用并被别人看到呢？"></a>2.3 <strong>为什么要能在网上使用并被别人看到呢？</strong></h3><p>能在网上使用首先是因为可以防止文档丢失，如果你只是在自己电脑上记笔记，就会有可能发生不可预测的意外从而丢失自己写过的东西。</p> 
      <a class="article-more-link" href="/2020/03/03/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E6%8E%A8%E8%8D%90%E4%BD%A0%E7%94%A8%E8%AF%AD%E9%9B%80%E8%AE%B0%E7%AC%94%E8%AE%B0/"
        >阅读更多...</a
      >
       
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Java-8-Stream-reduce-实例"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/01/Java-8-Stream-reduce-%E5%AE%9E%E4%BE%8B/"
    >Java 8 Stream.reduce() 使用示例</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/03/01/Java-8-Stream-reduce-%E5%AE%9E%E4%BE%8B/" class="article-date">
  <time datetime="2020-03-01T03:22:01.000Z" itemprop="datePublished">2020-03-01</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>原文地址：<a target="_blank" rel="noopener" href="https://mkyong.com/java8/java-8-stream-reduce-examples/">https://mkyong.com/java8/java-8-stream-reduce-examples/</a></p>
<p>作者：<a target="_blank" rel="noopener" href="https://mkyong.com/author/mkyong/" title="mkyong">mkyong</a></p>
<p>翻译：高行行</p>
</blockquote>
<p>在 Java 8 中，<code>Stream.reduce()</code>合并流的元素并产生单个值。</p>
<p>使用 for 循环的简单求和运算。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] numbers = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i : numbers) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;sum : &quot;</span> + sum); <span class="comment">// 55</span></span><br></pre></td></tr></table></figure>

<p>相当于 <code>Stream.reduce()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] numbers = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1st argument, init value = 0</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, (a, b) -&gt; a + b);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;sum : &quot;</span> + sum); <span class="comment">// 55</span></span><br></pre></td></tr></table></figure>

<p>或方法引用 <code>Integer::sum</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, Integer::sum); <span class="comment">// 55</span></span><br></pre></td></tr></table></figure>

<p><strong>Integer.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds two integers together as per the + operator.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a the first operand</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> b the second operand</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the sum of &#123;<span class="doctag">@code</span> a&#125; and &#123;<span class="doctag">@code</span> b&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> java.util.function.BinaryOperator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-方法签名"><a href="#1-方法签名" class="headerlink" title="1. 方法签名"></a>1. 方法签名</h2><h3 id="1-1-查看Stream-reduce-方法签名："><a href="#1-1-查看Stream-reduce-方法签名：" class="headerlink" title="1.1 查看Stream.reduce()方法签名："></a>1.1 查看<code>Stream.reduce()</code>方法签名：</h3><p><strong>Stream.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T <span class="title function_">reduce</span><span class="params">(T identity, BinaryOperator&lt;T&gt; accumulator)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>IntStream.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">reduce</span><span class="params">(<span class="type">int</span> identity, IntBinaryOperator op)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>LongStream.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">reduce</span><span class="params">(<span class="type">int</span> identity, LongBinaryOperator op)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>identity &#x3D; 默认值或初始值。</li>
<li>BinaryOperator &#x3D; 函数式接口，取两个值并产生一个新值。（注： java Function 函数中的 BinaryOperator<T> 接口用于执行 lambda 表达式并返回一个 T 类型的返回值）</li>
</ul>
<h3 id="1-2-如果缺少identity参数，则没有默认值或初始值，并且它返回-optional。"><a href="#1-2-如果缺少identity参数，则没有默认值或初始值，并且它返回-optional。" class="headerlink" title="1.2 如果缺少identity参数，则没有默认值或初始值，并且它返回 optional。"></a>1.2 如果缺少<code>identity</code>参数，则没有默认值或初始值，并且它返回 optional。</h3><p><strong>Stream.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;T&gt; <span class="title function_">reduce</span><span class="params">(BinaryOperator&lt;T&gt; accumulator)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-更多例子"><a href="#2-更多例子" class="headerlink" title="2. 更多例子"></a>2. 更多例子</h2><h3 id="2-1-数学运算。"><a href="#2-1-数学运算。" class="headerlink" title="2.1 数学运算。"></a>2.1 数学运算。</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] numbers = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, (a, b) -&gt; a + b);    <span class="comment">// 55</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum2</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, Integer::sum);      <span class="comment">// 55</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">sum3</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, (a, b) -&gt; a - b);   <span class="comment">// -55</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum4</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, (a, b) -&gt; a * b);   <span class="comment">// 0, initial is 0, 0 * whatever = 0</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum5</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, (a, b) -&gt; a / b);   <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-最大和最小"><a href="#2-2-最大和最小" class="headerlink" title="2.2 最大和最小"></a>2.2 最大和最小</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] numbers = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, (a, b) -&gt; a &gt; b ? a : b);  <span class="comment">// 10</span></span><br><span class="line"><span class="type">int</span> <span class="variable">max1</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, Integer::max);            <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, (a, b) -&gt; a &lt; b ? a : b);  <span class="comment">// 0</span></span><br><span class="line"><span class="type">int</span> <span class="variable">min1</span> <span class="operator">=</span> Arrays.stream(numbers).reduce(<span class="number">0</span>, Integer::min);            <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-连接字符串。"><a href="#2-3-连接字符串。" class="headerlink" title="2.3 连接字符串。"></a>2.3 连接字符串。</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">String[] strings = &#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// |a|b|c|d|e , the initial | join is not what we want</span></span><br><span class="line"><span class="type">String</span> <span class="variable">reduce</span> <span class="operator">=</span> Arrays.stream(strings).reduce(<span class="string">&quot;&quot;</span>, (a, b) -&gt; a + <span class="string">&quot;|&quot;</span> + b);</span><br><span class="line"></span><br><span class="line"><span class="comment">// a|b|c|d|e, filter the initial &quot;&quot; empty string</span></span><br><span class="line"><span class="type">String</span> <span class="variable">reduce2</span> <span class="operator">=</span> Arrays.stream(strings).reduce(<span class="string">&quot;&quot;</span>, (a, b) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(a)) &#123;</span><br><span class="line">        <span class="keyword">return</span> a + <span class="string">&quot;|&quot;</span> + b;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// a|b|c|d|e , better uses the Java 8 String.join :)  （最好使用 Java 8 的 String.join）</span></span><br><span class="line"><span class="type">String</span> <span class="variable">join</span> <span class="operator">=</span> String.join(<span class="string">&quot;|&quot;</span>, strings);</span><br></pre></td></tr></table></figure>

<h2 id="3-Map-amp-Reduce"><a href="#3-Map-amp-Reduce" class="headerlink" title="3. Map &amp; Reduce"></a>3. Map &amp; Reduce</h2><p>一个简单的 map 和 reduce 示例，用于从发票 List 中求 BigDecimal 的和。</p>
<p><strong>JavaReduce.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mkyong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.math.RoundingMode;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaReduce</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发票集合</span></span><br><span class="line">        List&lt;Invoice&gt; invoices = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Invoice</span>(<span class="string">&quot;A01&quot;</span>, BigDecimal.valueOf(<span class="number">9.99</span>), BigDecimal.valueOf(<span class="number">1</span>)),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Invoice</span>(<span class="string">&quot;A02&quot;</span>, BigDecimal.valueOf(<span class="number">19.99</span>), BigDecimal.valueOf(<span class="number">1.5</span>)),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Invoice</span>(<span class="string">&quot;A03&quot;</span>, BigDecimal.valueOf(<span class="number">4.99</span>), BigDecimal.valueOf(<span class="number">2</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">sum</span> <span class="operator">=</span> invoices.stream()</span><br><span class="line">                .map(x -&gt; x.getQty().multiply(x.getPrice()))    <span class="comment">// map，对集合中的元素进行操作</span></span><br><span class="line">                .reduce(BigDecimal.ZERO, BigDecimal::add);      <span class="comment">// reduce，将上一步得到的结果进行合并得到最终的结果</span></span><br><span class="line"></span><br><span class="line">        System.out.println(sum);    <span class="comment">// 49.955</span></span><br><span class="line">        System.out.println(sum.setScale(<span class="number">2</span>, RoundingMode.HALF_UP));  <span class="comment">// 49.96 使用setScale方法进行四舍五入</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发票号码</span></span><br><span class="line">    String invoiceNo;</span><br><span class="line">    <span class="comment">// 价格</span></span><br><span class="line">    BigDecimal price;</span><br><span class="line">    <span class="comment">// 数量</span></span><br><span class="line">    BigDecimal qty;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters, stters n constructor</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">49.955</span><br><span class="line">49.96</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-你必须知道的23个最有用的Elasticseaerch检索技巧"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/27/%E4%BD%A0%E5%BF%85%E9%A1%BB%E7%9F%A5%E9%81%93%E7%9A%8423%E4%B8%AA%E6%9C%80%E6%9C%89%E7%94%A8%E7%9A%84Elasticseaerch%E6%A3%80%E7%B4%A2%E6%8A%80%E5%B7%A7/"
    >你必须知道的23个最有用的Elasticseaerch检索技巧</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/02/27/%E4%BD%A0%E5%BF%85%E9%A1%BB%E7%9F%A5%E9%81%93%E7%9A%8423%E4%B8%AA%E6%9C%80%E6%9C%89%E7%94%A8%E7%9A%84Elasticseaerch%E6%A3%80%E7%B4%A2%E6%8A%80%E5%B7%A7/" class="article-date">
  <time datetime="2020-02-26T17:22:40.000Z" itemprop="datePublished">2020-02-27</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本文主要介绍 Elasticsearch 23种最有用的检索技巧，提供了详尽的源码举例，<strong>并配有相应的Java API实现</strong>，是不可多得的 Elasticsearch 学习&amp;实战资料</p>
<h4 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h4><p>为了讲解不同类型 ES 检索，我们将要对包含以下类型的文档集合进行检索：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">title               标题</span><br><span class="line">authors             作者</span><br><span class="line">summary             摘要</span><br><span class="line">publish_date        发布日期</span><br><span class="line">num_reviews         评论数</span><br><span class="line">publisher           出版社</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先，我们借助 bulk API 批量创建新的索引并提交数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 设置索引 settings</span><br><span class="line">PUT /bookdb_index</span><br><span class="line">&#123; &quot;settings&quot;: &#123; &quot;number_of_shards&quot;: 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line"># bulk 提交数据</span><br><span class="line">POST /bookdb_index/book/_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:1&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Elasticsearch: The Definitive Guide&quot;,&quot;authors&quot;:[&quot;clinton gormley&quot;,&quot;zachary tong&quot;],&quot;summary&quot;:&quot;A distibuted real-time search and analytics engine&quot;,&quot;publish_date&quot;:&quot;2015-02-07&quot;,&quot;num_reviews&quot;:20,&quot;publisher&quot;:&quot;oreilly&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:2&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,&quot;authors&quot;:[&quot;grant ingersoll&quot;,&quot;thomas morton&quot;,&quot;drew farris&quot;],&quot;summary&quot;:&quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,&quot;publish_date&quot;:&quot;2013-01-24&quot;,&quot;num_reviews&quot;:12,&quot;publisher&quot;:&quot;manning&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:3&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Elasticsearch in Action&quot;,&quot;authors&quot;:[&quot;radu gheorge&quot;,&quot;matthew lee hinman&quot;,&quot;roy russo&quot;],&quot;summary&quot;:&quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,&quot;publish_date&quot;:&quot;2015-12-03&quot;,&quot;num_reviews&quot;:18,&quot;publisher&quot;:&quot;manning&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:4&#125;&#125;</span><br><span class="line">&#123;&quot;title&quot;:&quot;Solr in Action&quot;,&quot;authors&quot;:[&quot;trey grainger&quot;,&quot;timothy potter&quot;],&quot;summary&quot;:&quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,&quot;publish_date&quot;:&quot;2014-04-05&quot;,&quot;num_reviews&quot;:23,&quot;publisher&quot;:&quot;manning&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：本文实验使用的ES版本是 ES 6.3.0</p>
<h3 id="1、基本匹配检索-Basic-Match-Query"><a href="#1、基本匹配检索-Basic-Match-Query" class="headerlink" title="1、基本匹配检索( Basic Match Query)"></a>1、基本匹配检索( Basic Match Query)</h3><h4 id="1-1-全文检索"><a href="#1-1-全文检索" class="headerlink" title="1.1 全文检索"></a>1.1 全文检索</h4><p>有两种方式可以执行全文检索：</p>
<p><strong>1）使用包含参数的检索API，参数作为URL的一部分</strong></p>
<p>举例：以下对 “guide” 执行全文检索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search?q=guide</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 2,</span><br><span class="line">    &quot;max_score&quot;: 1.3278645,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.3278645,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;trey grainger&quot;,</span><br><span class="line">            &quot;timothy potter&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 23,</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.2871116,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;clinton gormley&quot;,</span><br><span class="line">            &quot;zachary tong&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 20,</span><br><span class="line">          &quot;publisher&quot;: &quot;oreilly&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>2）使用完整的ES DSL，其中Json body作为请求体</strong> 其执行结果如方式 1）结果一致.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;guide&quot;,</span><br><span class="line">      &quot;fields&quot; : [&quot;_all&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>解读：</strong> 使用multi_match关键字代替match关键字，作为对多个字段运行相同查询的方便的简写方式。 fields属性指定要查询的字段，在这种情况下，我们要对文档中的所有字段进行查询</p>
<blockquote>
<p>注意：ES 6.x 默认不启用 <code>_all</code> 字段, 不指定 fields 默认搜索为所有字段</p>
</blockquote>
<h4 id="1-2-指定特定字段检索"><a href="#1-2-指定特定字段检索" class="headerlink" title="1.2 指定特定字段检索"></a>1.2 指定特定字段检索</h4><p>这两个API也允许您指定要搜索的字段。<br>例如，要在标题字段(title)中搜索带有 “in action” 字样的图书</p>
<p><strong>1）URL检索方式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search?q=title:in action</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 2,</span><br><span class="line">    &quot;max_score&quot;: 1.6323128,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.6323128,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;radu gheorge&quot;,</span><br><span class="line">            &quot;matthew lee hinman&quot;,</span><br><span class="line">            &quot;roy russo&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 18,</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.6323128,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;trey grainger&quot;,</span><br><span class="line">            &quot;timothy potter&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 23,</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>2）DSL检索方式</strong> 然而，full body的DSL为您提供了创建更复杂查询的更多灵活性（我们将在后面看到）以及指定您希望的返回结果。在下面的示例中，我们指定要返回的结果数、偏移量（对分页有用）、我们要返回的文档字段以及属性的高亮显示。</p>
<p>结果数的表示方式：size<br>偏移值的表示方式：from<br>指定返回字段 的表示方式 ：_source<br>高亮显示 的表示方式 ：highliaght</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;in action&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;: 2,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;],</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 2,</span><br><span class="line">    &quot;max_score&quot;: 1.6323128,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.6323128,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: [</span><br><span class="line">            &quot;Elasticsearch &lt;em&gt;in&lt;/em&gt; &lt;em&gt;Action&lt;/em&gt;&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.6323128,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: [</span><br><span class="line">            &quot;Solr &lt;em&gt;in&lt;/em&gt; &lt;em&gt;Action&lt;/em&gt;&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:</p>
<ol>
<li>对于 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">multi-word</a> 检索，匹配查询允许您指定是否使用 and 运算符， 而不是使用默认 or 运算符 —&gt; “operator” : “and”</li>
<li>您还可以指定 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html">minimum_should_match</a> 选项来调整返回结果的相关性，详细信息可以在Elasticsearch指南中查询Elasticsearch guide获取。</li>
</ol>
</blockquote>
<h4 id="2、多字段检索-Multi-field-Search"><a href="#2、多字段检索-Multi-field-Search" class="headerlink" title="2、多字段检索 (Multi-field Search)"></a>2、多字段检索 (Multi-field Search)</h4><p>如我们已经看到的，要在搜索中查询多个文档字段（例如在标题和摘要中搜索相同的查询字符串），请使用multi_match查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;guide&quot;, </span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 3,</span><br><span class="line">    &quot;max_score&quot;: 2.0281231,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 2.0281231,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;clinton gormley&quot;,</span><br><span class="line">            &quot;zachary tong&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 20,</span><br><span class="line">          &quot;publisher&quot;: &quot;oreilly&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.3278645,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;trey grainger&quot;,</span><br><span class="line">            &quot;timothy potter&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 23,</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.0333893,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;radu gheorge&quot;,</span><br><span class="line">            &quot;matthew lee hinman&quot;,</span><br><span class="line">            &quot;roy russo&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 18,</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：以上结果中文档4（_id&#x3D;4）匹配的原因是guide在summary存在。</p>
</blockquote>
<h4 id="3、-Boosting提升某字段得分的检索-Boosting"><a href="#3、-Boosting提升某字段得分的检索-Boosting" class="headerlink" title="3、 Boosting提升某字段得分的检索( Boosting)"></a>3、 Boosting提升某字段得分的检索( Boosting)</h4><p>由于我们正在多个字段进行搜索，我们可能希望提高某一字段的得分。 在下面的例子中，我们将“摘要”字段的得分提高了3倍，以增加“摘要”字段的重要性，从而提高文档 4 的相关性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;elasticsearch guide&quot;, </span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;summary^3&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 3,</span><br><span class="line">    &quot;max_score&quot;: 3.9835935,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 3.9835935,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 3.1001682,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 2.0281231,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：Boosting不仅意味着计算得分乘法以增加因子。 实际的提升得分值是通过归一化和一些内部优化。参考 Elasticsearch guide查看更多</p>
</blockquote>
<h4 id="4、Bool检索-Bool-Query"><a href="#4、Bool检索-Bool-Query" class="headerlink" title="4、Bool检索( Bool Query)"></a>4、Bool检索( Bool Query)</h4><p>可以使用 AND &#x2F; OR &#x2F; NOT 运算符来微调我们的搜索查询，以提供更相关或指定的搜索结果。</p>
<p>在搜索API中是通过bool查询来实现的。 bool查询接受 must 参数（等效于AND），一个 must_not 参数（相当于NOT）或者一个 should 参数（等同于OR）。</p>
<p>例如，如果我想在标题中搜索一本名为 “Elasticsearch” 或 “Solr” 的书，AND由 “clinton gormley” 创作，但NOT由 “radu gheorge” 创作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;should&quot;: [</span><br><span class="line">              &#123;&quot;match&quot;: &#123;&quot;title&quot;: &quot;Elasticsearch&quot;&#125;&#125;,</span><br><span class="line">              &#123;&quot;match&quot;: &#123;&quot;title&quot;: &quot;Solr&quot;&#125;&#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;&quot;authors&quot;: &quot;clinton gormely&quot;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;&quot;authors&quot;: &quot;radu gheorge&quot;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 2.0749094,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 2.0749094,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;clinton gormley&quot;,</span><br><span class="line">            &quot;zachary tong&quot;</span><br><span class="line">          ],</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 20,</span><br><span class="line">          &quot;publisher&quot;: &quot;oreilly&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>关于bool查询中的should</strong>， 有两种情况：</p>
<ul>
<li>当should的同级存在must的时候，should中的条件可以满足也可以不满足，满足的越多得分越高</li>
<li>当没有must的时候，默认should中的条件至少要满足一个</li>
</ul>
<blockquote>
<p>注意：您可以看到，bool查询可以包含任何其他查询类型，包括其他布尔查询，以创建任意复杂或深度嵌套的查询</p>
</blockquote>
<h4 id="5、-Fuzzy-模糊检索-Fuzzy-Queries"><a href="#5、-Fuzzy-模糊检索-Fuzzy-Queries" class="headerlink" title="5、 Fuzzy 模糊检索( Fuzzy Queries)"></a>5、 Fuzzy 模糊检索( Fuzzy Queries)</h4><p>在 Match检索 和多匹配检索中可以启用模糊匹配来捕捉拼写错误。 基于与原始词的 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%90%8A%E6%96%87%E6%96%AF%E5%9D%A6%E8%B7%9D%E9%9B%A2">Levenshtein</a> 距离来指定模糊度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;comprihensiv guide&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;],</span><br><span class="line">      &quot;fuzziness&quot;: &quot;AUTO&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;,&quot;summary&quot;,&quot;publish_date&quot;],</span><br><span class="line">  &quot;size&quot;: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 2,</span><br><span class="line">    &quot;max_score&quot;: 2.4344182,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 2.4344182,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.2871116,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>“AUTO” 的模糊值相当于当字段长度大于5时指定值2。但是，设置80％的拼写错误的编辑距离为1，将模糊度设置为1可能会提高整体搜索性能。 有关更多信息， <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/guide/current/fuzzy-matching.html">Typos and Misspellingsch</a></p>
<h4 id="6、-Wildcard-Query-通配符检索"><a href="#6、-Wildcard-Query-通配符检索" class="headerlink" title="6、 Wildcard Query 通配符检索"></a>6、 Wildcard Query 通配符检索</h4><p>通配符查询允许您指定匹配的模式，而不是整个词组（term）检索</p>
<ul>
<li>？ 匹配任何字符</li>
<li><ul>
<li>匹配零个或多个字符</li>
</ul>
</li>
</ul>
<p>举例，要查找具有以 “t” 字母开头的作者的所有记录，如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;wildcard&quot;: &#123;</span><br><span class="line">      &quot;authors&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;t*&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;, &quot;authors&quot;],</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;authors&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 3,</span><br><span class="line">    &quot;max_score&quot;: 1,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;clinton gormley&quot;,</span><br><span class="line">            &quot;zachary tong&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;zachary &lt;em&gt;tong&lt;/em&gt;&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;grant ingersoll&quot;,</span><br><span class="line">            &quot;thomas morton&quot;,</span><br><span class="line">            &quot;drew farris&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;&lt;em&gt;thomas&lt;/em&gt; morton&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;trey grainger&quot;,</span><br><span class="line">            &quot;timothy potter&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;&lt;em&gt;trey&lt;/em&gt; grainger&quot;,</span><br><span class="line">            &quot;&lt;em&gt;timothy&lt;/em&gt; potter&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="7、正则表达式检索-Regexp-Query"><a href="#7、正则表达式检索-Regexp-Query" class="headerlink" title="7、正则表达式检索( Regexp Query)"></a>7、正则表达式检索( Regexp Query)</h4><p>正则表达式能指定比通配符检索更复杂的检索模式，举例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">POST bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;regexp&quot;: &#123;</span><br><span class="line">      &quot;authors&quot;: &quot;t[a-z]*y&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;, &quot;authors&quot;],</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;authors&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 1,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;trey grainger&quot;,</span><br><span class="line">            &quot;timothy potter&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;&lt;em&gt;trey&lt;/em&gt; grainger&quot;,</span><br><span class="line">            &quot;&lt;em&gt;timothy&lt;/em&gt; potter&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="8、匹配短语检索-Match-Phrase-Query"><a href="#8、匹配短语检索-Match-Phrase-Query" class="headerlink" title="8、匹配短语检索( Match Phrase Query)"></a>8、匹配短语检索( Match Phrase Query)</h4><p>匹配短语查询要求查询字符串中的所有词都存在于文档中，按照查询字符串中<strong>指定的顺序</strong>并且<strong>彼此靠近</strong>。</p>
<p>默认情况下，这些词必须完全相邻，但您可以指定偏离值（slop value)，该值指示在仍然考虑文档匹配的情况下词与词之间的偏离值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;search engine&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;],</span><br><span class="line">      &quot;type&quot;: &quot;phrase&quot;,</span><br><span class="line">      &quot;slop&quot;: 3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [ &quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot; ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 2,</span><br><span class="line">    &quot;max_score&quot;: 0.88067603,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.88067603,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.51429313,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：在上面的示例中，对于非短语类型查询，文档_id 1通常具有较高的分数，并且显示在文档_id 4之前，因为其字段长度较短。</p>
</blockquote>
<p>然而，作为一个短语查询，词与词之间的接近度被考虑在内，所以文档_id 4分数更好</p>
<h4 id="9、匹配词组前缀检索"><a href="#9、匹配词组前缀检索" class="headerlink" title="9、匹配词组前缀检索"></a>9、匹配词组前缀检索</h4><p>匹配词组前缀查询在查询时提供搜索即时类型或 “相对简单” “的自动完成版本，而无需以任何方式准备数据。</p>
<p>像match_phrase查询一样，它接受一个斜率参数，使得单词的顺序和相对位置没有那么 “严格”。 它还接受max_expansions参数来限制匹配的条件数以减少资源强度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase_prefix&quot;: &#123;</span><br><span class="line">      &quot;summary&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;search en&quot;,</span><br><span class="line">        &quot;slop&quot;: 3,</span><br><span class="line">        &quot;max_expansions&quot;: 10</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;,&quot;summary&quot;,&quot;publish_date&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：查询时间搜索类型具有性能成本。 一个更好的解决方案是将时间作为索引类型。 更多相关API查询 Completion Suggester API 或者 Edge-Ngram filters 。</p>
</blockquote>
<h4 id="10、字符串检索（-Query-String）"><a href="#10、字符串检索（-Query-String）" class="headerlink" title="10、字符串检索（ Query String）"></a>10、字符串检索（ Query String）</h4><p>query_string查询提供了以简明的简写语法执行多匹配查询 multi_match queries ，布尔查询 bool queries ，提升得分 boosting ，模糊匹配 fuzzy matching ，通配符 wildcards ，正则表达式 regexp 和范围查询 range queries 的方式。</p>
<p>在下面的例子中，我们对 “search algorithm” 一词执行模糊搜索，其中一本作者是 “grant ingersoll” 或 “tom morton”。 我们搜索所有字段，但将提升应用于文档2的摘要字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;(saerch~1 algorithm~1) AND (grant ingersoll)  OR (tom morton)&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;summary^2&quot;,&quot;title&quot;,&quot;authors&quot;,&quot;publisher&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;,&quot;summary&quot;,&quot;authors&quot;],</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;summary&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 1,</span><br><span class="line">    &quot;max_score&quot;: 3.571021,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot;: 3.571021,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,</span><br><span class="line">          &quot;authors&quot;: [</span><br><span class="line">            &quot;grant ingersoll&quot;,</span><br><span class="line">            &quot;thomas morton&quot;,</span><br><span class="line">            &quot;drew farris&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;highlight&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: [</span><br><span class="line">            &quot;organize text using approaches such as full-text &lt;em&gt;search&lt;/em&gt;, proper name recognition, clustering, tagging&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="11、简化的字符串检索-（Simple-Query-String）"><a href="#11、简化的字符串检索-（Simple-Query-String）" class="headerlink" title="11、简化的字符串检索 （Simple Query String）"></a>11、简化的字符串检索 （Simple Query String）</h4><p>simple_query_string 查询是 query_string 查询的一个版本，更适合用于暴露给用户的单个搜索框， 因为它分别用 <code>+</code> &#x2F; <code>|</code> &#x2F; <code>-</code> 替换了 <code>AND</code> &#x2F; <code>OR</code> &#x2F; <code>NOT</code> 的使用，并放弃查询的无效部分，而不是在用户出错时抛出异常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;simple_query_string&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;(saerch~1 algorithm~1) + (grant ingersoll)  | (tom morton)&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;summary^2&quot;,&quot;title&quot;,&quot;authors&quot;,&quot;publisher&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;,&quot;summary&quot;,&quot;authors&quot;],</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;summary&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line"># 结果同上</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="12、Term-x2F-Terms检索（指定字段检索）"><a href="#12、Term-x2F-Terms检索（指定字段检索）" class="headerlink" title="12、Term&#x2F;Terms检索（指定字段检索）"></a>12、Term&#x2F;Terms检索（指定字段检索）</h4><p>上面1-11小节的例子是全文搜索的例子。 有时我们对结构化搜索更感兴趣，我们希望在其中找到完全匹配并返回结果</p>
<p>在下面的例子中，我们搜索 Manning Publications 发布的索引中的所有图书（借助 term和terms查询 ）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;publisher&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;manning&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot; : [&quot;title&quot;,&quot;publish_date&quot;,&quot;publisher&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 3,</span><br><span class="line">    &quot;max_score&quot;: 0.35667494,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.35667494,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2013-01-24&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.35667494,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.35667494,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Multiple terms可指定多个关键词进行检索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">      &quot;publisher&quot;: [&quot;oreilly&quot;, &quot;manning&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="13、Term排序检索-（Term-Query-Sorted）"><a href="#13、Term排序检索-（Term-Query-Sorted）" class="headerlink" title="13、Term排序检索-（Term Query - Sorted）"></a>13、Term排序检索-（Term Query - Sorted）</h4><p>Term查询和其他查询一样，轻松的实现排序。多级排序也是允许的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;publisher&quot;: &#123;</span><br><span class="line">        &quot;value&quot;: &quot;manning&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot; : [&quot;title&quot;,&quot;publish_date&quot;,&quot;publisher&quot;],</span><br><span class="line">  &quot;sort&quot;: [&#123;&quot;publisher.keyword&quot;: &#123; &quot;order&quot;: &quot;desc&quot;&#125;&#125;,</span><br><span class="line">    &#123;&quot;title.keyword&quot;: &#123;&quot;order&quot;: &quot;asc&quot;&#125;&#125;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 3,</span><br><span class="line">    &quot;max_score&quot;: null,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: null,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          &quot;manning&quot;,</span><br><span class="line">          &quot;Elasticsearch in Action&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: null,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          &quot;manning&quot;,</span><br><span class="line">          &quot;Solr in Action&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot;: null,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2013-01-24&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sort&quot;: [</span><br><span class="line">          &quot;manning&quot;,</span><br><span class="line">          &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：Elasticsearch 6.x 全文搜索用text类型的字段，排序用不用 text 类型的字段</p>
</blockquote>
<h4 id="14、范围检索（Range-query）"><a href="#14、范围检索（Range-query）" class="headerlink" title="14、范围检索（Range query）"></a>14、范围检索（Range query）</h4><p>另一个结构化检索的例子是范围检索。下面的举例中，我们检索了2015年发布的书籍。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;publish_date&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: &quot;2015-01-01&quot;,</span><br><span class="line">        &quot;lte&quot;: &quot;2015-12-31&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot; : [&quot;title&quot;,&quot;publish_date&quot;,&quot;publisher&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 2,</span><br><span class="line">    &quot;max_score&quot;: 1,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;oreilly&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 1,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;publisher&quot;: &quot;manning&quot;,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：范围查询适用于日期，数字和字符串类型字段</p>
</blockquote>
<h4 id="15、过滤检索（Filtered-query）"><a href="#15、过滤检索（Filtered-query）" class="headerlink" title="15、过滤检索（Filtered query）"></a>15、过滤检索（Filtered query）</h4><p>（5.0版本起已不再存在，不必关注）</p>
<p>过滤的查询允许您过滤查询的结果。 如下的例子，我们在标题或摘要中查询名为“Elasticsearch”的图书，但是我们希望将结果过滤到只有20个或更多评论的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">POST /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;filtered&quot;: &#123;</span><br><span class="line">            &quot;query&quot; : &#123;</span><br><span class="line">                &quot;multi_match&quot;: &#123;</span><br><span class="line">                    &quot;query&quot;: &quot;elasticsearch&quot;,</span><br><span class="line">                    &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;filter&quot;: &#123;</span><br><span class="line">                &quot;range&quot; : &#123;</span><br><span class="line">                    &quot;num_reviews&quot;: &#123;</span><br><span class="line">                        &quot;gte&quot;: 20</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;_source&quot; : [&quot;title&quot;,&quot;summary&quot;,&quot;publisher&quot;, &quot;num_reviews&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">&quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.5955761,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;publisher&quot;: &quot;oreilly&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 20,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：已过滤的查询不要求存在要过滤的查询。 如果没有指定查询，则运行 match_all 查询，基本上返回索引中的所有文档，然后对其进行过滤。 实际上，首先运行过滤器，减少需要查询的表面积。 此外，过滤器在第一次使用后被缓存，这使得它非常有效</p>
</blockquote>
<p><strong>更新：</strong> 已筛选的查询已推出的Elasticsearch 5.X版本中移除，有利于布尔查询。 这是与上面重写的使用bool查询相同的示例。 返回的结果是完全一样的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;multi_match&quot;: &#123;</span><br><span class="line">            &quot;query&quot;: &quot;elasticsearch&quot;,</span><br><span class="line">            &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;num_reviews&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 20</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot; : [&quot;title&quot;,&quot;summary&quot;,&quot;publisher&quot;, &quot;num_reviews&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="16、多个过滤器检索（Multiple-Filters）"><a href="#16、多个过滤器检索（Multiple-Filters）" class="headerlink" title="16、多个过滤器检索（Multiple Filters）"></a>16、多个过滤器检索（Multiple Filters）</h4><p>（5.x不再支持，无需关注） 多个过滤器可以通过使用布尔过滤器进行组合。</p>
<p>在下一个示例中，过滤器确定返回的结果必须至少包含20个评论，不得在2015年之前发布，并且应该由oreilly发布</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">POST /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;filtered&quot;: &#123;</span><br><span class="line">            &quot;query&quot; : &#123;</span><br><span class="line">                &quot;multi_match&quot;: &#123;</span><br><span class="line">                    &quot;query&quot;: &quot;elasticsearch&quot;,</span><br><span class="line">                    &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;filter&quot;: &#123;</span><br><span class="line">                &quot;bool&quot;: &#123;</span><br><span class="line">                    &quot;must&quot;: &#123;</span><br><span class="line">                        &quot;range&quot; : &#123; &quot;num_reviews&quot;: &#123; &quot;gte&quot;: 20 &#125; &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;must_not&quot;: &#123;</span><br><span class="line">                        &quot;range&quot; : &#123; &quot;publish_date&quot;: &#123; &quot;lte&quot;: &quot;2014-12-31&quot; &#125; &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;should&quot;: &#123;</span><br><span class="line">                        &quot;term&quot;: &#123; &quot;publisher&quot;: &quot;oreilly&quot; &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;_source&quot; : [&quot;title&quot;,&quot;summary&quot;,&quot;publisher&quot;, &quot;num_reviews&quot;, &quot;publish_date&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">&quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.5955761,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;publisher&quot;: &quot;oreilly&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 20,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="17、-Function-得分：Field值因子（-Function-Score-Field-Value-Factor）"><a href="#17、-Function-得分：Field值因子（-Function-Score-Field-Value-Factor）" class="headerlink" title="17、 Function 得分：Field值因子（ Function Score: Field Value Factor）"></a>17、 Function 得分：Field值因子（ Function Score: Field Value Factor）</h4><p>可能有一种情况，您想要将文档中特定字段的值纳入相关性分数的计算。 这在您希望基于其受欢迎程度提升文档的相关性的情况下是有代表性的场景</p>
<p>在我们的例子中，我们希望增加更受欢迎的书籍（按评论数量判断）。 这可以使用field_value_factor函数得分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;multi_match&quot;: &#123;</span><br><span class="line">          &quot;query&quot;: &quot;search engine&quot;,</span><br><span class="line">          &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;field_value_factor&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;num_reviews&quot;,</span><br><span class="line">        &quot;modifier&quot;: &quot;log1p&quot;,</span><br><span class="line">        &quot;factor&quot;: 2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;, &quot;num_reviews&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.5694137,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 20,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 1.4725765,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 23,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.14181662,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 18,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.13297246,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 12,</span><br><span class="line">          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2013-01-24&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注1</strong>：我们可以运行一个常规的multi_match查询，并按num_reviews字段排序，但是我们失去了相关性得分的好处。<br><strong>注2</strong>：有许多附加参数可以调整对原始相关性分数 （如“ modifier ”，“ factor ”，“boost_mode”等）的增强效果的程度。<br>详见 Elasticsearch guide.</p>
</blockquote>
<h4 id="18、-Function-得分：衰减函数-Function-Score-Decay-Functions"><a href="#18、-Function-得分：衰减函数-Function-Score-Decay-Functions" class="headerlink" title="18、 Function 得分：衰减函数( Function Score: Decay Functions )"></a>18、 Function 得分：衰减函数( Function Score: Decay Functions )</h4><p>假设，我们不是想通过一个字段的值逐渐增加得分，以获取理想的结果。 举例：价格范围、数字字段范围、日期范围。 在我们的例子中，我们正在搜索2014年6月左右出版的“ search engines ”的书籍。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">GET bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;multi_match&quot;: &#123;</span><br><span class="line">          &quot;query&quot;: &quot;search engine&quot;,</span><br><span class="line">          &quot;fields&quot;: [&quot;title&quot;, &quot;summary&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;exp&quot;: &#123;</span><br><span class="line">            &quot;publish_date&quot;: &#123;</span><br><span class="line">              &quot;origin&quot;: &quot;2014-06-15&quot;,</span><br><span class="line">              &quot;scale&quot;: &quot;30d&quot;,</span><br><span class="line">              &quot;offset&quot;: &quot;7d&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;boost_mode&quot;: &quot;replace&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;, &quot;summary&quot;, &quot;publish_date&quot;, &quot;num_reviews&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[Results]</span><br><span class="line">  &quot;hits&quot;: &#123;</span><br><span class="line">    &quot;total&quot;: 4,</span><br><span class="line">    &quot;max_score&quot;: 0.22793062,</span><br><span class="line">    &quot;hits&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;4&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.22793062,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;Comprehensive guide to implementing a scalable search engine using Apache Solr&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 23,</span><br><span class="line">          &quot;title&quot;: &quot;Solr in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2014-04-05&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.0049215667,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;A distibuted real-time search and analytics engine&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 20,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch: The Definitive Guide&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-02-07&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.000009612435,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;organize text using approaches such as full-text search, proper name recognition, clustering, tagging, information extraction, and summarization&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 12,</span><br><span class="line">          &quot;title&quot;: &quot;Taming Text: How to Find, Organize, and Manipulate It&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2013-01-24&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot;: &quot;bookdb_index&quot;,</span><br><span class="line">        &quot;_type&quot;: &quot;book&quot;,</span><br><span class="line">        &quot;_id&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot;: 0.0000049185574,</span><br><span class="line">        &quot;_source&quot;: &#123;</span><br><span class="line">          &quot;summary&quot;: &quot;build scalable search applications using Elasticsearch without having to do complex low-level programming or understand advanced data science algorithms&quot;,</span><br><span class="line">          &quot;num_reviews&quot;: 18,</span><br><span class="line">          &quot;title&quot;: &quot;Elasticsearch in Action&quot;,</span><br><span class="line">          &quot;publish_date&quot;: &quot;2015-12-03&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="19、Function得分：脚本得分（-Function-Score-Script-Scoring-）"><a href="#19、Function得分：脚本得分（-Function-Score-Script-Scoring-）" class="headerlink" title="19、Function得分：脚本得分（ Function Score: Script Scoring ）"></a>19、Function得分：脚本得分（ Function Score: Script Scoring ）</h4><p>在内置计分功能不符合您需求的情况下，可以选择指定用于评分的Groovy脚本</p>
<p>在我们的示例中，我们要指定一个考虑到publish_date的脚本，然后再决定考虑多少评论。 较新的书籍可能没有这么多的评论，所以他们不应该为此付出“代价”</p>
<p>得分脚本如下所示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">publish_date = doc[&#x27;publish_date&#x27;].value</span><br><span class="line">num_reviews = doc[&#x27;num_reviews&#x27;].value</span><br><span class="line"></span><br><span class="line">if (publish_date &gt; Date.parse(&#x27;yyyy-MM-dd&#x27;, threshold).getTime()) &#123;</span><br><span class="line">  my_score = Math.log(2.5 + num_reviews)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  my_score = Math.log(1 + num_reviews)</span><br><span class="line">&#125;</span><br><span class="line">return my_score</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>要动态使用评分脚本，我们使用script_score参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">GET /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;function_score&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &#123;</span><br><span class="line">        &quot;multi_match&quot;: &#123;</span><br><span class="line">          &quot;query&quot;: &quot;search engine&quot;,</span><br><span class="line">          &quot;fields&quot;: [&quot;title&quot;,&quot;summary&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;functions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;script_score&quot;: &#123;</span><br><span class="line">            &quot;script&quot;: &#123;</span><br><span class="line">              &quot;params&quot;: &#123;</span><br><span class="line">                &quot;threshold&quot;: &quot;2015-07-30&quot;</span><br><span class="line">              &#125;,  </span><br><span class="line">              &quot;lang&quot;: &quot;groovy&quot;, </span><br><span class="line">              &quot;source&quot;: &quot;publish_date = doc[&#x27;publish_date&#x27;].value; num_reviews = doc[&#x27;num_reviews&#x27;].value; if (publish_date &gt; Date.parse(&#x27;yyyy-MM-dd&#x27;, threshold).getTime()) &#123; return log(2.5 + num_reviews) &#125;; return log(1 + num_reviews);&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;title&quot;,&quot;summary&quot;,&quot;publish_date&quot;, &quot;num_reviews&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注1</strong>：要使用动态脚本，必须为config &#x2F; elasticsearch.yml文件中的Elasticsearch实例启用它。 也可以使用已经存储在Elasticsearch服务器上的脚本。 查看 Elasticsearch reference docs 以获取更多信息。<br><strong>注2：</strong> JSON不能包含嵌入的换行符，因此分号用于分隔语句。<br>原文作者： by Tim Ojo Aug. 05, 16 · Big Data Zone<br>原文地址：<a target="_blank" rel="noopener" href="https://dzone.com/articles/23-useful-elasticsearch-example-queries">dzone.com&#x2F;articles&#x2F;23…</a></p>
</blockquote>
<blockquote>
<p>注意：ES6.3 怎样启用 groovy 脚本？配置未成功<br>script.allowed_types: inline &amp; script.allowed_contexts: search, update</p>
</blockquote>
<h3 id="Java-API-实现"><a href="#Java-API-实现" class="headerlink" title="Java API 实现"></a>Java API 实现</h3><p>Java API 实现上面的查询，代码见 <a target="_blank" rel="noopener" href="https://github.com/whirlys/elastic-example/tree/master/UsefullESSearchSkill">github.com&#x2F;whirlys&#x2F;ela…</a></p>
<blockquote>
<p>作者：铭毅天下</p>
<p>原文地址：<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/laoyang360/article/details/75094457">http://blog.csdn.net/laoyang360/article/details/75094457</a></p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-java8常用代码"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/26/java8%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/"
    >java8 常用代码</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/02/26/java8%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/" class="article-date">
  <time datetime="2020-02-26T09:49:28.000Z" itemprop="datePublished">2020-02-26</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="1-使用java8-提取出-list-中-bean-的某一属性"><a href="#1-使用java8-提取出-list-中-bean-的某一属性" class="headerlink" title="1. 使用java8 提取出 list 中 bean 的某一属性"></a>1. 使用java8 提取出 list 中 bean 的某一属性</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	List&lt;Student&gt; stuList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Student&gt;();</span><br><span class="line">	<span class="type">Student</span> <span class="variable">st1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;123&quot;</span>,<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">	<span class="type">Student</span> <span class="variable">st2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;234&quot;</span>,<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">	<span class="type">Student</span> <span class="variable">st3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;345&quot;</span>,<span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">	<span class="type">Student</span> <span class="variable">st4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;345&quot;</span>,<span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">	stuList.add(st1);</span><br><span class="line">	stuList.add(st2);</span><br><span class="line">	stuList.add(st3);</span><br><span class="line">	stuList.add(st4);</span><br><span class="line">	<span class="comment">//1.提取出list对象中的一个属性</span></span><br><span class="line">	List&lt;String&gt; stIdList1 = stuList.stream()</span><br><span class="line">			.map(Student::getId)</span><br><span class="line">			.collect(Collectors.toList());</span><br><span class="line">	stIdList1.forEach(s -&gt; System.out.print(s+<span class="string">&quot; &quot;</span>));</span><br><span class="line">	System.out.println();</span><br><span class="line">	System.out.println(<span class="string">&quot;----------&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2.提取出list对象中的一个属性并去重</span></span><br><span class="line">	List&lt;String&gt; stIdList2 = stuList.stream()</span><br><span class="line">			.map(Student::getId).distinct()</span><br><span class="line">			.collect(Collectors.toList());</span><br><span class="line">	stIdList2.forEach(s -&gt; System.out.print(s+<span class="string">&quot; &quot;</span>));</span><br><span class="line">	<span class="comment">/*	结果：</span></span><br><span class="line"><span class="comment">		123 234 345 345  </span></span><br><span class="line"><span class="comment">		----------</span></span><br><span class="line"><span class="comment">		123 234 345 </span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-使用-java8-提取出-list-中-bean-的两个属性转换为Map"><a href="#2-使用-java8-提取出-list-中-bean-的两个属性转换为Map" class="headerlink" title="2. 使用 java8 提取出 list 中 bean 的两个属性转换为Map"></a>2. 使用 java8 提取出 list 中 bean 的两个属性转换为Map</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;DictVO&gt; dictVOList = tSysDictService.findByDictType(<span class="string">&quot;dataset_catalog_icon&quot;</span>);</span><br><span class="line">Map&lt;String, String&gt; iconMap = dictVOList.stream()</span><br><span class="line">  .collect(Collectors.toMap(DictVO::getText, DictVO::getValue));</span><br></pre></td></tr></table></figure>

<h2 id="3-使用-java8-根据某个属性倒序排序"><a href="#3-使用-java8-根据某个属性倒序排序" class="headerlink" title="3. 使用 java8 根据某个属性倒序排序"></a>3. 使用 java8 根据某个属性倒序排序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list = list.stream().sorted(Comparator.comparing(PromotionForHomeDto::getCreateTime).reversed())</span><br><span class="line">                .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>



<h2 id="3-List-转-Set"><a href="#3-List-转-Set" class="headerlink" title="3. List 转 Set"></a>3. List<Student> 转 Set<Integer></h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LUA123/p/9367657.html">Java8 List&lt;对象&gt; 转 Set、Map（高级）、排序、分组、统计</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;----------------普通List---------------&quot;</span>);</span><br><span class="line">normalList.forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;----------------普通List转Set---------------&quot;</span>);</span><br><span class="line">Set&lt;Integer&gt; normalSet = normalList.stream().map(Student::getClassNo).collect(Collectors.toSet());</span><br><span class="line">normalSet.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">----------------普通List---------------</span><br><span class="line">Student&#123;id=<span class="number">1</span>, name=<span class="string">&#x27;Emma&#x27;</span>, score=<span class="string">&#x27;A&#x27;</span>, classNo=<span class="number">701</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">2</span>, name=<span class="string">&#x27;Larissa&#x27;</span>, score=<span class="string">&#x27;S&#x27;</span>, classNo=<span class="number">701</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">3</span>, name=<span class="string">&#x27;Sophia&#x27;</span>, score=<span class="string">&#x27;B&#x27;</span>, classNo=<span class="number">701</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">4</span>, name=<span class="string">&#x27;Ashley&#x27;</span>, score=<span class="string">&#x27;B&#x27;</span>, classNo=<span class="number">702</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">5</span>, name=<span class="string">&#x27;May&#x27;</span>, score=<span class="string">&#x27;C&#x27;</span>, classNo=<span class="number">702</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">6</span>, name=<span class="string">&#x27;Hailey&#x27;</span>, score=<span class="string">&#x27;D&#x27;</span>, classNo=<span class="number">702</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">7</span>, name=<span class="string">&#x27;Kelly&#x27;</span>, score=<span class="string">&#x27;S&#x27;</span>, classNo=<span class="number">703</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">8</span>, name=<span class="string">&#x27;Amy&#x27;</span>, score=<span class="string">&#x27;A&#x27;</span>, classNo=<span class="number">703</span>&#125;</span><br><span class="line">Student&#123;id=<span class="number">9</span>, name=<span class="string">&#x27;Wesley&#x27;</span>, score=<span class="string">&#x27;C&#x27;</span>, classNo=<span class="number">703</span>&#125;</span><br><span class="line">----------------普通List转Set---------------</span><br><span class="line"><span class="number">701</span></span><br><span class="line"><span class="number">702</span></span><br><span class="line"><span class="number">703</span></span><br></pre></td></tr></table></figure>

<h2 id="4-java8-中根据判断删除列表list中的元素"><a href="#4-java8-中根据判断删除列表list中的元素" class="headerlink" title="4. java8 中根据判断删除列表list中的元素"></a>4. java8 中根据判断删除列表list中的元素</h2><p>我们知道，在java8出lambda表达式之前，是不支持在循环中直接对list进行删除的。但是java8的新特性lambda表达式，帮我们实现了这个功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">lists.add(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">lists.add(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">lists.add(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用removeIf方法，-&gt;里的是判断条件，如果符合这个条件就删除。这里会删除带有c的元素</span></span><br><span class="line">lists.removeIf(s -&gt; s.contains(<span class="string">&quot;c&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>java8新特性大大的简化了我们的代码，使用更加的方便。</p>
<h2 id="5-java8-获取-lsit-中bean-的某一属性最大的对象"><a href="#5-java8-获取-lsit-中bean-的某一属性最大的对象" class="headerlink" title="5. java8 获取 lsit 中bean 的某一属性最大的对象"></a>5. java8 获取 lsit 中bean 的某一属性最大的对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> studentList.stream().max(Comparator.comparing(Student::getClassCount)).get();</span><br></pre></td></tr></table></figure>

<h2 id="6-java8-计算代码运行时间"><a href="#6-java8-计算代码运行时间" class="headerlink" title="6. java8 计算代码运行时间"></a>6. java8 计算代码运行时间</h2><p>java8之前是这样计算代码运行时间的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> startTime=System.currentTimeMillis();   <span class="comment">//获取开始时间  </span></span><br><span class="line">doSomeThing();  <span class="comment">//测试的代码段  </span></span><br><span class="line"><span class="type">long</span> endTime=System.currentTimeMillis(); <span class="comment">//获取结束时间  </span></span><br><span class="line">System.out.println(<span class="string">&quot;程序运行时间： &quot;</span>+(end-start)+<span class="string">&quot;ms&quot;</span>);   </span><br></pre></td></tr></table></figure>

<p>java8之后可以使用Instant获取时间戳来计算代码运行时间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">Instant</span> <span class="variable">start</span> <span class="operator">=</span> Instant.now();</span><br><span class="line">    </span><br><span class="line">      LongStream.rangeClosed( <span class="number">0</span>,<span class="number">110</span> )</span><br><span class="line">      <span class="comment">//并行流</span></span><br><span class="line">      .parallel()</span><br><span class="line">      .reduce( <span class="number">0</span>,Long::sum );</span><br><span class="line"></span><br><span class="line">      LongStream.rangeClosed( <span class="number">0</span>,<span class="number">110</span> )</span><br><span class="line">      <span class="comment">//顺序流</span></span><br><span class="line">      .sequential()</span><br><span class="line">      .reduce( <span class="number">0</span>,Long::sum );</span><br><span class="line"></span><br><span class="line">      <span class="type">Instant</span> <span class="variable">end</span> <span class="operator">=</span> Instant.now();</span><br><span class="line">      System.out.println(<span class="string">&quot;耗费时间&quot;</span>+ Duration.between( start,end ).toMillis());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8E%9F%E5%88%9B/" rel="tag">原创</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Redis-数据类型及应用场景"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/24/Redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/"
    >Redis 数据类型及应用场景</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/02/24/Redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" class="article-date">
  <time datetime="2020-02-24T11:53:22.000Z" itemprop="datePublished">2020-02-24</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>原文地址：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000012212663">https://segmentfault.com/a/1190000012212663</a></p>
<p>作者：<a target="_blank" rel="noopener" href="https://segmentfault.com/u/waterandair">waterandair</a></p>
</blockquote>
<h3 id="一、-redis-特点"><a href="#一、-redis-特点" class="headerlink" title="一、 redis 特点"></a>一、 redis 特点</h3><ul>
<li>所有数据存储在内存中，高速读写</li>
<li>提供丰富多样的数据类型：string、 hash、 set、 sorted set、bitmap、hyperloglog</li>
<li>提供了 AOF 和 RDB 两种数据的持久化保存方式，保证了 Redis 重启后数据不丢失</li>
<li>Redis 的所有操作都是原子性的，还支持对几个操作合并后的原子性操作，支持事务</li>
</ul>
<p>　通常我们都把数据存到关系型数据库中，但为了提升应用的性能，我们应该把访频率高且不会经常变动的数据缓存到内存中。。Redis 没有像 MySQL 这类关系型数据库那样强大的查询功能，需要考虑如何把关系型数据库中的数据，合理的对应到缓存的 key-value 数据结构中。</p>
<h3 id="二、-设计-Redis-Key"><a href="#二、-设计-Redis-Key" class="headerlink" title="二、 设计 Redis Key"></a>二、 设计 Redis Key</h3><h4 id="分段设计法"><a href="#分段设计法" class="headerlink" title="分段设计法"></a>分段设计法</h4><p>　　使用冒号把 key 中要表达的多种含义分开表示，步骤如下：</p>
<ol>
<li>把表名转化为 key 前缀</li>
<li>主键名（或其他常用于搜索的字段）</li>
<li>主键值</li>
<li>要存储的字段。</li>
</ol>
<p>eg. 用户表（user）</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>email</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>zj</td>
<td><a href="mailto:&#49;&#x35;&#54;&#x35;&#x37;&#55;&#56;&#x31;&#x32;&#x40;&#113;&#113;&#46;&#99;&#x6f;&#109;">&#49;&#x35;&#54;&#x35;&#x37;&#55;&#56;&#x31;&#x32;&#x40;&#113;&#113;&#46;&#99;&#x6f;&#109;</a></td>
</tr>
<tr>
<td>2</td>
<td>ai</td>
<td><a href="mailto:&#49;&#x35;&#x36;&#x35;&#x37;&#x37;&#56;&#49;&#x33;&#64;&#x71;&#x71;&#46;&#x63;&#111;&#109;">&#49;&#x35;&#x36;&#x35;&#x37;&#x37;&#56;&#49;&#x33;&#64;&#x71;&#x71;&#46;&#x63;&#111;&#109;</a></td>
</tr>
</tbody></table>
<p>这个简单的表可能经常会有这个的需求：&gt;根据用户 id 查询用户邮箱地址，可以选择把邮箱地址这个数据存到 redis 中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set user:id:1:email 156577812@qq.com;</span><br><span class="line">set user:id:2:email 156577812@qq.com;</span><br></pre></td></tr></table></figure>

<h3 id="三、-String数据类型的应用场景"><a href="#三、-String数据类型的应用场景" class="headerlink" title="三、 String数据类型的应用场景"></a>三、 String数据类型的应用场景</h3><h4 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h4><p>　　string 类型是 Redis 中最基本的数据类型，最常用的数据类型，甚至被很多玩家当成 redis 唯一的数据类型去使用。string 类型在 redis 中是二进制安全(binary safe)的,这意味着 string 值关心二进制的字符串，不关心具体格式，你可以用它存储 json 格式或 JPEG 图片格式的字符串。
　　</p>
<h4 id="2-数据模型"><a href="#2-数据模型" class="headerlink" title="2. 数据模型"></a>2. 数据模型</h4><p>　　string 类型是基本的 Key-Value 结构，Key 是某个数据在 Redis 中的唯一标识，Value 是具体的数据。</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>‘name’</td>
<td>‘redis’</td>
</tr>
<tr>
<td>‘type’</td>
<td>‘string’</td>
</tr>
</tbody></table>
<h4 id="3-应用场景"><a href="#3-应用场景" class="headerlink" title="3. 应用场景"></a>3. 应用场景</h4><h5 id="1-存储-MySQL-中某个字段的值"><a href="#1-存储-MySQL-中某个字段的值" class="headerlink" title="(1) 存储 MySQL 中某个字段的值"></a>(1) 存储 MySQL 中某个字段的值</h5><p>把 key 设计为 表名：主键名：主键值：字段名<br>eg.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set user:id:1:email 156577812@qq.com</span><br></pre></td></tr></table></figure>

<h5 id="2-存储对象"><a href="#2-存储对象" class="headerlink" title="(2) 存储对象"></a>(2) 存储对象</h5><p>string 类型支持任何格式的字符串，应用最多的就是存储 json 或其他对象格式化的字符串。(这种场景下推荐使用 hash 数据类型)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set user:id:1 &#x27;[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;zj&quot;,&quot;email&quot;:&quot;156577812@qq.com&quot;&#125;,&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;zj&quot;,&quot;email&quot;:&quot;156577812@qq.com&quot;&#125;]&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="3-生成自增-id"><a href="#3-生成自增-id" class="headerlink" title="(3) 生成自增 id"></a>(3) 生成自增 id</h5><p>当 redis 的 string 类型的值为整数形式时，redis 可以把它当做是整数一样进行自增（incr）自减（decr）操作。由于 redis 所有的操作都是原子性的，所以<code>不必担心多客户端连接时可能出现的事务</code>问题。</p>
<h3 id="四、hash-数据类型的应用场景"><a href="#四、hash-数据类型的应用场景" class="headerlink" title="四、hash 数据类型的应用场景"></a>四、hash 数据类型的应用场景</h3><h4 id="1-简介-1"><a href="#1-简介-1" class="headerlink" title="1. 简介"></a>1. 简介</h4><p>　　hash 类型很像一个关系型数据库的数据表，hash 的 Key 是一个唯一值，Value 部分是一个 hashmap 的结构。
　　</p>
<h4 id="2-数据模型-1"><a href="#2-数据模型-1" class="headerlink" title="2. 数据模型"></a>2. 数据模型</h4><p>　　假设有一张数据库表如下：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>type</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>redis</td>
<td>hash</td>
</tr>
</tbody></table>
<p>　　如果要用 redis 的 hash 结构存储，数据模型如下：</p>
<p><img src="https://segmentfault.com/img/bVVQ6K?w=403&h=191" alt="clipboard.png"></p>
<p>　　hash数据类型在存储上述类型的数据时具有比 string 类型更灵活、更快的优势，具体的说，使用 string 类型存储，必然需要转换和解析 json 格式的字符串，即便不需要转换，在内存开销方面，还是 hash 占优势。
　　</p>
<h4 id="3-应用场景-1"><a href="#3-应用场景-1" class="headerlink" title="3. 应用场景"></a>3. 应用场景</h4><p>hash 类型十分适合存储对象类数据，相对于在 string 中介绍的把对象转化为 json 字符串存储，hash 的结构可以任意添加或删除‘字段名’，更加高效灵活。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hmset user:1 name zj email 156577812@qq.com</span><br></pre></td></tr></table></figure>

<h3 id="五、list-数据类型的应用场景"><a href="#五、list-数据类型的应用场景" class="headerlink" title="五、list 数据类型的应用场景"></a>五、list 数据类型的应用场景</h3><h4 id="1-简介-2"><a href="#1-简介-2" class="headerlink" title="1. 简介"></a>1. 简介</h4><p>　　list 是按照插入顺序排序的字符串链表，可以在头部和尾部插入新的元素（双向链表实现，两端添加元素的时间复杂度为 O(1)）。插入元素时，如果 key 不存在，redis 会为该 key 创建一个新的链表，如果链表中所有的元素都被移除，该 key 也会从 redis 中移除。</p>
<h4 id="2-数据模型-2"><a href="#2-数据模型-2" class="headerlink" title="2. 数据模型"></a>2. 数据模型</h4><p><img src="https://segmentfault.com/img/bVVRaU?w=483&h=159" alt="clipboard.png"></p>
<p>　　常见操作时用 lpush 命令在 list 头部插入元素， 用 rpop 命令在 list 尾取出数据。
　　</p>
<h4 id="3-应用场景-2"><a href="#3-应用场景-2" class="headerlink" title="3. 应用场景"></a>3. 应用场景</h4><h5 id="1-消息队列"><a href="#1-消息队列" class="headerlink" title="(1) 消息队列"></a>(1) 消息队列</h5><p>　　redis 的 list 数据类型对于大部分使用者来说，是实现队列服务的最经济，最简单的方式。
　　</p>
<h5 id="2-“最新内容”"><a href="#2-“最新内容”" class="headerlink" title="(2) “最新内容”"></a>(2) “最新内容”</h5><p>因为 list 结构的数据查询两端附近的数据性能非常好，所以适合一些需要获取最新数据的场景，比如新闻类应用的 “最近新闻”。
　　</p>
<h4 id="4-优化建议"><a href="#4-优化建议" class="headerlink" title="4.优化建议"></a>4.优化建议</h4><h5 id="1-list-是链表结构，所有如果在头部和尾部插入数据，性能会非常高，不受链表长度的影响；但如果在链表中插入数据，性能就会越来越差。"><a href="#1-list-是链表结构，所有如果在头部和尾部插入数据，性能会非常高，不受链表长度的影响；但如果在链表中插入数据，性能就会越来越差。" class="headerlink" title="(1) list 是链表结构，所有如果在头部和尾部插入数据，性能会非常高，不受链表长度的影响；但如果在链表中插入数据，性能就会越来越差。"></a>(1) list 是链表结构，所有如果在头部和尾部插入数据，性能会非常高，不受链表长度的影响；但如果在链表中插入数据，性能就会越来越差。</h5><h3 id="六、set-数据类型的应用场景"><a href="#六、set-数据类型的应用场景" class="headerlink" title="六、set 数据类型的应用场景"></a>六、set 数据类型的应用场景</h3><h4 id="1-简介-3"><a href="#1-简介-3" class="headerlink" title="1. 简介"></a>1. 简介</h4><p>　　set 数据类型是一个集合（没有排序，不重复），可以对 set 类型的数据进行添加、删除、判断是否存在等操作（时间复杂度是 O(1) ）<br>　　set 集合不允许数据重复，如果添加的数据在 set 中已经存在，将只保留一份。<br>　　set 类型提供了多个 set 之间的聚合运算，如求交集、并集、补集，这些操作在 redis 内部完成，效率很高。</p>
<h4 id="2-数据模型-3"><a href="#2-数据模型-3" class="headerlink" title="2. 数据模型"></a>2. 数据模型</h4><p><img src="https://segmentfault.com/img/bVVRdw?w=385&h=274" alt="clipboard.png"></p>
<h4 id="3-应用场景-3"><a href="#3-应用场景-3" class="headerlink" title="3. 应用场景"></a>3. 应用场景</h4><p>　　set 类型的特点是——不重复且无序的一组数据，并且具有丰富的计算功能，在一些特定的场景中可以高效的解决一般关系型数据库不方便做的工作。</p>
<h5 id="1-“共同好友列表”"><a href="#1-“共同好友列表”" class="headerlink" title="1. “共同好友列表”"></a>1. “共同好友列表”</h5><p>　　社交类应用中，获取两个人或多个人的共同好友，两个人或多个人共同关注的微博这样类似的功能，用 MySQL 的话操作很复杂，可以把每个人的好友 id 存到集合中，获取共同好友的操作就可以简单到一个取交集的命令就搞定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// 这里为了方便阅读，把 id 替换成姓名</span><br><span class="line">sadd user:wade james melo paul kobe</span><br><span class="line">sadd user:james wade melo paul kobe</span><br><span class="line">sadd user:paul wade james melo kobe</span><br><span class="line">sadd user:melo wade james paul kobe</span><br><span class="line"></span><br><span class="line">// 获取 wade 和 james 的共同好友</span><br><span class="line">sinter user:wade user:james</span><br><span class="line">/* 输出：</span><br><span class="line"> *      1) &quot;kobe&quot;</span><br><span class="line"> *      2) &quot;paul&quot;</span><br><span class="line"> *      3) &quot;melo&quot;</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line"> // 获取香蕉四兄弟的共同好友</span><br><span class="line"> sinter user:wade user:james user:paul user:melo</span><br><span class="line"> /* 输出：</span><br><span class="line"> *      1) &quot;kobe&quot;</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line"> /*</span><br><span class="line">     类似的需求还有很多 , 必须把每个标签下的文章 id 存到集合中，可以很容易的求出几个不同标签下的共同文章；</span><br><span class="line"> 把每个人的爱好存到集合中，可以很容易的求出几个人的共同爱好。 </span><br><span class="line"> */</span><br></pre></td></tr></table></figure>

<h3 id="七、sorted-set-数据类型的应用场景"><a href="#七、sorted-set-数据类型的应用场景" class="headerlink" title="七、sorted set 数据类型的应用场景"></a>七、sorted set 数据类型的应用场景</h3><h4 id="1-简介-4"><a href="#1-简介-4" class="headerlink" title="1.简介"></a>1.简介</h4><p>　　在 set 的基础上给集合中每个元素关联了一个分数，往有序集合中插入数据时会自动根据这个分数排序。</p>
<h4 id="2-应用场景"><a href="#2-应用场景" class="headerlink" title="2.应用场景"></a>2.应用场景</h4><p>　　在集合类型的场景上加入排序就是有序集合的应用场景了。比如根据好友的“亲密度”排序显示好友列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 用元素的分数（score）表示与好友的亲密度</span><br><span class="line">zadd user:kobe 80 james 90 wade  85 melo  90 paul</span><br><span class="line"></span><br><span class="line">// 根据“亲密度”给好友排序</span><br><span class="line">zrevrange user:kobe 0 -1</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 输出：</span><br><span class="line"> *      1) &quot;wade&quot;</span><br><span class="line"> *      2) &quot;paul&quot;</span><br><span class="line"> *      3) &quot;melo&quot;</span><br><span class="line"> *      4) &quot;james&quot;</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line">// 增加好友的亲密度</span><br><span class="line">zincrby user:kobe 15 james</span><br><span class="line"></span><br><span class="line">// 再次根据“亲密度”给好友排序</span><br><span class="line">zrevrange user:kobe 0 -1</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 输出：</span><br><span class="line"> *      1) &quot;james&quot;</span><br><span class="line"> *      2) &quot;wade&quot;</span><br><span class="line"> *      3) &quot;paul&quot;</span><br><span class="line"> *      2) &quot;melo&quot;</span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-JSON-Web-Token-入门教程"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/22/JSON-Web-Token-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"
    >JSON Web Token 入门教程</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/02/22/JSON-Web-Token-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="article-date">
  <time datetime="2020-02-22T05:19:40.000Z" itemprop="datePublished">2020-02-22</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>作者：阮一峰<br>原文链接：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html</a></p>
</blockquote>
<p>JSON Web Token（缩写 JWT）是目前最流行的跨域认证解决方案，本文介绍它的原理和用法。</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018072301.jpg"></p>
<h2 id="一、跨域认证的问题"><a href="#一、跨域认证的问题" class="headerlink" title="一、跨域认证的问题"></a>一、跨域认证的问题</h2><p>互联网服务离不开用户认证。一般流程是下面这样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、用户向服务器发送用户名和密码</span><br><span class="line">2、服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</span><br><span class="line">3、服务器向用户返回一个 session_id，写入用户 Cookie。</span><br><span class="line">4、用户随后的每一次请求，都会通过 Cookie,将 session_id 传回服务器。</span><br><span class="line">5、服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</span><br></pre></td></tr></table></figure>

<p>这种模式的问题在于，扩展性（scaling）不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。</p>
<p>举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现？</p>
<p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。</p>
<p>另一种方案是服务器索性不保存 session 数据了，所有数据都保存在客户端，每次请求都发回服务器。JWT 就是这种方案的一个代表。</p>
<h2 id="二、JWT-的原理"><a href="#二、JWT-的原理" class="headerlink" title="二、JWT 的原理"></a>二、JWT 的原理</h2><p>JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;姓名&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;角色&quot;</span><span class="punctuation">:</span> <span class="string">&quot;管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;到期时间&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2018年7月1日0点0分&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>以后，用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。为了防止用户篡改数据，服务器在生成这个对象的时候，会加上签名（详见后文）。</p>
<p>服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。</p>
<h2 id="三、JWT-的数据结构"><a href="#三、JWT-的数据结构" class="headerlink" title="三、JWT 的数据结构"></a>三、JWT 的数据结构</h2><p>实际的 JWT 大概就像下面这样。</p>
<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018072304.jpg"></p>
<p>它是一个很长的字符串，中间用点（<code>.</code>）分隔成三个部分。注意，JWT 内部是没有换行的，这里只是为了便于展示，将它写成了几行。</p>
<p>JWT 的三个部分依次如下。</p>
<blockquote>
<ul>
<li>Header（头部）</li>
<li>Payload（负载）</li>
<li>Signature（签名）</li>
</ul>
</blockquote>
<p>写成一行，就是下面的样子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.Signature</span><br></pre></td></tr></table></figure>

<p>一个 JWT 生成的 Token 格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token = encodeBase64(header) + &#x27;.&#x27; + encodeBase64(payload) + &#x27;.&#x27; + encodeBase64(signature)</span><br></pre></td></tr></table></figure>



<p><img src="https://www.wangbase.com/blogimg/asset/201807/bg2018072303.jpg"></p>
<p>下面依次介绍这三个部分。</p>
<h3 id="3-1-Header"><a href="#3-1-Header" class="headerlink" title="3.1 Header"></a>3.1 Header</h3><p>Header 部分是一个 JSON 对象，描述 JWT 的元数据，通常是下面的样子。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>上面代码中，<code>alg</code>属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；<code>typ</code>属性表示这个令牌（token）的类型（type），JWT 令牌统一写为<code>JWT</code>。</p>
<p>最后，将上面的 JSON 对象使用 Base64URL 算法（详见后文）转成字符串。</p>
<h3 id="3-2-Payload"><a href="#3-2-Payload" class="headerlink" title="3.2 Payload"></a>3.2 Payload</h3><p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了7个官方字段，供选用。</p>
<blockquote>
<ul>
<li>iss (issuer)：签发人</li>
<li>exp (expiration time)：过期时间</li>
<li>sub (subject)：主题</li>
<li>aud (audience)：受众</li>
<li>nbf (Not Before)：生效时间</li>
<li>iat (Issued At)：签发时间</li>
<li>jti (JWT ID)：编号</li>
</ul>
</blockquote>
<p>除了官方字段，你还可以在这个部分定义私有字段，下面就是一个例子。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>注意，JWT 默认是不加密的，任何人都可以读到，所以不要把秘密信息放在这个部分。</p>
<p>这个 JSON 对象也要使用 Base64URL 算法转成字符串。</p>
<h3 id="3-3-Signature"><a href="#3-3-Signature" class="headerlink" title="3.3 Signature"></a>3.3 Signature</h3><p>Signature 部分是对前两部分的签名，防止数据篡改。</p>
<p>首先，需要指定一个密钥（secret）。这个密钥只有服务器才知道，不能泄露给用户。然后，使用 Header 里面指定的签名算法（默认是 HMAC SHA256），按照下面的公式产生签名。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload)<span class="punctuation">,</span></span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure>

<p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用”点”（<code>.</code>）分隔，就可以返回给用户。</p>
<h3 id="3-4-Base64URL"><a href="#3-4-Base64URL" class="headerlink" title="3.4 Base64URL"></a>3.4 Base64URL</h3><p>前面提到，Header 和 Payload 串型化的算法是 Base64URL。这个算法跟 Base64 算法基本类似，但有一些小的不同。</p>
<p>JWT 作为一个令牌（token），有些场合可能会放到 URL（比如 api.example.com&#x2F;?token&#x3D;xxx）。Base64 有三个字符<code>+</code>、<code>/</code>和<code>=</code>，在 URL 里面有特殊含义，所以要被替换掉：<code>=</code>被省略、<code>+</code>替换成<code>-</code>，<code>/</code>替换成<code>_</code> 。这就是 Base64URL 算法。</p>
<h2 id="四、JWT-的使用方式"><a href="#四、JWT-的使用方式" class="headerlink" title="四、JWT 的使用方式"></a>四、JWT 的使用方式</h2><p>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。</p>
<p>此后，客户端每次与服务器通信，都要带上这个 JWT。你可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以更好的做法是放在 HTTP 请求的头信息<code>Authorization</code>字段里面。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Authorization</span>: <span class="title class_">Bearer</span> &lt;token&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>另一种做法是，跨域的时候，JWT 就放在 POST 请求的数据体里面。</p>
<h2 id="五、JWT-的几个特点"><a href="#五、JWT-的几个特点" class="headerlink" title="五、JWT 的几个特点"></a>五、JWT 的几个特点</h2><p>（1）JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。</p>
<p>（2）JWT 不加密的情况下，不能将秘密数据写入 JWT。</p>
<p>（3）JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。</p>
<p>（4）JWT 的最大缺点是，由于服务器不保存 session 状态，因此无法在使用过程中废止某个 token，或者更改 token 的权限。也就是说，一旦 JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑。</p>
<p>（5）JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</p>
<p>（6）为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。</p>
<h2 id="六、参考链接"><a href="#六、参考链接" class="headerlink" title="六、参考链接"></a>六、参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://jwt.io/introduction/">Introduction to JSON Web Tokens</a>， by Auth0</li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@bryanmanuele/sessionless-authentication-withe-jwts-with-node-express-passport-js-69b059e4b22c">Sessionless Authentication using JWTs (with Node + Express + Passport JS)</a>, by Bryan Manuele</li>
<li><a target="_blank" rel="noopener" href="https://github.com/dwyl/learn-json-web-tokens/blob/master/README.md">Learn how to use JSON Web Tokens</a>, by dwyl</li>
</ul>
<p>（完）</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-别让自己“墙”了自己"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/17/%E5%88%AB%E8%AE%A9%E8%87%AA%E5%B7%B1%E2%80%9C%E5%A2%99%E2%80%9D%E4%BA%86%E8%87%AA%E5%B7%B1/"
    >别让自己“墙”了自己</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/02/17/%E5%88%AB%E8%AE%A9%E8%87%AA%E5%B7%B1%E2%80%9C%E5%A2%99%E2%80%9D%E4%BA%86%E8%87%AA%E5%B7%B1/" class="article-date">
  <time datetime="2020-02-17T14:08:02.000Z" itemprop="datePublished">2020-02-17</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>转载自：陈皓<br>链接：<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/20276.html">https://coolshell.cn/articles/20276.html</a></p>
</blockquote>
<blockquote>
<p>小结：</p>
<p>别把自己最宝贵的青春放在了很烂的项目上，就算能用一些新的技术，也只能算是自娱自乐，在实验室中玩玩具罢了。</p>
<p>野、环境和舞台，对一个人的限制是非常大的。</p>
<p>偏见和不开放，对一个人的限制是真正有毁灭性的。</p>
<p>不限制自己，别把自己封闭起来，“艺多不压身”，有什么就学什么，有更高的就去向更高的迈进</p>
<p>尽最大可能出去经历一下世界最顶尖的公司</p>
<p>别限制了自己</p>
<ul>
<li>做有价值的事</li>
<li>扩大自己的眼界，开放自己的内心。你的英文语言能力对你能不能融入世界是起决定性的作用。你的视野决定了你的知不知道要去哪，你的开放决定了你想不想去。</li>
<li>站在更高的维度。</li>
<li>精于计算得失。精于计算得失的，就懂得什么是投资，不懂的只会投机。对于赚钱，你可以投机，但是对于自己最好还是投资。</li>
<li>勇于跳出传统的束缚</li>
</ul>
</blockquote>
<p>这一两周与几个朋友聊天，有年轻的90后，也有大叔级的70后，这些人在我看来都是很有能力的人，但是一些喜好过于强烈，让我不经意地回顾了我工作20年来身边的人，有发展得好的，也有发展的不好的，有些人是很可惜的，因为限制他们的不是其它人，也不是环境，而是自己，所以，很想写下这篇文章。（注：这篇文章可能会是一篇说教的文章，所以，可能会让你看着犯困，所以，我会尽量地短一些，而且尽可能多讲故事，少道理，这里的故事，全是真实发生的）</p>
<h2 id="几个故事"><a href="#几个故事" class="headerlink" title="几个故事"></a>几个故事</h2><p>2019年年初，我面试了一个很年轻的小伙子（93&#x2F;94年出生），这个小伙子特别有灵性，也很聪明，计算机专业出身，也很喜欢技术，基础和学习能力也很好。在我这20年来认识的人中，如果他能呆在北京、上海、深圳这样的城市，我保证不出三年，他会成为他们同龄人中非常出色的技术人员，如果有个好的舞台有一个好的团队带他，他的未来会非常成功。然而，这个小伙子有两大喜好：1）只愿（或是说被迫）呆在一个毫无IT的环境的三&#x2F;四线城市，2）对技术有非常大的偏好，只喜欢Go语言，非常不喜欢其它的语言，比如：Java（离开Java的世界，基本上离开了做架构的世界（<strong>相关解释见文末</strong>））。</p>
<p>他的这两个喜好，足以让一个未来会很优秀的人毁掉，因为，这个时代没有限制他，他的能力也没有限制他，但是他的意识完完全全地限制了他。</p>
<ul>
<li>他把自己最宝贵的青春放在了很烂的项目上，就算能用一些新的技术，他也只能算是自娱自乐，在实验室中玩玩具罢了。</li>
<li>他把自己的技术栈封闭起来，而直接放弃了这个时代最具工业化的技术Java，对于一个好的程序员来说，同时掌握几门语言和技术完全是没什么问题，但是自己封闭了自己的视野。</li>
</ul>
<p>实在是非常可惜，我本来是可以为他介绍到一些很不错的公司的，但是他这样的习性，等于自己把自己未来的门给关上了，虽然我跟他长谈过，但是我也没有办法叫醒不想醒的人……</p>
<ul>
<li>视野、环境和舞台，对一个人的限制是非常大的。井蛙不知道大海，被空间维度所限制；夏虫不知道冬天，是被时间维度所限制；圈养的动物没有斗志，是被自己意识所限制。</li>
<li>偏见和不开放，对一个人的限制是真正有毁灭性的。主动让自己成为一个瞎子和聋子，主动把自己的能力阉割掉，这是一件令人痛心的事。想想大清的闭关锁国是如何让亚洲第一的北洋水师给毁掉的……</li>
</ul>
<p>我还有个同学，他的技术并不差，就算呆在昆明这种很落后的地方，他也非常地好学，学习英文，学习各种新技术，对技术没有任何的偏好，喜欢C&#x2F;C++&#x2F;Java&#x2F;Python&#x2F;Shell，同样喜欢前端Javascript，对基础知识非常地踏实，他在技术上没有限制自己的潜力，有什么就学什么。后来，我带他玩Docker&#x2F;Go&#x2F;K8S……分布式架构，他也上手的很快……像他这样的人，技术能力完全没得说，比我还大一岁，44岁了，还是一样的天天追代码细节，看Youtube的各种大会，翻github里的各种issue和pull request……</p>
<p>我同学这人，拥有了成为一个技术牛人几乎所有的条件：基础知识过硬，细节扎得深，面很广，学习能力强，有英文能力，逻辑思维能力不错，非常的自律，执行力也很强，抓得住重点……然而，只有一个小问题，就是没有到大公司历练过，我三番五次叫他从昆明出来，但是最终他都呆在昆明这个城市没有出来，因为有所谓的家庭约束。然而，我身边还有好些人，把自己家从北京搬到上海，从上海搬到深圳，从厦门搬到深圳……这样的人大有人在……像他这样的能力，在哪个公司都会是主力和骨干，对于一个公司的主力和骨干来说，家庭上的这些问题都是小问题都是有很多解的……</p>
<p>另外，我这个同学还是一个比较悲观的人，任何事情都是先想到不好的事，他关注负面的东西会胜于正面的东西，而且他还有一定的社交恐惧，怕与人相处和交流，时间越长越害怕，甚至有时候直接跟我说，“我就是不想改变”这样的话……其实，我以前也是一个很害怕与人交流的人，面试的时候，我根本不敢正眼看面试官一眼，也不知道与人怎么交流。但是，我与他不一样，我努力克服，不断地面试，与人面对面的交流，到一线技术客服接用户的电话，在公司里做分享，慢慢地到外面分享……3-5年就完全克服掉了。</p>
<p>其实，很多事情，完全是有解的，也没有必要担心，自己的心理障碍也是可以克服的，重点就是自己愿不愿意，只要愿意完成了一半，接下来就是不断的摸爬滚打坚持了。</p>
<ul>
<li>不限制自己的人，会穷举各种方法来解决问题，限制自己的人，只会找各式各样的问题或借口。</li>
<li>不限制自己的人，会努力改变自己的问题和缺陷，限制自己的人，会放任自己。</li>
</ul>
<h2 id="另外几个故事"><a href="#另外几个故事" class="headerlink" title="另外几个故事"></a>另外几个故事</h2><p>我还有另外几个故事（活到四十多，能看到好多人十几年的发展过程，感觉有点上帝视角了）</p>
<p>我还有一个以前团队里的一个小伙，人是很聪明，但就完全就是野路子，他对技术没有什么偏好，一个PHP程序员，做那个Discuz!论坛，公司被并购了，转成Java，开始研究Java的各种细节，对技术从来没有什么偏见，有什么就玩什么，每做一个项目，就算是一样的他都要用新的技术做一遍，然后跟着我做云计算，我教他TCP，教他C&#x2F;C++，后来一起玩Docker&#x2F;Go，等等，反正是一点就通，他是我见过学习能力最强的人。但是，有一个事他一直与我的想法不一样，就是我希望他先把软件设计好，再写代码，他非常不能理解，他习惯于直接动手开干，然后有什么问题就整什么问题，我也很难教育他。</p>
<p>有一天，他电话面了一下Facebook，电话面了15分钟后对方就放弃了，他受到了严重的打击。然后，他就开始找菲利宾人练英文口语了，我也让他做算法题，然后，他才发现，一道连算法都不是的纯编程题都提交几次都过不了，等他做完了Leetcode最初的那151道题后，整个人都改变了，写代码前认认真真地在纸上把程序的状态，处理时序以及可能遇到的一些条件先罗列出来，然后，进行逻辑设计后，再写，从此，他就开启他更大的天地了。我后来把他推荐给了微软，先在中国的Bing，在中国升好2-3级，然后去了美国的Azure，现在听说他准备要跟 k8s 的 co-founder <a target="_blank" rel="noopener" href="https://github.com/brendandburns">Brendan Burns</a> 混了（虽然，他现在还在印度人手下，但是，我真的不知道他未来能玩多大，因为今年他才33岁，而且非常聪明）</p>
<p>他以前是把自己封闭起来的，我叫他出来，他也不出来，后来因为一些办公室政治的原因不得不来找我，于是我就带着他玩了两年，跟他讲了很多外面的世界是怎么玩的，他这个人也是一个相当不善于社交的人，但是心是开放的，愿意接受新的东西，虽然对技术也有一定偏见，比如不喜欢Windows，但是也不会不喜欢到完全封闭。后来我跟他说，微软的技术相当的强的，你看到的技术只是表面，深层次的东西都是相通的，直到他到了微软后发现各种牛逼的东西，对微软系统的技术的态度也有了改变，而且我让他跟我说很多微软那边的事，我发现，他对技术了解的维度已经是越来越高级的了……</p>
<p>还是我以前团队的一个小伙，他是一个前端，他说前端的东西没什么意思，想来找我做后端，我也一点点带他……后来，我说，你如果想要玩得好，你必需来北京，无论现在你觉得过得有多好，你都要放弃掉，然后，尽最大可能出去经历一下世界最顶尖的公司，我甚至跟他说，如果他女朋友不跟来的话，就先分开一段时间，先自己立业，他来北京的时候，他之前的同事都等着看他的笑话，我说，那些人连想都不敢想，不必管他们。于是，他去了Amazon，再过了一年去了西雅图，我跟他说，接下来就是去AWS，然后，如果有足够的野心，用自己的年轻这个资本去硅谷创业公司赌一把……未来他怎么样我不知道，但至少他没有限制自己，他的未来不会有封顶……</p>
<p>也是我的同学，我跟他在大学是上下铺，后来他去了人民大学读计算机博士，大学的时候做国产数据库kingbase，然后去了一家外企，天天被派到用户那边做数据分析，后来，他想回科研单位做国产数据库，我说，别啊，你的技术比我好太多，还有博士理论加持，你不去国外顶尖公司玩玩，你不知道自己有多强的，于是他跟公司申请去了国外做核心，后来因为Hadoop的原因，公司的产品最终成为了历史，于是我说，你来了美国么，你一定要去AWS，于是他就去了AWS的Aurora团队，成为了AWS明星级产品的中坚力量，天天在改MySQL的核心源码，干了两年，正在晋升 Principal Software Engineer ……</p>
<p>这里我到不是说出国有多牛，也许你只关注能挣多少钱，但是我想说，他们之所以能有这样的际遇，除了他们本来就有实力，还更因为他们从来不给自己设制什么限制，就是那种“艺多不压身”，有什么就学什么，有更高的就去向更高的迈进，其它的像家庭什么的问题其实都是会有解的，真的不必担心太多……</p>
<h2 id="别限制了自己"><a href="#别限制了自己" class="headerlink" title="别限制了自己"></a>别限制了自己</h2><p>上面的这些故事，也许你能看得懂，也许你看得不一定能懂，这里，让我来做个总结吧</p>
<ul>
<li><strong>做有价值的事</strong>。这个世界对计算机人才的要求是供不应求的，所以，不要让自己为自己找各式各样的借口，让自己活在“玩玩具”、“搬砖”和“使蛮力加班”的境地。其实，我发现这世界上有能力的人并不少，但是有品味的人的确很少。<strong>所谓的有价值，就是，别人愿付高价的，高技术门槛的，有创造力的，有颠覆性的</strong>……</li>
<li><strong>扩大自己的眼界，开放自己的内心</strong>。人要变得开放，千万不要做一个狭隘的民族主义者，做一个开放的人，把目光放在全人类这个维度，不断地把自己融入到世界上，而不是把自己封闭起来，这里，<strong>你的英文语言能力对你能不能融入世界是起决定性的作用</strong>。开放自己的心态，正视自己的缺点，你才可能往前迈进。<strong>你的视野决定了你的知不知道要去哪，你的开放决定了你想不想去</strong>。</li>
<li><strong>站在更高的维度</strong>。面的维度会超过点的维点，空间的维度会超过面的维度，在更高维度上思考和学习，你会获得更多。<strong>整天在焦虑那些低维度的事（比如自己的薪水、工作的地点、稳不稳定、有没有户口……），只会让你变得越来越平庸，只要你站在更高的维度（比如： 眼界有没有扩大、可能性是不是更多、竞争力是不是更强、能不能解决更大更难的问题、能创造多大的价值……），时间会让你明白那些低维度的东西全都不是事儿</strong>。技术学习上也一样，站在学习编程语法特性的维度和站在学习编程范式、设计模式的维度是两种完全不一样的学习方式。</li>
<li><strong>精于计算得失</strong>。很多人其实不是很懂计算。绝大多数人都是在算计自己会失去多少，而不会算会得到多少。而一般的人也总是在算短期内会失去什么，优秀则总是会算我投入后未来会有什么样的回报，前者在算计今天，目光短浅，而后者则是舍在今天，得在明天，计算的是未来。<strong>精于计算得失的，就懂得什么是投资，不懂的只会投机。对于赚钱，你可以投机，但是对于自己最好还是投资。</strong></li>
<li><strong>勇于跳出传统的束缚</strong>。有时候，跳出传统并不是一件很容易的事，因为大多数人都会对未知有恐惧的心理。比如：我看到很多人才都被大公司垄断了，其实，有能力的人都不需要加入大公司，有能力的人是少数，这些少数的人应该是所有的公司share着用的，这样一来，对于所有的人都是利益最大化的。这样的事现在也有，比如：律师、设计师……。但是，绝大多数有能力的技术人员是不敢走出这步。我在2015年到2016年实践过一年半，有过这些实践，做“鸡”的比“二奶”好多了，收入也好很多很多（不好意思开车了）……</li>
</ul>
<p>庄子说过几句话——</p>
<blockquote>
<p>井蛙不可以语于海者，拘于虚也；&#x2F;&#x2F;空间局限</p>
<p>夏虫不可以语于冰者，笃于时也；&#x2F;&#x2F;时间局限</p>
<p>曲士不可以语于道者，束于教也。&#x2F;&#x2F;认识局限</p>
</blockquote>
<p>别自己墙了自己，人最可悲的就是自己限制自己，想都不敢想，共勉！</p>
<p>————————————————————</p>
<p><strong>注：这篇文章就是要劝大家更为开放，让自己有更多的可能性，能到更高的层次，做更有价值的事，成为更强更好的人……当然，如果你觉得你只想做一个平凡人，也和本文并不冲突……另外你也不要觉得这篇文章是让你要成为一个精英，但你一定要去摸高……这篇文章是告诉你一种面对人生的思考方式，在这种思考方式下，你会有更多的可能性，更大的场景……而不是直接把自己归到“平常人”，把自己“墙”了！</strong></p>
<p>注：我以为用Java适合做架构这事应该是常识了，但是评论中有很多人非常反对这个事。那我解释一下吧：首先，小型的项目用什么语言都行，爱用什么用什么。但是，真正的企业级架构就不一样了，其中并不仅仅只是RESTful API或RPC，还有各种配套设施和控制系统，比如：应用网关，服务发现、配置中心、健康检查、服务监控、服务治理（熔断、限流、幂等、重试、隔离、事务补偿）、Tracing监控、SOA&#x2F;ESB、CQRS、EDA……这些东西在非Java的技术栈体系内，很难看到全貌，<strong>Java强大的生态环境，就是让你把注意力放到更高层次的架构和业务上来的</strong>。（千万不要觉得，整几个服务RPC一下，加个缓存，加个队列，就能叫架构，那只是系统集成罢了）</p>
<p>（全文完）</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%81%93%E7%90%86/" rel="tag">道理</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-我很无聊，该怎么办"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/16/%E6%88%91%E5%BE%88%E6%97%A0%E8%81%8A%EF%BC%8C%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E/"
    >我很无聊，该怎么办</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2020/02/16/%E6%88%91%E5%BE%88%E6%97%A0%E8%81%8A%EF%BC%8C%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E/" class="article-date">
  <time datetime="2020-02-16T12:53:41.000Z" itemprop="datePublished">2020-02-16</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <blockquote>
<p>如果你无聊，那是因为你什么都没做。</p>
</blockquote>
<blockquote>
<p>作者：Ibrahim Diallo</p>
<p>原文地址：<a target="_blank" rel="noopener" href="https://idiallo.com/blog/im-bored-what-do-i-do">https://idiallo.com/blog/im-bored-what-do-i-do</a></p>
<p>阅读本文大约需要 5 分钟</p>
<p>翻译：高行行</p>
<p>小结：</p>
<ol>
<li>你消费得越多，就需要消费更多。一旦停止消费，你就会感到无聊。</li>
<li>解决无聊的方法并不是持续不断的娱乐。而是创造以前没有的东西。</li>
<li>生产胜于消费</li>
</ol>
<p>翻译水平有限，如果有翻译不准的地方，敬请谅解</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/576791/1581857248974-7c0c0067-1f7e-4247-b853-61623984c507.png"></p>
<p>我在手机的滚动内容上浪费了很多时间。每秒都有更多的内容要消费。比如一个有趣的视频，一个段子，一个政治言论，一段鼓舞人心的引用，一个有趣的视频，一个段子，一个政治言论，一段鼓舞人心的引用，并且循环不断。我时不时地打破循环，转向一篇长篇且有趣的文章。我阅读并且感觉自己更聪明了。然后，我希望再找一篇文章，让我了解到更多相同的内容，但我却找不到更多。</p>
<p><strong>“换句话说，我很无聊。”</strong></p>
<p>我消费的越多，我需要消费的也越多，我也会感到越无聊。我经常转向电子游戏来释放压力。我可以花两个小时来射击虚拟物体，直到我开始觉得娱乐感不足。然后，我发现自己将手机拉近，可以在玩游戏的同时消费更多的滚动内容。只有同时激发我的全部感觉，我才会感觉到安心。</p>
<p>有些人说养成习惯需要 21 天，而另一些人则认为<a target="_blank" rel="noopener" href="https://www.brainpickings.org/2014/01/02/how-long-it-takes-to-form-a-new-habit/" title="大约需要66天">大约需要 66 天</a>。无论哪种方式，它都表明我们是习惯的创造者，如果我们执行一项任务的时间足够长，它将成为我们日常的一部分。无聊成为了我们日常的一部分。我们必须消费社交媒体的内容来减少无聊，但消费越多，我们就越无聊。</p>
<p>这将成为新的常态。消费少了就会导致那种无聊的感觉。与朋友交谈，你会觉得无聊。他们不可能同时与电子游戏，政治言论和有趣的视频竞争。在谈话过程中，你会听到手机传来熟悉的嘟嘟声，你必须将其拿起。不是你忽视朋友或晚餐谈话，而是需要让他们都同时出现以使自己感觉正常。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/576791/1581708352628-b9493942-288d-4fb4-a01c-ec330dcece5b.jpeg"></p>
<p>我发现自己处于无聊习惯成型的早期阶段，因此我试图在此博客上写一篇文章。我不得不逼自己打出从我空荡荡的脑袋中冒出来的任何东西。我没有什么东西可写是一个事实。但是用这种方法发生了一些事。</p>
<p>从<strong>消费</strong>到<strong>生产</strong>的转变开始打破我过去养成的习惯所带来的厚重障碍。我写的越多，就越容易使我的想法浮出水面。我脑子里涌出的想法越多，我对娱乐的需求就越少。我整整一天的时间都在写一些我认为很有趣的东西，<a target="_blank" rel="noopener" href="https://idiallo.com/blog/writers-block" title="即使只是为了我自己">即使只是为了我自己</a>。</p>
<p><strong>“生产胜于消费。”</strong></p>
<p>心灵就像一顶神奇的兔子帽。你可以在魔术帽中装满无数只兔子，而且总还是有空间容纳另一只兔子。你不会看够了 Netflix 的节目，因为总是有再多的空间。如果你因为无聊而观看了一个节目，那么你可能会再观看 3 个节目。</p>
<p>生产也一样，总有额外可以挖掘的地方。你可以从帽子中拉出无数只兔子，当它看上去空了时，深入挖掘，你会发现另一只兔子。你生产的越多，你得到的想法就越多。而且附加的好处是你感到娱乐的需求减少了。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/576791/1581708353483-8a9c0ab0-e83c-4a7c-a537-026ece5127a3.jpeg"></p>
<p>用通俗的话来说，就是制作一些东西、创造一些东西、构建一些东西。无论是什么</p>
<p>它可以是陶罐、纸上绘画、JavaScript 文件、木材构件、鞋架、沙堡、火柴制作的玩具房子、故事。只要你可以保存自己创造的内容并对其吹嘘，它就可以是任何东西。它甚至不必是新鲜玩意或优秀的。</p>
<p>解决无聊的方法并不是持续不断的娱乐。而是创造以前没有的东西</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag">翻译</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%81%93%E7%90%86/" rel="tag">道理</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/5/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2023
        <i class="ri-heart-fill heart_icon"></i> 高行行
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="高行行的个人博客"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://gaohanghang.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/twitter">Twitter</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://weibo.com/u/5125203090">微博</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>